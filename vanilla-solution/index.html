<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ISS Tracker</title>

    <style>
        html,
        body,
        arcgis-map {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        arcgis-scene {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        arcgis-time-slider {
            position: absolute;
            left: 5%;
            right: 5%;
            bottom: 20px;
        }

        #titleDiv {
            font-weight: 36;
            text-align: center;
        }

        .label-wrapper {
            display: flex;
            padding: 0.5rem;
            cursor: pointer;
        }

        calcite-switch {
            margin: 0 0.5rem;
        }

        #toggle {
            height: 28px;
            width: 28px;
            padding-left: 5px;
            padding-top: 5px;
            background-color: #000000;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/next/esri/themes/dark/main.css">
    <script src="https://jsdev.arcgis.com/next/"></script>
    <script type="module" src="https://js.arcgis.com/calcite-components/2.6.0/calcite.esm.js"></script>
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/calcite-components/2.6.0/calcite.css" />
    <script type="module" src="https://jsdev.arcgis.com/map-components/next/arcgis-map-components.esm.js"></script>
</head>

<body>

    <calcite-shell class="calcite-mode-dark">
        <calcite-navigation slot="header">
            <calcite-navigation-logo heading="Track the International Space Station" slot="logo" target="_blank" />
        </calcite-navigation>

        <arcgis-map id="mapElem" destroy-disabled>
            <arcgis-expand position="top-left">
                <arcgis-legend></arcgis-legend>
            </arcgis-expand>
            <arcgis-placement position="top-left">
                <div id="toggle">
                    <calcite-icon icon="globe" id="2d-3d-toggle"></calcite-icon>
                </div>
            </arcgis-placement>
        </arcgis-map>

        <arcgis-time-slider loop time-visible reference-element="#mapElem"></arcgis-time-slider>

    </calcite-shell>

    <script>
        async function load() {
            const Map = await $arcgis.import("esri/Map");
            const FeatureLayer = await $arcgis.import("esri/layers/FeatureLayer");
            const Basemap = await $arcgis.import("esri/Basemap");
            const timeSlider = document.querySelector("arcgis-time-slider");
            const mapElem = document.querySelector("arcgis-map");
            let currentView = mapElem;
            const featureLayer = new FeatureLayer({
                portalItem: {
                    id: "6b84497d99b74d9e937cd0074f7c7365"
                },
                refreshInterval: 0.1
            });
            const basemap = new Basemap({
                portalItem: {
                    id: "a9c628e802f84ad282f5c72f6354265b"
                }
            });
            const map = new Map({
                basemap: basemap,
                layers: [featureLayer]
            });
            mapElem.map = map;
            mapElem.addEventListener("arcgisViewReadyChange", async ({
                target
            }) => {
                const lv = await target.whenLayerView(featureLayer);
                timeSlider.fullTimeExtent = featureLayer.timeInfo.fullTimeExtent.expandTo("hours");
                timeSlider.stops = {
                    interval: featureLayer.timeInfo.interval
                };
            });
            const toggle = document.getElementById("2d-3d-toggle");
            const shell = document.querySelector("calcite-shell");
            let sceneElem;
            toggle.addEventListener("click", () => {
                if (!sceneElem) {
                    sceneElem = document.createElement("arcgis-scene");
                    sceneElem.map = map;
                    sceneElem.destroyDisabled = true;
                }
                //switch between 2D and 3D
                console.log(currentView);
                currentView?.remove();
                if (currentView === mapElem) {
                    currentView = sceneElem;
                    timeSlider.referenceElement = sceneElem;
                } else {
                    currentView = mapElem;
                    timeSlider.referenceElement = mapElem;
                }
                shell.insertBefore(currentView, timeSlider);
            });
        }
        load();
    </script>

</body>

</html>