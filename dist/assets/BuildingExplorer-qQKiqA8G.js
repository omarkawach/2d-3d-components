import{o as l,y as n,X as _,bO as G,ak as V,cr as $,gl as L,a0 as pe,eK as ie,a_ as le,hT as Me,dV as We,P as Oe,f$ as X,ct as Re,bU as ae,hl as H,fb as Ie}from"./index-8ERthB3p.js";import{i as I,O as F,n as a,v as Z,L as ve,e as he,g as D}from"./jsxFactory-BxQYPm-b.js";import{c as ge,a as Ae,i as He,H as De,f as Te}from"./BuildingSceneLayer-vBM1Xyfw.js";import{e as R}from"./globalCss-DfZw-NIf.js";import{e as Y}from"./Heading-BZW3Ifza.js";import"./BuildingComponentSublayer-eBz-Vwap.js";import"./capabilities-B6PqF1Vy.js";import"./I3SIndexInfo-CWyEOqXW.js";import"./I3SLayerDefinitions-CcCZfvYy.js";import"./I3SUtil-DvcgZFwB.js";import"./mat4f64-Dk4dwAN8.js";import"./spatialReferenceEllipsoidUtils-CmEPjh7T.js";import"./projectVectorToVector-C3SBBDgz.js";import"./projectPointToVector-qKp-AJ2b.js";import"./sphere-Bf4ezJdT.js";import"./ObjectStack-BPo9QGhV.js";import"./plane-Du3EYICn.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-BrpT0VRp.js";import"./vec2f64-Diu2Kaa8.js";import"./mathUtils-iSLnUy_4.js";import"./I3SBinaryReader-Y2aVLbE7.js";import"./VertexAttribute-BnAa5VW0.js";import"./computeTranslationToOriginAndRotation-BbJd4iYX.js";import"./edgeUtils-D8J_3GIe.js";import"./symbolColorUtils-B_k_VgHH.js";import"./orientedBoundingBox-BQvYwCTM.js";import"./mat3-CqxUQBLP.js";import"./quat-DUnoL8dP.js";import"./ViewingMode-Dodu7ZZk.js";import"./Attribute-B-NAci_J.js";import"./popupUtils-BHYiW8I-.js";import"./BuildingGroupSublayer-3UTLAh17.js";import"./SceneService-7seWcldd.js";import"./originUtils-D69mHv66.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./jsonContext-DAHq4PYe.js";import"./resourceUtils-Bkr2NG-A.js";import"./resourceUtils-FbGjm3HI.js";import"./saveAPIKeyUtils-BEX39E-1.js";import"./saveUtils-cWMLp1XS.js";import"./associatedFeatureServiceUtils-D6OqPDNW.js";import"./elevationInfoUtils-sHEwmo9N.js";const ze="overview",_e=t=>e=>{const s=t.toLowerCase();return e.sublayers.find(i=>{var o;return((o=i.modelName)==null?void 0:o.toLowerCase())===s})??null},ye=_e("fullmodel"),Ue=_e(ze);function Ke(t){const e=ye(t);e!=null&&(e.visible=!0);const s=Ue(t);s!=null&&(s.visible=!1)}function ee(t,e){const s=je(t,e);if(s==null)return null;const i=s.fieldName;if(i==null||!i)return null;const o=qe(t,i),r=new Map;for(const h of s.mostFrequentValues??[])typeof h=="number"&&r.set(h,o!=null?o.getName(h):String(h));return{fieldName:i,fieldValueMap:r}}function qe(t,e){var s;for(const i of t.allSublayers.items){const o=i.type==="building-component"?(s=i.getFieldDomain)==null?void 0:s.call(i,e):null;if(o&&o.type==="coded-value")return o}return null}function je(t,e){var o;const s=((o=t.summaryStatistics)==null?void 0:o.fields)??[],i=e.toLowerCase();return s.find(r=>{var h;return((h=r.modelName)==null?void 0:h.toLowerCase())===i})??null}let c=class extends G{constructor(){super(...arguments),this.id="root",this.parent=null,this.children=new V,this.layers=new V,this.level=0,this.collapsed=!0,this._childIds=new Set,this._layerUniqueIds=new Set}initialize(){this.addHandles([this.layers.on("before-add",e=>{this._layerUniqueIds.has(e.item.uid)?e.preventDefault():this._layerUniqueIds.add(e.item.uid)}),this.layers.on("after-add",({item:e})=>{this.addHandles([$(()=>e.visible,()=>this.notifyChange("visible"),L),$(()=>e.title,()=>this.notifyChange("title"),L)],e.uid)}),this.layers.on("before-remove",({item:e})=>{this.removeHandles(e.uid),this.notifyChange("title"),this.notifyChange("visible")}),this.children.on("before-add",e=>{this._childIds.has(e.item.id)?e.preventDefault():(e.item._set("parent",this),this._childIds.add(e.item.id))})])}destroy(){this.children.forEach(e=>e.destroy())}get hasChildren(){return this.children.length>0}get isRoot(){return this.level===0}get isLeaf(){return!this.hasChildren}get isDiscipline(){return this.level===1}get visible(){return de(this.layers,e=>e.visible)}get title(){return de(this.layers,e=>e.title)||this.layers.items.map(e=>e.title).join(", ")||null}toggleVisibility(e){const s=e===void 0?!this.visible:e;this.layers.forEach(i=>{i.visible=s}),s&&this.parent!=null&&this.parent.toggleVisibility(!0)}toggleCollapsed(e){this.collapsed=e===void 0?!this.collapsed:e}expand(){this.collapsed=!1}expandAll(){this.expand(),this.children.forEach(e=>e.expandAll())}collapse(){this.collapsed=!0}collapseAll(){this.collapse(),this.children.forEach(e=>e.collapseAll())}toggleAllSiblingsVisibility(e){const s=e===void 0?!this.visible:e;this.toggleVisibility(s),this.parent!=null&&(this.parent.toggleVisibility(s),this.parent.children.forEach(i=>i.toggleVisibility(s)))}};function de(t,e){let s=null;for(const i of t.items){const o=e(i);if(s!=null&&s!==o)return null;s=o}return s}l([n({nonNullable:!0})],c.prototype,"id",void 0),l([n()],c.prototype,"parent",void 0),l([n({nonNullable:!0,readOnly:!0})],c.prototype,"children",void 0),l([n({nonNullable:!0,readOnly:!0})],c.prototype,"layers",void 0),l([n({nonNullable:!0})],c.prototype,"level",void 0),l([n({nonNullable:!0})],c.prototype,"collapsed",void 0),l([n({readOnly:!0})],c.prototype,"hasChildren",null),l([n({readOnly:!0})],c.prototype,"isRoot",null),l([n({readOnly:!0})],c.prototype,"isLeaf",null),l([n({readOnly:!0})],c.prototype,"isDiscipline",null),l([n({readOnly:!0})],c.prototype,"visible",null),l([n({readOnly:!0})],c.prototype,"title",null),c=l([_("esri.widgets.BuildingExplorer.support.LayerTreeNode")],c);function ne(){let t=new AbortController;return async e=>{t.abort(),t=new AbortController;const s={signal:t.signal},i=e.toArray().map(o=>Je(o,s));await Promise.all(i),pe(s)}}async function Je(t,e){await t.load(e),await t.loadAll(),pe(e),t.summaryStatistics&&await t.summaryStatistics.load(e)}let M=class extends G{constructor(e){super(e),this.root=new c,this.state="disabled",this._loadLayers=ne(),this.layers=new V}initialize(){this.addHandles(this.layers.on("change",()=>this._onLayersChange())),this._onLayersChange()}destroy(){this._set("state","disabled"),this.root.destroy()}set layers(e){const s=this._get("layers");this._set("layers",ie(e,s))}_updateLayerTree(){this.root.destroy(),this._set("root",new c({collapsed:!1}));const e=new Map,s=this.layers.length>1?"modelName":"id";return this.layers.forEach(i=>{const o=ye(i);this._addNodesForSublayers(o??i,this.root,e,s)}),this}_addNodeForLayer(e,s,i,o){const r=String(e[o]).toLowerCase();if(r==null||e.isEmpty)return;const h=`${s.id}/${r}`;let u=i.get(h);u||(u=new c({id:r,level:s.level+1}),i.set(h,u)),u.layers.push(e),s.children.push(u),this._addNodesForSublayers(e,u,i,o)}_addNodesForSublayers(e,s,i,o){(e.type==="building-scene"||e.type==="building-group"&&!e.isEmpty)&&e.sublayers.forEach(r=>this._addNodeForLayer(r,s,i,o))}async _onLayersChange(){if(this._set("state","loading"),this.layers.length!==0)try{await this._loadLayers(this.layers),this._updateLayerTree(),this._set("state","ready")}catch(e){le(e)||this._set("state","failed")}}};l([n({readOnly:!0})],M.prototype,"root",void 0),l([n({type:V,nonNullable:!0})],M.prototype,"layers",null),l([n({readOnly:!0,nonNullable:!0})],M.prototype,"state",void 0),M=l([_("esri.widgets.BuildingExplorer.BuildingDisciplineViewModel")],M);const me=M;function J(t){const e={fieldValueMap:new Map,allowedValues:[]};for(const s of t){const i=s.fieldValueMap,o=e.fieldValueMap;i.forEach((r,h)=>{o.has(h)||(o.set(h,r),e.allowedValues.push(h))})}return e.allowedValues.sort((s,i)=>s-i),e}function Ge(t){let e=null;for(const s of t)e=e!=null?Math.min(e,s):s;return e}function Xe(t){let e=null;for(const s of t)e=e!=null?Math.max(e,s):s;return e}function ue(t,e){return e.allowedValues.length>0?Ye(t,e.allowedValues):null}function Ye(t,e){if(e.length===0)return t;if(t===1/0)return e[e.length-1];if(t===-1/0)return e[0];let s=e[0],i=Math.abs(s-t);for(const o of e){const r=Math.abs(o-t);r<i&&(s=o,i=r)}return s}let v=class extends G{constructor(e){super(e),this.state="disabled",this._valueBeforeReady=null,this._domainInfo=J([]),this._loadLayers=ne(),this.layers=new V}initialize(){this.addHandles(this.layers.on("change",()=>this._onLayersChange())),this._onLayersChange()}destroy(){this._set("state","disabled")}get enabled(){return this.allowedValues.length>0&&this._get("enabled")}set enabled(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}get value(){return(this.state==="ready"?this._get("value"):this._valueBeforeReady)??0}set value(e){if(this.state!=="ready")return void(this._valueBeforeReady=e);if(e===this.value)return;const s=ue(e,this);s!=null&&this._set("value",s)}get min(){return Ge(this.allowedValues)}get max(){return Xe(this.allowedValues)}get allowedValues(){return this._domainInfo.allowedValues}get hasNext(){if(!this.enabled)return!0;const e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}get hasPrevious(){return!this.enabled||this._valueIndex>0}set layers(e){const s=this._get("layers");this._set("layers",ie(e,s))}get filterExpressions(){return{solid:null,xRay:null}}get _valueIndex(){return Me(this.allowedValues,this.value)}select(e){if(this.state!=="ready")return void(this._valueBeforeReady=e);ue(e,this)!=null&&(this.enabled=!0,this.value=e)}clear(){this.state==="ready"?this.enabled=!1:this._valueBeforeReady=null}next(){const{state:e,allowedValues:s,enabled:i,hasNext:o,_valueIndex:r}=this;if(e==="ready"||this._valueBeforeReady==null){if(s.length!==0)return i?void(o&&(this.value=s[r+1])):(this.enabled=!0,void(this.value=s[0]))}else this._valueBeforeReady++}previous(){const{state:e,allowedValues:s,enabled:i,hasPrevious:o,_valueIndex:r}=this;if(e==="ready"||this._valueBeforeReady==null){if(s.length!==0)return i?void(o&&(this.value=s[r-1])):(this.enabled=!0,void(this.value=s[s.length-1]))}else this._valueBeforeReady++}getValueLabel(e){return this.layers.length===0?null:this._domainInfo.fieldValueMap.get(e)??null}async _onLayersChange(){if(this._set("state","loading"),this._domainInfo=J([]),this.layers.length!==0)try{await this._loadLayers(this.layers),this._setup()}catch(e){le(e)||this._set("state","failed")}}};l([n({value:!1,nonNullable:!0})],v.prototype,"enabled",null),l([n({nonNullable:!0})],v.prototype,"value",null),l([n({readOnly:!0})],v.prototype,"min",null),l([n({readOnly:!0})],v.prototype,"max",null),l([n({readOnly:!0})],v.prototype,"allowedValues",null),l([n({readOnly:!0})],v.prototype,"hasNext",null),l([n({readOnly:!0})],v.prototype,"hasPrevious",null),l([n({type:V,nonNullable:!0})],v.prototype,"layers",null),l([n({nonNullable:!0})],v.prototype,"state",void 0),l([n()],v.prototype,"_valueBeforeReady",void 0),l([n({readOnly:!0})],v.prototype,"_valueIndex",null),l([n()],v.prototype,"_domainInfo",void 0),v=l([_("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],v);const be=v,fe="__BUILDING_EXPLORER_FILTER__";function Qe(){return`${We()}${fe}`}function te(t){const e=typeof t=="string"?t:t.id;return!!e&&e.includes(fe)}function we(t,e){for(const s of t.items)for(const i of s.filters.items){if(!te(i))continue;const o=e(i);if(o!=null)return o}return null}function Ze(t,e){t.forEach(s=>{const i=s.filters.filter(r=>!te(r));e!=null&&i.push(e),et(s.filters,i)||(s.filters=i);const o=s.filters.find(r=>te(r));s.activeFilterId=o!=null?o.id:null})}function et(t,e){const s=e.length;if(t==null||t.length!==s)return!1;for(let i=0;i<s;++i){const o=e.at(i).toJSON(),r=t.at(i).toJSON();if(o.id="",r.id="",JSON.stringify(o)!==JSON.stringify(r))return!1}return!0}function tt(t){const e=$e(t);return e?new ge({filterExpression:e,filterMode:new Ae}):null}function st(t){const e=$e(t);return e?new ge({filterExpression:e,filterMode:new He}):null}function $e(t){return t.filter(e=>!!e).map(e=>`(${e})`).join(" AND ")}const it="bldglevel";let W=class extends be{constructor(){super(...arguments),this._levelFieldName=null,this._parseValueFromFilter=e=>{var o;const s=new RegExp(`${this._levelFieldName}\\s*=\\s*(\\d+)`,"gi"),i=new RegExp(`${this._levelFieldName}\\s*<\\s*(\\d+)`,"gi");for(const{filterMode:r,filterExpression:h}of((o=e.filterBlocks)==null?void 0:o.items)??[]){if(h==null)continue;let u=null;if(r.type==="solid"?u=s.exec(h):r.type==="x-ray"&&(u=i.exec(h)),u)return parseInt(u[1],10)}return null}}get filterExpressions(){return this.enabled&&this._levelFieldName?{xRay:`${this._levelFieldName} < ${this.value}`,solid:`${this._levelFieldName} = ${this.value}`}:{solid:null,xRay:null}}get _firstValue(){const e=this.allowedValues;return e.length>0?e[0]:0}_setup(){const e=[];this.layers.forEach(o=>{const r=ee(o,it);r!=null&&(this._levelFieldName=r.fieldName,e.push(r))}),this._domainInfo=J(e);const s=this._valueBeforeReady;this._set("state","ready"),this._valueBeforeReady=null;const i=s??we(this.layers,this._parseValueFromFilter);i!=null?this.select(i):(this.enabled=!1,this.value=this._firstValue)}};l([n({readOnly:!0})],W.prototype,"filterExpressions",null),l([n()],W.prototype,"_levelFieldName",void 0),l([n({readOnly:!0})],W.prototype,"_firstValue",null),W=l([_("esri.widgets.BuildingExplorer.BuildingLevel")],W);const Le=W,lt="demolishedphase",nt="createdphase";let S=class extends be{constructor(){super(...arguments),this._createdPhaseFieldName=null,this._demolishedPhaseFieldName=null,this._parseValueFromFilter=e=>{var h;const s=this._createdPhaseFieldName,i=new RegExp(`${s}\\s*<=\\s*(\\d+)\\s*OR\\s*${s}\\s*IS\\s*NULL`,"gi"),o=this._demolishedPhaseFieldName,r=new RegExp(`${o}\\s*>\\s*(\\d+)\\s*OR\\s*${o}\\s*IS\\s*NULL`,"gi");for(const{filterExpression:u}of((h=e.filterBlocks)==null?void 0:h.items)??[]){const A=u?i.exec(u)??r.exec(u):null;if(A)return parseInt(A[1],10)}return null}}get filterExpressions(){if(!this.enabled)return{solid:null,xRay:null};const e=[],s=this._createdPhaseFieldName;s&&e.push(`(${s} <= ${this.value} OR ${s} IS NULL)`);const i=this._demolishedPhaseFieldName;i&&e.push(`(${i} > ${this.value} OR ${i} IS NULL)`);const o=e.join(" AND ");return{solid:o,xRay:o}}get _lastValue(){const e=this.allowedValues;return e.length>0?e[e.length-1]:0}_setup(){const e=[];this.layers.forEach(i=>{const o=ee(i,nt);o!=null&&(this._createdPhaseFieldName=o.fieldName,e.push(o));const r=ee(i,lt);r!=null&&(this._demolishedPhaseFieldName=r.fieldName,e.push(r))}),this._domainInfo=J(e);const s=this._valueBeforeReady;if(this._set("state","ready"),this._valueBeforeReady=null,this.allowedValues.length>0){const i=s??we(this.layers,this._parseValueFromFilter);this.select(i??this._lastValue)}else this.clear()}};l([n({readOnly:!0})],S.prototype,"filterExpressions",null),l([n()],S.prototype,"_createdPhaseFieldName",void 0),l([n()],S.prototype,"_demolishedPhaseFieldName",void 0),l([n({readOnly:!0})],S.prototype,"_lastValue",null),S=l([_("esri.widgets.BuildingExplorer.BuildingPhase")],S);const xe=S;let f=class extends G{constructor(e){super(e),this.view=null,this.state="disabled",this.level=new Le,this.phase=new xe,this.disciplines=new me,this._loadLayers=ne(),this.layers=new V}initialize(){this.addHandles([this.layers.on("change",()=>this._onLayersChange()),$(()=>({state:this.state,layers:this.layers,filter:this._filter}),({state:e,layers:s,filter:i})=>{e==="ready"&&Ze(s,i)},{initial:!0})]),this._onLayersChange()}destroy(){this.level.destroyed||this.level.destroy(),this.phase.destroyed||this.phase.destroy(),this.disciplines.destroyed||this.disciplines.destroy()}get isSupported(){var e;return((e=this.view)==null?void 0:e.type)==="3d"}get layers(){return this._get("layers")}set layers(e){const s=e.filter(i=>i instanceof De);s.length!==e.length&&Oe.getLogger(this).error("Some layers are not BuildingSceneLayers but only BuildingSceneLayers can be passed to the widget."),this._set("layers",ie(s,this._get("layers")))}get _filter(){const e=this.level.filterExpressions,s=this.phase.filterExpressions,i=[],o=st([e.solid,s.solid]);o!=null&&i.push(o);const r=tt([e.xRay,s.xRay]);return r!=null&&i.push(r),i.length===0?null:new Te({id:Qe(),name:"Building Explorer Filter",filterBlocks:i})}async _onLayersChange(){const e=this.layers;if(this.level.layers=e,this.phase.layers=e,this.disciplines.layers=e,e.length!==0){this._set("state","loading");try{await this._loadLayers(e),await Promise.all([X(()=>this.level.state==="ready"),X(()=>this.phase.state==="ready"),X(()=>this.disciplines.state==="ready")]),e.forEach(Ke),this._set("state","ready")}catch(s){le(s)||this._set("state","failed")}}else this._set("state","disabled")}};l([n({value:null})],f.prototype,"view",void 0),l([n()],f.prototype,"isSupported",null),l([n({type:V,nonNullable:!0})],f.prototype,"layers",null),l([n({readOnly:!0})],f.prototype,"state",void 0),l([n({readOnly:!0,type:Le})],f.prototype,"level",void 0),l([n({readOnly:!0,type:xe})],f.prototype,"phase",void 0),l([n({readOnly:!0,type:me})],f.prototype,"disciplines",void 0),l([n()],f.prototype,"_filter",null),f=l([_("esri.widgets.BuildingExplorer.BuildingExplorerViewModel")],f);const Ce=f,C="esri-building-explorer",g={base:C,widgetIcon:I.organization,panelError:`${C}__panel--error`,loadingContainer:`${C}__loading-container`,content:`${C}__content`,section:`${C}__section`,levels:`${C}__levels`,phases:`${C}__phases`,disciplines:`${C}__disciplines`};var se;const ot={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},b="esri-building-disciplines-tree-node",y={base:b,root:`${b}--root`,leaf:`${b}--leaf`,label:`${b}__label`,checkbox:`${b}__checkbox`,checkboxChecked:`${b}__checkbox--checked`,checkboxIndeterminate:`${b}__checkbox--indeterminate`,collapseToggle:`${b}__collapse-toggle`,collapseToggleCollapsed:`${b}__collapse-toggle--collapsed`,children:`${b}__children`,level:t=>`${b}--level-${t}`};let B=se=class extends F{constructor(t){super(t),this.messages=ot,this.toggleSiblingsVisibility=!1,this._childWidgets=[],this._updateChildWidgets=()=>{this._destroyChildWidgets(),this._childWidgets=this.node.children.toArray().reverse().map(e=>new se({node:e,messages:this.messages,toggleSiblingsVisibility:this.toggleSiblingsVisibility}))}}initialize(){this.addHandles([Re(()=>this.node.children,"after-changes",this._updateChildWidgets,{onListenerAdd:this._updateChildWidgets,onListenerRemove:this._updateChildWidgets}),$(()=>[this.messages,this.toggleSiblingsVisibility],this._updateChildWidgets,L)])}destroy(){this._destroyChildWidgets()}render(){const t=this.node,e=t.isRoot,s=t.isLeaf;return t.isDiscipline&&s?a("div",{key:`${t.id}-empty`}):a("div",{"aria-expanded":t.collapsed?"false":"true",bind:this,class:this.classes(y.base,y.level(t.level),{[y.root]:e,[y.leaf]:s}),key:t.id,onkeydown:this._onKeydown,role:"treeitem",tabIndex:s?void 0:0},a("label",{bind:this,class:y.label,onclick:this._onCheckboxToggle},this._renderCollapseToggle(),this._renderCheckbox(),a("span",null,t.title)),this._renderChildren(t))}_renderCheckbox(){var o,r;const t=this.node.visible,e=t===!0,s=t===null,i=e?(o=this.messages)==null?void 0:o.hideSublayer:(r=this.messages)==null?void 0:r.showSublayer;return a("button",{"aria-checked":e?"true":"false","aria-label":i,bind:this,class:this.classes(y.checkbox,{[y.checkboxChecked]:e,[I.checkMark]:e,[y.checkboxIndeterminate]:s,[I.minus]:s}),onclick:this._onCheckboxToggle,role:"checkbox",title:i,type:"button"})}_renderCollapseToggle(){var s,i;if(!this.node.hasChildren)return null;const t=this.node.collapsed,e=t?(s=this.messages)==null?void 0:s.expand:(i=this.messages)==null?void 0:i.collapse;return a("div",{"aria-label":e,bind:this,class:this.classes(y.collapseToggle,I.right,{[y.collapseToggleCollapsed]:t}),onclick:this._onCollapseToggle,title:e})}_renderChildren(t){return!t.hasChildren||t.collapsed?null:a("div",{class:y.children},this._childWidgets.map(e=>e.render()))}_onKeydown(t){switch(t.key){case"Space":case"Enter":if(!t.target.classList.contains(y.base))return;t.stopPropagation(),this.node.toggleVisibility();break;case"ArrowLeft":t.stopPropagation(),this.node.toggleCollapsed(!Z(this.container));break;case"ArrowRight":t.stopPropagation(),this.node.toggleCollapsed(Z(this.container))}}_onCheckboxToggle(t){t.preventDefault(),t.stopPropagation(),(t.metaKey||t.ctrlKey)&&this.toggleSiblingsVisibility?this.node.toggleAllSiblingsVisibility():this.node.toggleVisibility()}_onCollapseToggle(t){t.preventDefault(),t.stopPropagation(),this.node.toggleCollapsed()}_destroyChildWidgets(){this._childWidgets.forEach(t=>t.destroy()),this._childWidgets=[]}};l([n({type:c})],B.prototype,"node",void 0),l([n()],B.prototype,"messages",void 0),l([n({nonNullable:!0})],B.prototype,"toggleSiblingsVisibility",void 0),l([n()],B.prototype,"_childWidgets",void 0),B=se=l([_("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesNode")],B);const rt=B,at={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},ht={base:"esri-building-disciplines-tree"};let O=class extends F{constructor(e){super(e),this.toggleSiblingsVisibility=!1}render(){const{vm:e}=this,s=this.toggleSiblingsVisibility,i=this.messages??at;return a("div",{class:ht.base,role:"tree"},e.root.children.toArray().reverse().map(o=>a(rt,{messages:i,node:o,toggleSiblingsVisibility:s})))}};l([n()],O.prototype,"vm",void 0),l([n()],O.prototype,"messages",void 0),l([n()],O.prototype,"toggleSiblingsVisibility",void 0),O=l([_("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesTree")],O);const dt=O,Pe=30,ke=20,Ee=30,Ne=10,q=20,j=2,Ve=.035,Se=30,Be=14,Fe=80,ut=100,ct=40,pt=Object.freeze(Object.defineProperty({__proto__:null,alphaLevelDependencyFactor:Ee,alphaSpreadFactor:Ne,levelHeightDefault:Be,levelHoveredExtraHeight:Pe,levelHoveredExtraWidth:ke,levelWidthConstant:ct,levelWidthMax:Fe,levelWidthMin:Se,levelWidthNominator:ut,levelsMarginFactor:j,levelsPadding:q,levelsPointerAdjustment:Ve},Symbol.toStringTag,{value:"Module"})),P="esri-building-level-picker",k={container:P,noLevel:`${P}--no-level`,animateLevel:`${P}--animate-level`,levelsContainer:`${P}__levels-container`,innerLevelsContainer:`${P}__inner-levels-container`,labelContainer:`${P}__label-container`,arrowUp:`${P}__arrow-up`,arrowDown:`${P}__arrow-down`},T="esri-building-level-picker-label",z={base:T,active:`${T}--active`,hover:`${T}--hover`,empty:`${T}--empty`,clearButton:`${T}__clear-button`},vt={clearLevel:"",selectLevel:""};let E=class extends F{constructor(e,s){super(e,s),this.level=null,this.active=!1,this.hovering=!1,this.onClear=()=>{}}render(){const e=this.messages??vt;if(this.level==null)return a("div",{class:z.empty,title:e.selectLevel},e.selectLevel);const s=e.clearLevel;return a("div",{"aria-label":s,bind:this,class:this.classes(z.base,{[z.active]:this.active,[z.hover]:this.hovering}),onclick:this.onClear,title:s},a("span",null,this.level),a("button",{bind:this,class:this.classes(z.clearButton,I.close),disabled:!this.active,onclick:this.onClear,type:"button"}))}};l([n()],E.prototype,"level",void 0),l([n({nonNullable:!0})],E.prototype,"active",void 0),l([n({nonNullable:!0})],E.prototype,"hovering",void 0),l([n()],E.prototype,"messages",void 0),l([n({nonNullable:!0})],E.prototype,"onClear",void 0),E=l([_("esri.widgets.BuildingExplorer.BuildingLevelPicker.Label")],E);const U="esri-building-level-picker-item",K={container:U,base:`${U}__base`,hover:`${U}--hover`,active:`${U}--active`};let w=class extends F{constructor(t,e){super(t,e),this.active=!1,this.hovering=!1,this.width=0,this.height=0,this.onSelect=()=>{},this.onFocus=()=>{},this.onBlur=()=>{},this._baseElement=null}render(){return a("div",{bind:this,class:this.classes(K.container,{[K.active]:this.active,[K.hover]:this.hovering}),key:this,styles:{height:`${this.height}px`}},this._renderBase())}focus(){this._baseElement!=null&&this._baseElement.focus()}_renderBase(){const t=this.width,e=.8*this.width;return a("div",{class:K.base,styles:{width:`${Math.round(t)}px`,height:`${Math.round(t)}px`}},a("button",{afterCreate:ve,"aria-label":this.label,bind:this,class:"rect","data-node-ref":"_baseElement",onblur:this.onBlur,onclick:this.onSelect,onfocus:this.onFocus,styles:{width:`${Math.round(e)}px`,height:`${Math.round(e)}px`},tabIndex:-1,title:this.label??"",type:"button"}))}};l([n({nonNullable:!0})],w.prototype,"level",void 0),l([n({nonNullable:!0})],w.prototype,"active",void 0),l([n({nonNullable:!0})],w.prototype,"hovering",void 0),l([n({nonNullable:!0})],w.prototype,"width",void 0),l([n({nonNullable:!0})],w.prototype,"height",void 0),l([n({nonNullable:!0})],w.prototype,"onSelect",void 0),l([n({nonNullable:!0})],w.prototype,"onFocus",void 0),l([n({nonNullable:!0})],w.prototype,"onBlur",void 0),w=l([_("esri.widgets.BuildingExplorer.BuildingLevelPicker.LevelItem")],w);const Q={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};let d=class extends F{constructor(t,e){super(t,e),this._levelHandlesKey="levelHandles",this._levelEventHandlesKey="levelEventHandles",this._levelWidgets=[],this._labelWidget=new E({onClear:()=>this.vm.clear()}),this._hoveredLevel=null,this._expandedLevelsHeight=void 0,this._normalizedPointerPosition=0,this._hovering=!1,this._containerPosTop=null,this._levelsContainer=null,this._onPointerUp=()=>{var i;if((i=window.getSelection())==null||i.removeAllRanges(),this._hoveredLevel==null)return;const{vm:s}=this;s.enabled&&this._hoveredLevel===s.value?s.clear():s.select(this._hoveredLevel)},this._onPointerEnter=()=>{this._hovering||this._levelsContainer==null||(this._hovering=!0,this._containerPosTop=this._levelsContainer.getBoundingClientRect().top??0)},this._onPointerLeave=()=>{this._hovering&&(this._normalizedPointerPosition=0,this._hoveredLevel=null,this._hovering=!1)},this._onPointerMove=s=>{var i;if(!this._hovering)return!1;if((i=window.getSelection())==null||i.removeAllRanges(),this._containerPosTop!=null){const o=this._containerPosTop,r=q*j,h=this._expandedLevelsMargin;let u=this._levelsHeight,A=o+r+h;const oe=this._levelHeight/2;A+=oe,u-=oe;let re=(s.clientY-A)/u;re+=Ve,this._normalizedPointerPosition=re}return!1}}postInitialize(){this.addHandles([$(()=>this._levelsContainer,()=>this._onContainerChange(),L),$(()=>this._levels,()=>this._createLevelWidgets(),L),$(()=>this.messages,()=>{this._labelWidget.messages=this.messages??Q},L)])}destroy(){this._levelWidgets.forEach(t=>t.destroy()),this._labelWidget.destroy()}get _levels(){return this.vm.allowedValues}get _numLevels(){return this._levels.length}get _levelsHeight(){return Math.round(this._levelHeight*this._numLevels)}get _expandedLevelsMargin(){return Math.round(((this._expandedLevelsHeight??0)-this._levelsHeight)/2)}get _levelWidth(){const{levelWidthNominator:t,levelWidthConstant:e}=pt,s=t/Math.sqrt(this._numLevels)+e;return Math.round(ae(s,Se,Fe))}get _levelHeight(){const t=Be,e=2*t/Math.sqrt(this._numLevels);return Math.round(ae(e,2,t))}get _gaussianFactor(){const t=this._numLevels;return t/Math.log(Ee*t)*Ne}get _levelClosestToPointer(){if(!this._hovering)return null;const t=this._numLevels-1,e=this._normalizedPointerPosition;return t>=0&&e!=null?this._levels[Math.round((1-e)*t)]:null}render(){const t=this._levelWidgets.length,e=t>1?this._levelWidgets.map(h=>h.render()):null,s=q*j,i=-s/j,o=this._levelsHeight,r=o+2*s;return a("div",{bind:this,class:this.classes(R.widget,k.container,{[k.animateLevel]:!this._hovering,[k.noLevel]:t<2}),key:this,onkeydown:this._onKeyDown},this._renderLabelContainer(),a("div",{afterCreate:ve,bind:this,class:k.levelsContainer,"data-node-ref":"_levelsContainer",onfocus:this._onFocus,styles:{height:`${r}px`,marginTop:`${i}px`,marginBottom:`${i}px`}},a("div",{class:k.innerLevelsContainer,styles:{height:`${o}px`,margin:q-this._expandedLevelsMargin+"px 0 0 0"}},e)))}_renderLabelContainer(){const t=this.messages??Q,e=t.previousLevel,s=t.nextLevel;return a("div",{class:k.labelContainer,tabIndex:0},a("button",{"aria-label":s,bind:this,class:k.arrowUp,disabled:!this.vm.hasNext,onclick:this._onArrowUpClick,title:s,type:"button"}),this._labelWidget.render(),a("button",{"aria-label":e,bind:this,class:k.arrowDown,disabled:!this.vm.hasPrevious,onclick:this._onArrowDownClick,title:e,type:"button"}))}_updateComponents(){const t=this.messages??Q,e=this.vm.enabled?this.vm.value:null,s=this._hoveredLevel!=null?this._hoveredLevel:e;this._levelWidgets.forEach(i=>{var r;const o=this.vm.getValueLabel(i.level);i.label=o??((r=t.currentLevel)==null?void 0:r.replace("{{level}}",String(i.level))),i.active=i.level===e,i.hovering=i.level===this._hoveredLevel}),this._labelWidget.level=s,this._labelWidget.active=s===e,this._labelWidget.hovering=this._hoveredLevel!=null}_createLevelWidgets(){this._levelWidgets.forEach(t=>t.destroy()),this._levelWidgets=this._levels.map(t=>new w({level:t,onSelect:()=>this._onLevelToggle(t)})),this.removeHandles(this._levelHandlesKey),this.addHandles([$(()=>{const{vm:t}=this;return[this.messages,t==null?void 0:t.value,t==null?void 0:t.enabled,this._hoveredLevel,this._hovering]},()=>this._updateComponents(),L),$(()=>[this._normalizedPointerPosition,this._hovering],()=>this._onPointerPositionChange(),L),$(()=>this._levelWidth,t=>this._levelWidgets.forEach(e=>e.width=t),L)],this._levelHandlesKey)}_onContainerChange(){const t=this._levelsContainer;t!=null&&(this.removeHandles(this._levelEventHandlesKey),this.addHandles([H(t,"pointerenter",this._onPointerEnter),H(t,"pointerover",this._onPointerEnter),H(t,"pointerleave",this._onPointerLeave),H(t,"pointerup",this._onPointerUp),H(t,"pointermove",this._onPointerMove)],this._levelEventHandlesKey))}_onKeyDown(t){switch(t.key){case"ArrowDown":case"ArrowLeft":t.preventDefault(),t.stopPropagation(),this.vm.previous(),this._focusCurrentLevel();break;case"ArrowUp":case"ArrowRight":t.preventDefault(),t.stopPropagation(),this.vm.next(),this._focusCurrentLevel()}}_focusCurrentLevel(){const t=this._levelWidgets.find(e=>e.level===this.vm.value);t==null||t.focus()}_onFocus(){this._hoveredLevel=this._levels.length>0?this._levels[0]:null}_onLevelToggle(t){const{vm:e}=this;e.enabled&&e.value===t?e.clear():e.select(t)}_onArrowUpClick(){this.vm.next()}_onArrowDownClick(){this.vm.previous()}_onPointerPositionChange(){let t=0;this._levelWidgets.forEach((s,i)=>{const{width:o,height:r}=this._getLevelWidgetSize(i);s.height=r,s.width=o,t+=r}),this._hoveredLevel=this._levelClosestToPointer;const e=this._expandedLevelsHeight;(e==null||Math.abs(e-t)>30)&&(this._expandedLevelsHeight=t)}_getLevelWidgetSize(t){const e={width:this._levelWidth,height:this._levelHeight};if(this._hovering){const s=this._getGaussianFactor(t,this._normalizedPointerPosition);e.width+=ke*s,e.height+=Pe*s}return e}_getGaussianFactor(t,e){const s=this._numLevels-1,i=(s-t)/s,o=this._gaussianFactor*(i-e);return Math.exp(-(o**2))}};l([n()],d.prototype,"vm",void 0),l([n()],d.prototype,"messages",void 0),l([n()],d.prototype,"_levelWidgets",void 0),l([n()],d.prototype,"_labelWidget",void 0),l([n()],d.prototype,"_hoveredLevel",void 0),l([n()],d.prototype,"_levels",null),l([n()],d.prototype,"_numLevels",null),l([n({readOnly:!0})],d.prototype,"_levelsHeight",null),l([n()],d.prototype,"_expandedLevelsHeight",void 0),l([n({readOnly:!0})],d.prototype,"_expandedLevelsMargin",null),l([n({readOnly:!0})],d.prototype,"_levelWidth",null),l([n({readOnly:!0})],d.prototype,"_levelHeight",null),l([n({readOnly:!0})],d.prototype,"_gaussianFactor",null),l([n({readOnly:!0})],d.prototype,"_levelClosestToPointer",null),l([n({type:Number,range:{min:0,max:1}})],d.prototype,"_normalizedPointerPosition",void 0),l([n()],d.prototype,"_hovering",void 0),l([n()],d.prototype,"_containerPosTop",void 0),l([n()],d.prototype,"_levelsContainer",void 0),d=l([_("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],d);const gt=d,_t={nextPhase:"nextPhase",previousPhase:"previousPhase",currentPhase:"{{value}}"},x="esri-building-phase-picker",m={container:`${x}`,phasesContainer:`${x}__phases-container`,phase:`${x}__phase`,phaseActive:`${x}__phase--active`,phaseCurrent:`${x}__phase--current`,divider:`${x}__divider`,dividerActive:`${x}__divider--active`,arrowLeft:`${x}__arrow-left`,arrowRight:`${x}__arrow-right`};let N=class extends F{constructor(t,e){super(t,e),this._phasesContainer=null,this._shouldScrollCurrentPhaseIntoView=!0,this._shouldFocusCurrentPhase=!1,this._onKeyDown=s=>{const{vm:i}=this;switch(s.key){case"ArrowDown":case"ArrowLeft":s.stopPropagation(),s.preventDefault(),i.previous(),this._shouldFocusCurrentPhase=!0;break;case"ArrowUp":case"ArrowRight":s.stopPropagation(),s.preventDefault(),i.next(),this._shouldFocusCurrentPhase=!0}},this._onArrowLeftClick=()=>{this.vm.previous()},this._onArrowRightClick=()=>{this.vm.next()},this._onPhasesContainerAfterCreate=s=>{this._phasesContainer=s,requestAnimationFrame(this._scrollOrFocusPhase)},this._scrollOrFocusPhase=()=>{const s=this._phasesContainer;if(this.destroyed||s==null)return;const i=s.querySelector(`.${m.phaseCurrent}`);if(i){if(this._shouldScrollCurrentPhaseIntoView){const o=s.offsetWidth,r=i.offsetLeft,h=i.offsetWidth;s.scrollLeft=-o/2+r-h/2,this._shouldScrollCurrentPhaseIntoView=!1}this._shouldFocusCurrentPhase&&(i.focus(),this._shouldFocusCurrentPhase=!1)}}}initialize(){this.addHandles($(()=>[this._currentPhase,this._phasesContainer,this.container],()=>{this._shouldScrollCurrentPhaseIntoView=!0,requestAnimationFrame(this._scrollOrFocusPhase)},L))}get _phases(){return this.vm.allowedValues}get _currentPhase(){const{vm:t}=this;return t.enabled?t.value:null}render(){if(this._phases.length<2)return a("div",{key:"no-phases"});const{vm:t,container:e,messages:s}=this,{previousPhase:i,nextPhase:o}=s??_t,r=Z(e);return a("div",{class:this.classes(R.widget,m.container),key:this,onkeydown:this._onKeyDown},a("button",{"aria-label":i,class:r?m.arrowRight:m.arrowLeft,disabled:!t.hasPrevious,onclick:this._onArrowLeftClick,title:i,type:"button"}),a("div",{afterCreate:this._onPhasesContainerAfterCreate,class:m.phasesContainer},this._renderPhaseButtons()),a("button",{"aria-label":o,class:r?m.arrowLeft:m.arrowRight,disabled:!t.hasNext,onclick:this._onArrowRightClick,title:o,type:"button"}))}_renderPhaseButtons(){const t=this._phases,e=this._currentPhase,s=[];for(let i=0;i<t.length;++i){const o=t[i],r={phase:o,active:e!=null&&o<=e,current:e!=null&&o===e};i>0&&s.push(this._renderDivider(r)),s.push(this._renderPhaseButton(r))}return s}_renderPhaseButton({phase:t,active:e,current:s}){const{vm:i}=this,o=i.getValueLabel(t);return a("button",{"aria-label":o,class:this.classes(m.phase,{[m.phaseActive]:e,[m.phaseCurrent]:s}),key:`phase-${t}`,onclick:()=>i.select(t),title:o,type:"button"},t)}_renderDivider({phase:t,active:e}){return a("div",{class:this.classes(m.divider,{[m.dividerActive]:e}),key:`phase-divider-${t}`})}};l([n({nonNullable:!0})],N.prototype,"vm",void 0),l([n()],N.prototype,"messages",void 0),l([n()],N.prototype,"_phases",null),l([n()],N.prototype,"_currentPhase",null),l([n()],N.prototype,"_phasesContainer",void 0),N=l([_("esri.widgets.BuildingExplorer.BuildingPhasePicker.BuildingPhasePicker")],N);const yt=N,ce={levels:!0,phases:!0,disciplines:!0};let p=class extends F{constructor(t,e){super(t,e),this._defaultViewModel=new Ce,this.viewModel=this._defaultViewModel,this.visibleElements={...ce},this.headingLevel=3,this.iconClass=g.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.toggleSiblingsVisibility=!1}destroy(){this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get layers(){return this.viewModel.layers}set layers(t){this.viewModel.layers=t}_castVisibleElements(t){return{...ce,...t}}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}render(){const t=this.viewModel,e=t.state==="disabled"||!t.isSupported;return a("div",{"aria-label":this.messages.widgetLabel,class:D(R.widget,g.base,R.panel,{[R.widgetDisabled]:e}),key:this},this._renderContent())}_renderContent(){const t=this.viewModel,e=this.messages;if(!t.isSupported)return a("p",{class:g.panelError},e.unsupported);if(!t.layers.length)return a("p",{class:g.panelError},e.noData);switch(t.state){case"loading":return this._renderLoadingIndicator();case"ready":return a("div",{class:g.content,key:"content"},this._renderLevelPickerSection(),this._renderPhasePickerSection(),this._renderDisciplinesSection());case"failed":return a("p",{class:g.panelError},e.failed);default:return null}}_renderLoadingIndicator(){const t=this.messagesCommon.loading;return a("div",{"aria-label":t,class:g.loadingContainer,key:"loading-container",role:"presentation",title:t},a("span",{"aria-hidden":"true",class:D(I.loadingIndicator,R.rotating)}))}_renderLevelPickerSection(){var o;const t=this.viewModel.level,e=t.state==="ready",s=t.allowedValues.length>1;if(!this.visibleElements.levels||!e||!s)return null;const i=(o=this.messages)==null?void 0:o.level;return a("div",{class:D(g.section,g.levels),key:"levels"},a(Y,{level:this.headingLevel},i==null?void 0:i.title),a(gt,{messages:i,vm:t}))}_renderPhasePickerSection(){const t=this.viewModel.phase,e=t.state==="ready",s=t.allowedValues.length>1;if(!this.visibleElements.phases||!e||!s)return null;const i=this.messages.phase;return a("div",{class:D(g.section,g.phases),key:"phases"},a(Y,{level:this.headingLevel},i.title),a(yt,{messages:i,vm:t}))}_renderDisciplinesSection(){var o;const t=this.viewModel.disciplines,e=t.state==="ready",s=t.root.hasChildren;if(!this.visibleElements.disciplines||!e||!s)return null;const i=(o=this.messages)==null?void 0:o.disciplines;return a("div",{class:D(g.section,g.disciplines),key:"disciplines"},a(Y,{level:this.headingLevel},i.title),a(dt,{messages:i,toggleSiblingsVisibility:this.toggleSiblingsVisibility,vm:t}))}};l([n({type:Ce})],p.prototype,"viewModel",void 0),l([n()],p.prototype,"view",null),l([n()],p.prototype,"layers",null),l([n()],p.prototype,"visibleElements",void 0),l([Ie("visibleElements")],p.prototype,"_castVisibleElements",null),l([n()],p.prototype,"headingLevel",void 0),l([n()],p.prototype,"iconClass",void 0),l([n()],p.prototype,"icon",void 0),l([n()],p.prototype,"label",null),l([n(),he("esri/widgets/BuildingExplorer/t9n/BuildingExplorer")],p.prototype,"messages",void 0),l([n(),he("esri/t9n/common")],p.prototype,"messagesCommon",void 0),l([n({nonNullable:!0})],p.prototype,"toggleSiblingsVisibility",void 0),l([n()],p.prototype,"uiStrings",void 0),p=l([_("esri.widgets.BuildingExplorer")],p);const gs=p;export{gs as default};
