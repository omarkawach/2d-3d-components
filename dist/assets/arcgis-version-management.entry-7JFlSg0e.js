import{aA as b,aE as k,aC as l,aF as V,aD as y}from"./index-8ERthB3p.js";import{i as E,a3 as L}from"./index-f6afcedb-CZuD5wYN.js";/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.29/esri/copyright.txt for details.
 * v4.29.10
 */function I(e,t){let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i.parentNode instanceof ShadowRoot?i=i.parentNode.host:i=i.parentNode}return!1}function M(e,t,i=()=>{}){if(!t||t.length<=0)return;let n=new MutationObserver(s=>{for(let r of s)I(e,r.target)&&i()});return n.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0}),n}function S(e,t){let i=e;for(;i;){let n=i.closest(t);if(n)return n;let s=i.getRootNode();if(s===document)return null;i=s.host}return null}function C(e,t,i){var n;return((n=S(e,`[${t}]`))==null?void 0:n.getAttribute(t))??i}var w=new Set(["ar","bg","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),h=new Map;async function p(e,t,i=""){let n=`${t}/${i}${e}.json`;if(h.has(n))return h.get(n);try{let s=await fetch(n);if(s.ok){let a=await s.json();return h.set(n,a),a}if(e==="en"){h.set(n,void 0);return}let r=await p("en",t,i);return h.set(n,r),r}catch{h.set(n,void 0);return}}function N(e){let t=C(e,"lang",navigator.language||"en");if(w.has(t))return{lang:t,t9nLocale:t};let i=t.slice(0,2);return{lang:t,t9nLocale:w.has(i)?i:"en"}}var d=new WeakMap,v=new WeakMap,A=new WeakMap;async function F(e,t,i){v.set(e,t),d.set(e,M(e._hostElement,["lang"],()=>{m(e,i).catch(console.error)})),await m(e,i)}function P(e){var t;(t=d.get(e))==null||t.disconnect(),d.delete(e),v.delete(e)}async function m(e,t){let{lang:i,t9nLocale:n}=N(e._hostElement);if(i===e._lang&&n===e._t9nLocale||(i!==e._lang&&(e._lang=i),n===e._t9nLocale))return;let s=A.get(e);if(!s){let r=v.get(e)??"",a=e._hostElement.tagName.toLowerCase().replace("arcgis-",""),o=`${r}/${a}/t9n`,c=`${a}.t9n.`;s=await p(n,o,c)}n!==e._t9nLocale&&(e._t9nLocale=n,e._t9nStrings=s,await(t==null?void 0:t.call(e)))}const T=".div-content{background-color:var(--calcite-ui-foreground-1);padding:0.75rem}.flow-main{width:330px}.notice{width:-webkit-fill-available}.panel-services{max-height:400px}.panel-versions{max-height:400px}",U=class{constructor(e){b(this,e),this._watchHandles=[],this.label=void 0,this.position="top-right",this.view=void 0,this._lang="",this._t9nLocale="",this._t9nStrings=void 0,this.state=void 0}positionWatcher(e){e!==void 0&&this.viewModel&&this.view.ui.move(this._hostElement,e)}async componentDidLoad(){const{watch:e}=await E();this._watchHandles.push(e(()=>this.viewModel.state,t=>{this.state=t}))}async componentWillLoad(){await F(this,k("./assets")),await this._checkForView(),this.viewModel=await L({view:this.view}),this.label=this.label?this.label:this._t9nStrings.label}disconnectedCallback(){P(this),this._watchHandles.forEach(e=>{e.remove()}),this._watchHandles=[]}render(){const{_t9nStrings:e,label:t,viewModel:i,viewModel:{state:n,loadError:s}}=this,r=Array.from(this.viewModel.serviceNameLookup,([a,o])=>({url:a,name:o}));return l(V,null,l("calcite-flow",{ref:a=>{this.flowElement=a},class:"flow-main"},l("calcite-flow-item",{heading:t},l("calcite-panel",{class:"panel-services",loading:n==="loading"},r.map(a=>l("arcgis-version-management-service-item",{flowElement:this.flowElement,heading:t,serviceUrl:a.url,strings:e,viewModel:i,onVersionItemActionClickedEventWithServiceUrl:o=>{this._handleVersionItemActionClick(o,this.flowElement).catch(console.error)},onVersionListActionClickedEvent:o=>{this._handleVersionListActionClick(o,this.flowElement).catch(console.error)}})),n==="disabled"?l("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer"},l("div",{slot:"message"},this._getLoadError(s))):void 0))))}async _checkForView(){const e=this._hostElement.closest("arcgis-map");e!=null&&e.view&&(await e.view.map.load(),this.view=e.view,this.view.ui.add(this._hostElement,this.position))}_createVersionPropertiesFlow(e,t){const{flowElement:i,viewModel:n}=this;if(!i)return null;const s=document.createElement("arcgis-version-management-version-properties");return s.flowElement=i,s.serviceUrl=e,s.strings=this._t9nStrings,s.versionInfo=t,s.viewModel=n,s.addEventListener("versionPropertiesSaveClickedEvent",async r=>{const{serviceUrl:a,versionInfo:o}=r.detail,c=o.versionIdentifier.name,g=c.split(".").length>1?c.split(".")[1]:c,u=c.split(".").length>1?c.split(".")[0]:n.userLookup.get(a);if(o.versionIdentifier.guid===""?await n.createVersion({access:o.access,description:o.description,featureServerUrl:a,ownerName:u,versionName:g}):await n.alterVersion({access:o.access,description:o.description,featureServerUrl:a,ownerName:u,versionIdentifier:{name:"",guid:o.versionIdentifier.guid},versionName:g}),n.state==="ready"){const f=i.getElementsByTagName("arcgis-version-management-version-list")[0];f.versionInfos=[];const _=await n.getVersionInfos(a,!0);f.versionInfos=_,await i.back()}}),s}_getLoadError(e){const{_t9nStrings:t}=this;switch(e){case"no-feature-services":return t.loadErrors.noFeatureServices;case"no-layers-property":return t.loadErrors.noLayersProperty;default:return e}}async _handleVersionItemActionClick(e,t){const{actionType:i,serviceUrl:n,versionInfo:s}=e.detail;switch(i){case"changeVersion":await this._switchToVersion(n,s.versionIdentifier.name,s.versionIdentifier.guid);break;case"editVersion":{const r=this._createVersionPropertiesFlow(n,s);if(!r)break;t==null||t.append(r);break}}}async _handleVersionListActionClick(e,t){var s;const{actionType:i,serviceUrl:n}=e.detail;switch(i){case"newVersion":{const r=this._createVersionPropertiesFlow(n,void 0);if(!r)break;t==null||t.append(r);break}case"refreshVersions":{const r=(s=this.flowElement)==null?void 0:s.getElementsByTagName("arcgis-version-management-version-list")[0];if(!r)break;r.versionInfos=[];const a=await this.viewModel.getVersionInfos(n,!0);r.versionInfos=a;break}}}async _switchToVersion(e,t,i){await this.viewModel.changeVersion(e,t,i)}static get assetsDirs(){return["assets"]}get _hostElement(){return y(this)}static get watchers(){return{position:["positionWatcher"]}}};U.style=T;export{U as arcgis_version_management};
