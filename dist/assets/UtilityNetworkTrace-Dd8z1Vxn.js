function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/calcite-action-ZdVFPgt3.js","assets/action-CR32yz_4.js","assets/jsxFactory-BxQYPm-b.js","assets/index-8ERthB3p.js","assets/index-CzRN3C0i.css","assets/dom-BvFmd0Ey.js","assets/guid-Cgw_FQNn.js","assets/interactive-juHwuDyB.js","assets/loadable-C9pgOBpc.js","assets/locale-czPJjPyG.js","assets/key-wu7cp3Vu.js","assets/observers-hu61Hn6M.js","assets/component-CiBiWYk6.js","assets/t9n-GCZDzKCw.js","assets/icon-DyzVx5Y-.js","assets/loader-DeANvmkY.js","assets/calcite-action-group-CkjR39cc.js","assets/action-group-COr3dt9S.js","assets/conditionalSlot-DvaCB6Om.js","assets/action-menu-BfqOv3CZ.js","assets/array-CG_obv_6.js","assets/popover-CVy_TqWd.js","assets/floating-ui-azNa5k60.js","assets/debounce-Bd3Yf8RP.js","assets/focusTrapComponent-DOljTw4q.js","assets/openCloseComponent-C40eKxzi.js","assets/Heading-CWhq9JWU.js","assets/FloatingArrow-Dv49hS4C.js","assets/calcite-action-pad-DjdXF3S7.js","assets/ExpandToggle-BuE4XGzk.js","assets/calcite-block-81ba3rfb.js","assets/handle-DFlYXJDV.js","assets/scrim-CkNnGmGz.js","assets/calcite-block-section-CeUeqwrZ.js","assets/label-ZryjpMoB.js","assets/label2-D3Hkhas-.js","assets/switch-CyTskBtF.js","assets/form-DjQ2sEGP.js","assets/calcite-button-BGRBzuhy.js","assets/button-Csva0FHl.js","assets/calcite-checkbox-DkooX0M9.js","assets/calcite-color-picker-swatch-DCYE1mcL.js","assets/color-picker-swatch-C7a9Pbb5.js","assets/calcite-combobox-BwRtESI8.js","assets/combobox-BtfO0Bud.js","assets/filter-Dr_d0q4i.js","assets/utils2-QfRR9cW9.js","assets/Validation-BbCdGpug.js","assets/chip-BgfcEeF8.js","assets/combobox-item-Dqga6zMM.js","assets/input-message-DJd4uB0t.js","assets/calcite-combobox-item-C2B5UwPi.js","assets/calcite-flow-xQpOKDcb.js","assets/calcite-flow-item-D1TgTmys.js","assets/panel-DgFCqyCW.js","assets/calcite-icon-DW07N_Fi.js","assets/calcite-input-number-gkEhlGFQ.js","assets/input-number-C1ZRD0fY.js","assets/input-eashyq5M.js","assets/progress-434a5olE.js","assets/calcite-label-CkrtQ7VS.js","assets/calcite-list-DXRoRXYC.js","assets/utils3-Ckz8Mzud.js","assets/input2-KR1QZnYy.js","assets/calcite-list-item-CEYbVI0q.js","assets/calcite-loader-s-EjqyOZ.js","assets/calcite-notice-bdrVVIis.js","assets/calcite-option-BKQ8Tpdp.js","assets/calcite-panel-D3Ac2cuQ.js","assets/calcite-popover-CwWmXud9.js","assets/calcite-scrim-zRqTTpuY.js","assets/calcite-select-D8mWwcXY.js","assets/calcite-tab-_lyJ2SrJ.js","assets/tab-CF7TGhza.js","assets/calcite-tab-nav-DC8nV98J.js","assets/tab-nav-D5YTxiI1.js","assets/calcite-tab-title-BWKuLN4p.js","assets/tab-title-PqV46tvn.js","assets/calcite-tabs-BrlDYi4u.js","assets/tabs-BweKi90C.js","assets/calcite-tooltip-CCCijpCd.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{T as L,dr as O,dq as de,an as pe,a7 as le,e8 as J,ja as j,bE as ge,P as _e,s as Z,cs as W,Z as ye,ap as me,ar as we,Y as fe,ak as ve,o as h,y as u,X as ae,j6 as oe,k3 as ne,f0 as be,Q as Ae,cr as x,_}from"./index-8ERthB3p.js";import{e as B,O as Te,n as a,r as Re,L as Se,i as Fe}from"./jsxFactory-BxQYPm-b.js";import{e as D}from"./globalCss-DfZw-NIf.js";import{e as ke}from"./vmEvent-D4Ubqkbq.js";import ce from"./GraphicsLayer-CapLCpoe.js";import{w as Ie,n as Q,e as Ce}from"./UtilityNetwork-BaSgO-Ex.js";import{t as Me}from"./utils-CPwzm7iO.js";import{trace as Ge}from"./trace-YLHAIzb8.js";import{u as Ee,a as X}from"./TraceParameters-oPPWWyeZ.js";import{geodesicBuffer as Y,buffer as K,convexHull as H,geodesicArea as Ne,planarArea as Pe,cut as ee,planarLength as M}from"./geometryEngine-MBwx6Ib1.js";import"./GraphicsCollection-CKieR40M.js";import"./utils-1zmckiYC.js";import"./geometryEngineBase-Cz__5BKm.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-7yclY7Co.js";function V(e){return e.type==="polygon"||e.type==="polyline"}function Le(e){return e.hasOwnProperty("points")}function Oe(e){return Le(e)&&e.points.length===2}class he{createBuffer(t,s,i,l){if(Array.isArray(t)){if(t.length>0){const o=L.fromJSON(t[0].spatialReference);return o.isWGS84||o.isWebMercator?Y(t,s,i):K(t,s,i,l)}return}const r=L.fromJSON(t.spatialReference);return r.isWGS84||r.isWebMercator?Y(t,s[0],i):K(t,s[0],i)}createConvexHull(t){if(Array.isArray(t)){if(t.length===1&&Oe(t[0])){const i=H(t[0]);if(V(i))return i}return H(t,!0).filter(V)}const s=H(t);if(V(s))return s}calculateArea(t,s){const i=new L({wkid:t.spatialReference.wkid});return i.isWGS84||i.isWebMercator?parseFloat(Ne(t,s).toFixed(2)):parseFloat(Pe(t,s).toFixed(2))}mergeAggregatedToGeometries(t){const s=[],{line:i,multipoint:l,polygon:r}=t;return i&&s.push(i),l&&s.push(l),r&&s.push(r),s}getPercentageAlong(t,s,i){let l=t;const r=this._createPolyline(t.paths,i.wkid);if(s.type==="point"){const n=s.x-5,c=s.x+5,p=[[n,s.y-5],[c,s.y+5]];l=this._createPolyline(p,s.spatialReference.wkid),l=O(l,i);const g=ee(r,l);if(g.length>0){const y=M(r,"feet");let m;return m=g[0].paths[0][0][0]===r.paths[0][0][0]?M(g[0],"feet"):M(g[1],"feet"),[m/y]}return[.5]}l=O(s,i);const o=ee(r,l);if(o.length>0){const n=M(r,"feet");return[M(o[0],"feet")/n]}return[.5]}async projectGeometry(t,s){return await de(),O(t,s)}_createPolyline(t,s){return new pe({hasZ:!1,hasM:!0,paths:t,spatialReference:{wkid:s}})}}const xe=[227,27,21,.6],Be=[21,244,21,.6],P=12,q=[{color:[255,0,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff0000"},{color:[255,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff00ff"},{color:[217,188,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#D9BCFF"},{color:[0,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#00ff00"},{color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ffff00"},{color:[0,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#0000ff"},{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},{color:[0,0,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#000000"}];class De{constructor(){this.highlightColor=[...q]}addCustomColor(t){this.highlightColor=[...q],this.highlightColor.some(s=>s.hex.toLowerCase()===t.hex.toLowerCase())||this.highlightColor.push(t)}getFlagGraphic(t,s,i,l){const r=s==="starting-point"?Be:xe;if(t.type==="polygon"){const o=t;o.centroid&&(t=o.centroid)}return l?this.makeGraphic(t,r,i==null?void 0:i.attributes,null,l):this.makeGraphic(t,r,i==null?void 0:i.attributes)}makeGraphic(t,s,i,l,r){let o,n=t;switch(t.type){case"multipoint":o={type:"simple-marker",color:s,size:P,outline:{color:s,width:0}},l&&(n=t);break;case"point":o=r||{type:"simple-marker",color:s,size:P,outline:{color:s,width:0}},l&&(n=t);break;case"polyline":o={type:"simple-line",color:s,width:P},l&&(n=t);break;case"polygon":o={type:"simple-fill",color:s,outline:{color:s,width:P}},l&&(n=t)}return new le({geometry:n,symbol:o,attributes:i??null})}}const S=`utility-network-trace-result-area-${Date.now()}`;function G(e){return e.type==="graphics"}class He{constructor(){this.traceInformation={},this._geometryHandler=new he}addResultAreaToMap(t,s){const i=this.createGraphicLayer(s);i&&G(i)&&i.add(t)}changeResultAreaColor(t,s,i){const l=new J({color:s.color,style:"solid",outline:{color:s.color,width:1}}),r=this._findGraphicsByTraceId(t,i);return r&&r.forEach(o=>{o.symbol=l}),l}createBuffer(t,s,i,l){return this._geometryHandler.createBuffer(t,s,i,l)}createConvexHull(t,s,i){const l=this._geometryHandler.createConvexHull(t);return s>0&&l?this.createBuffer(l,[s],i,!1):l}createResultAreaGraphic(t,s,i,l,r,o){var p;const n=new J({color:o.color,style:"solid",outline:{color:o.color,width:1}}),c=[];for(const g in s)c.push({fieldName:g,label:g==="areaStatistic"?l.attributeStrings[g]+" ("+((p=r.units[i])==null?void 0:p.abbr)+")":l.attributeStrings[g],value:s[g]});return new le({geometry:t,symbol:n,attributes:s,popupTemplate:{title:s.traceName,content:[{type:"fields",fieldInfos:c}]}})}removeResultArea(t,s){const i=s.findLayerById(S);if(i&&G(i)){const l=this._findGraphicsByTraceId(t,s);return l&&i.removeMany(l),l}return null}removeAllResultAreaGraphics(t){if(t){const s=t.findLayerById(S);s&&G(s)&&s.removeAll()}}createGraphicLayer(t,s){const i=t.findLayerById(S);if(i&&G(i))return i;const l=new ce({title:s??S,listMode:"hide",id:S});return t.add(l),l}_findGraphicsByTraceId(t,s){const i=s.findLayerById(S);if(i&&G(i)){const l=i.graphics.filter(r=>r.attributes.traceId===t);return l.length>0?l.toArray():null}return null}}function te(e){return e.type==="feature"}function $(e,t){return e.url.includes(t)}function se(e,t){var s;return(((s=e.dataElement)==null?void 0:s.domainNetworks)||[]).some(i=>i.subnetworkLayerId===t.layerId)}class Ve{getValidUtilityNetworkLayers(t,s){const i=[];return t==null||t.allLayers.forEach(l=>{l.type==="group"?i.push(...l.layers.filter(j).filter(r=>te(r)&&s.isUtilityLayer(r)&&!se(s,r)).filter(r=>$(r,s.featureServiceUrl)).toArray()):l.type==="subtype-group"?i.push(...l.sublayers.filter(r=>$(r,s.featureServiceUrl)).toArray()):j(l)&&te(l)&&s.isUtilityLayer(l)&&!se(s,l)&&$(l,s.featureServiceUrl)&&i.push(l)}),i}}const $e=()=>oe("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),Ue=()=>oe("esri/core/t9n/Units"),E=`utility-network-trace-flags-${Date.now()}`,N=`utility-network-trace-results-${Date.now()}`;function je(e){return e instanceof ne}function We(e){return e.layer.type==="feature"||e.layer.type==="subtype-group"}function qe(e){return"layer"in e}function ze(e){return e.layerViews!==void 0}function Je(e){return e.type==="graphics"}async function Ze(e){var i;const t=new be({url:e.networkSystemLayers.dirtyAreasLayerUrl});await t.load();const s=t.version;if(Number(s)<=11.1){const l=new Ae({url:new URL(e.layerUrl).origin+"/portal"});await l.load();const r=(i=l==null?void 0:l.user)==null?void 0:i.username;return!!r&&Me(l,r,"utilityNetwork")}return!0}let w=class extends ge.EventedAccessor{constructor(e){super(e),this._activeProgress=!1,this._clickHandler=null,this._flags=[],this._flagId=0,this._geometryHandler=null,this._highlightHandler=[],this._resultAreaHandler=null,this._utilityHelper=new Ve,this._watchHandler=null,this._validUNLayers=[],this._traceTimeout=6e5,this.traces=[],this.graphicHandler=null,this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.enableResultArea=!1,this.flags=[],this.gdbVersion="sde.DEFAULT",this.messages=null,this.messagesUnits=null,this.defaultResultAreaProperties={type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1},this.selectedTraces=[],this.selectOnComplete=!0,this.showGraphicsOnComplete=!0,this.showSelectionAttributes=!0,this.traceResults=[],this.utilityNetwork=null}initialize(){this._geometryHandler=new he,this.graphicHandler=new De,this._resultAreaHandler=new He,(async()=>{const[e,t]=await Promise.all([$e(),Ue()]);this.set({messages:e,messagesUnits:t})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(e){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...e}),this.graphicHandler.addCustomColor(this.resultAreaProperties.color),this.traceResults.forEach(t=>{var i;const s=(i=t.resultArea)==null?void 0:i.show;t.resultArea={...this.defaultResultAreaProperties,...e},this.removeResultAreaFromMap(t),this.enableResultArea&&this.createResultAreaGraphic(t).then(l=>{if(l){t.resultAreaGraphic=l;const r=(e==null?void 0:e.show)??s;t.resultArea&&(t.resultArea.show=r),r&&this.addResultAreaToMap(t,l)}})})}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"loading"}get view(){return this._get("view")}set view(e){e&&e.type!=="2d"&&_e.getLogger(this).error(new Z("view:invalid-view","SceneView is not supported",{view:e})),this._set("view",e),this.utilityNetwork&&this.reset(),this.utilityNetwork=null,this.loadUtilityNetwork().then(t=>{t&&this.selectTracesOnLoad()})}addFlagByHit(e,t){const s=i=>{var l;(l=this.view)!=null&&l.popup&&(this.view.popupEnabled=i)};return new Promise((i,l)=>{var r,o;s(!1),(r=this._clickHandler)==null||r.remove(),this.emit("add-flag",{type:e}),this._clickHandler=(o=this.view)==null?void 0:o.on("click",n=>{this.queryFlagByHitTest(n,e,t).then(c=>{var p;s(!0),(p=this._clickHandler)==null||p.remove(),this.emit("add-flag-complete",{type:e,symbol:t}),i(c)}).catch(c=>{var p;s(!0),(p=this._clickHandler)==null||p.remove(),this.emit("add-flag-error",{type:e,symbol:t}),l(c)})})})}async addFlagsOnLoad(){return new Promise(e=>{const t=[];this._watchHandler=W(()=>this.view!=null&&!this.view.updating,async()=>{if(this._flags.length>0)e(t);else{const s=this.flags.map(async i=>{if(i.mapPoint){const l=new ye({x:i.mapPoint.x,y:i.mapPoint.y,spatialReference:i.mapPoint.spatialReference.wkid}),r={screenPoint:this.view.toScreen(l),mapPoint:l};await this.queryFlagByHitTest(r,i.type)||(i.type==="barrier"?t.push("barrier"):t.push("starting-point"))}});await Promise.all(s),e(t)}},{initial:!0})})}async addResultAreaToMap(e,t){var s,i;if(this.view){if(e.resultArea.show=!0,t)(s=this._resultAreaHandler)==null||s.addResultAreaToMap(t,this.view.map),this.emit("add-result-area",{graphic:t});else if(e.results){const l=await this.createResultAreaGraphic(e);l&&(e.resultAreaGraphic=l,(i=this._resultAreaHandler)==null||i.addResultAreaToMap(l,this.view.map),this.emit("add-result-area",{graphic:l}))}}}async addResultGraphicToView(e,t){var l;const{view:s}=this,{results:i}=e;if(s&&i&&this.utilityNetwork){for(const r in i.aggregatedGeometry)if("line,multipoint,polygon".includes(r)){const o=r,n=i.aggregatedGeometry[o];if(n!=null){n.spatialReference=this.utilityNetwork.spatialReference,e.graphicEnabled=!0;const c=await this._geometryHandler.projectGeometry(n,s.spatialReference),p={globalid:e.trace.globalId};if(c!==null){const g=this.graphicHandler.makeGraphic(c,t.color,p,s.spatialReference);(l=this._getGraphicLayer(N))==null||l.add(g)}}}}}addTerminal(e,t){const s=[...this._flags];s.forEach(i=>{var l,r;i.globalId===t.globalId&&((l=t.selectedTerminals)!=null&&l.includes(parseInt(e,10))||((r=i.selectedTerminals)==null||r.push(parseInt(e,10))))}),this._flags=s}async callTrace(){const e=this.traces.filter(t=>t.selected);return e.length>0&&(this.traceResults.length>0&&this.traceResults.forEach(t=>{this.removeResultGraphicFromView(t)}),this.traceResults=[],this.removeSelection(),await Promise.all(e.map(async(t,s)=>{var r;const i=t,l=new Ee({gdbVersion:this.gdbVersion,moment:null,traceType:i.traceType,traceLocations:this._flags,namedTraceConfigurationGlobalId:i.globalId,traceConfiguration:null,outSpatialReference:null,resultTypes:null});await this.executeTrace(i,(r=this.utilityNetwork)==null?void 0:r.networkServiceUrl,l).then(o=>{if(o.hasOwnProperty("results")){const n={...o};if(n.results!==null){n.resultArea={...this.resultAreaProperties};const c=[...n.results.elements];n.results.elements.length=0;const p=new Map;for(const y of c)p.has(y.globalId)||(p.set(y.globalId,!0),n.results.elements.push(y));const g=[...this.traceResults];g.splice(s,0,n),this.traceResults=g,n.results!==null&&(this.selectOnComplete&&this.mergeSelection(!0,n.trace),this.showGraphicsOnComplete&&this.addResultGraphicToView(n,n.graphicColor),this.enableResultArea&&this.createResultAreaGraphic(n).then(y=>{var m;y&&(n.resultAreaGraphic=y,(m=n.resultArea)!=null&&m.show&&this.addResultAreaToMap(n,n.resultAreaGraphic))}))}else{const c=[...this.traceResults];c.splice(s,0,o),this.traceResults=c}this._activeProgress=!1}else{this._activeProgress=!1;const n=[...this.traceResults];n.splice(s,0,o),this.traceResults=n}}).catch(o=>{throw this._activeProgress=!1,o})})),!0)}changeResultAreaColor(e,t){var i;if(!e.resultArea)return;e.resultArea.color=t;const s=(i=this._resultAreaHandler)==null?void 0:i.changeResultAreaColor(e.trace.globalId,t,this.view.map);e.resultAreaGraphic&&(e.resultAreaGraphic.symbol=s)}changeResultGraphicColor(e,t){const s=[...this.traceResults];s.length>0&&s.forEach(i=>{i.trace.globalId===t.trace.globalId&&(i.graphicColor=e,i.graphicEnabled=!0)}),this.traceResults=s,this.removeResultGraphicFromView(t),this.addResultGraphicToView(t,e)}changeFlagSymbol(e,t){this._flags.length>0&&this._flags.forEach(s=>{s.type===e&&t&&s.mapGraphic&&(s.mapGraphic.symbol=t)})}checkCanTrace(){const e={status:!0,issues:[]};let t=!1;const s=this._flags.some(r=>r.type==="starting-point"),i=this._flags.filter(r=>r.allTerminals!==null);i.length>0&&(t=i.some(r=>r.selectedTerminals.length<=0));let l=[];return s?(l=this.traces.filter(r=>r.selected),l.length<=0?(e.status=!1,e.issues=["noTrace"],t&&(e.status=!1,e.issues=["noTrace","noTerminalSelected"])):t&&(e.status=!1,e.issues=["noTerminalSelected"])):(l=this.traces.filter(r=>r.selected===!0),l.length>0?(e.status=!1,e.issues=["noStart"],t&&(e.status=!1,e.issues=["noStart","noTerminalSelected"])):(e.status=!1,e.issues=["noStart","noTrace"],t&&(e.status=!1,e.issues=["noStart","noTrace","noTerminalSelected"]))),e}checkSelectionExist(){return this._highlightHandler.some(e=>e)}clearResult(e){if(!this.view)return;let t=this.traceResults;if(t.length>0){const s=t.filter(i=>i.trace.globalId===e.globalId);s.length>0&&(this.removeResultGraphicFromView(s[0]),this.removeResultAreaFromMap(s[0])),t=t.filter(i=>i.trace.globalId!==e.globalId)}this.traceResults=t,t.length===0?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,e)}createResultAreaGeometries(e,t,s){var l,r,o,n,c,p,g,y,m,A,F,k,I,C;if(!this.view||!this.resultAreaProperties)return;let i;if(((l=this.resultAreaProperties)==null?void 0:l.type)==="convexhull"?i=t.length===1&&(me(t[0])||we(t[0])&&t[0].points.length===1)?(o=this._resultAreaHandler)==null?void 0:o.createBuffer(t,s,(r=e.resultArea)==null?void 0:r.unit,!0):(p=this._resultAreaHandler)==null?void 0:p.createConvexHull(t,(n=e.resultArea)==null?void 0:n.distance,(c=e.resultArea)==null?void 0:c.unit):t&&(i=(y=this._resultAreaHandler)==null?void 0:y.createBuffer(t,s,(g=e.resultArea)==null?void 0:g.unit,!0)),i&&Array.isArray(i)){if(i.length>0)for(const R of i){const f=this.getResultAreaAttributes(e,R),T=(F=this._resultAreaHandler)==null?void 0:F.createResultAreaGraphic(R,f,(m=e.resultArea)==null?void 0:m.areaUnit,this.messages,this.messagesUnits,(A=e.resultArea)==null?void 0:A.color);if(T)return T}}else{const R=this.getResultAreaAttributes(e,i),f=(C=this._resultAreaHandler)==null?void 0:C.createResultAreaGraphic(i,R,(k=e.resultArea)==null?void 0:k.areaUnit,this.messages,this.messagesUnits,(I=e.resultArea)==null?void 0:I.color);if(f)return f}}async createResultAreaGraphic(e){var t;if(e.results){const s=await this._createResultAreaInputGeometry(e.results);if(s.length>0){const i=Array(s.length).fill((t=e.resultArea)==null?void 0:t.distance),l=this.createResultAreaGeometries(e,s,i);return this.emit("create-result-area",{graphic:l}),l}}}executeTrace(e,t,s){const i=this._processFlags(s.traceLocations);return s.traceLocations=i,Ge(t,s,{timeout:this._traceTimeout}).then(l=>({trace:e,results:l,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date})).catch(l=>({trace:e,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:l.message,date:new Date}))}getResultAreaAttributes(e,t){var r,o,n;const{messages:s}=this,i=[],l=[];return this._flags.forEach(c=>{var g,y,m,A;const p=((g=c.displayValue)==null?void 0:g.field)+":"+((y=c.displayValue)==null?void 0:y.value)+";"+s.attributeStrings.globalid+":"+c.globalId+";"+s.attributeStrings.terminalid+":"+c.terminalId+";"+s.attributeStrings.x+":"+((m=c.mapPoint)==null?void 0:m.x)+";"+s.attributeStrings.y+":"+((A=c.mapPoint)==null?void 0:A.y);c.type==="starting-point"?i.push(p):l.push(p)}),{traceId:e.trace.globalId,traceName:e.trace.title,traceDescription:e.trace.description??"",startingPoints:i.toString(),barriers:l.toString(),version:this.gdbVersion,username:fe.credentials[0].userId,date:e.date,elementCount:(r=e.results)==null?void 0:r.elements.length,functionResult:JSON.stringify((o=e.results)==null?void 0:o.globalFunctionResults),areaStatistic:t?this._geometryHandler.calculateArea(t,(n=e.resultArea)==null?void 0:n.areaUnit):0}}getValidSources(){var s,i;let e=[];const t=((i=(s=this.utilityNetwork)==null?void 0:s.dataElement)==null?void 0:i.domainNetworks)??[];for(const l of t)e=e.concat(l.junctionSources),e=e.concat(l.edgeSources);return e}groupResultsByNetworkSource(e){return e.length===0?[]:this._groupBy(e,"networkSourceId")}async loadUtilityNetwork(){var i;const{view:e}=this;if(!e)return null;if(await e.when(),this.utilityNetwork){if(this.utilityNetwork.loaded||await this.utilityNetwork.load(),this.utilityNetwork instanceof Ie){try{await e.map.loadAll(),this._loadUNSupportItems()}catch{this._loadUNSupportItems()}return this.utilityNetwork}return null}const t=e.map,s=(i=t.utilityNetworks)==null?void 0:i.at(0);if(s){if(await s.load(),this.utilityNetwork=s,!await Ze(s))throw new Z("utility-network:no-user-type-extension","User type extension not found");try{await t.loadAll(),this._loadUNSupportItems()}catch{}finally{this._loadUNSupportItems()}return s}return null}manageFilterBarrier(e,t){const s=[...this._flags];s.forEach(i=>{i.globalId===t.globalId&&t.type==="barrier"&&i.id===t.id&&(i.isFilterBarrier=e)}),this._flags=s}mergeSelection(e,t){let s=[];const i=[...this.traceResults],l=t.globalId;i.forEach(r=>{var o,n;l===r.trace.globalId&&(r.selectionEnabled=e),r.selectionEnabled&&((o=r.results)==null?void 0:o.elements)!==null&&(s=[...s,...((n=r.results)==null?void 0:n.elements)??[]])}),this.selectResults([...new Set(s)])}async queryFeaturesById(e){var o;const{view:t}=this;if(!t||!this.utilityNetwork)return null;const s=Q(this.utilityNetwork,e),i={layerUrl:s[0].layerUrl,objectIds:s[0].objectIds,outFields:["*"]},l=((o=t.map)==null?void 0:o.allTables.toArray().filter(n=>{var c;return((c=n==null?void 0:n.parsedUrl)==null?void 0:c.path)===s[0].layerUrl}).filter(j))??[];this._getUniqueMapLayerViews(t).filter(({layer:n})=>{var c;return((c=n==null?void 0:n.parsedUrl)==null?void 0:c.path)===s[0].layerUrl}).forEach(({layer:n})=>{n.type!=="feature"&&n.type!=="subtype-group"||l.push(n)});const r=(await Promise.all(l.map(async n=>{const c={layers:new ve([n]),layerInfos:[i],returnGeometry:!0,outSpatialReference:t.spatialReference},[p]=await Ce(c,!1);return p}))).filter(({featureSet:n})=>n.features.length>0);return r.length>0?r:null}queryFlagByHitTest(e,t,s){return this._lookupFlagByHit(e).then(i=>{const{view:l}=this;if(!l)return!1;if(i.length>0){const r=[...this._flags],o=s;return i.forEach(n=>{var g,y;const c=n.graphic,p=c.attributes.hasOwnProperty("GLOBALID")?c.attributes.GLOBALID:c.attributes.globalid;if(r.filter(m=>m.globalId===p).length<=0){const m=this.graphicHandler.getFlagGraphic(c.mapPoint,t,c,o);(g=this._getGraphicLayer(E))==null||g.add(m),r.push({...c,type:t,globalId:c.attributes.globalid||c.attributes.GLOBALID,details:c,mapGraphic:m,id:this._uniqueFlagId})}else if(c.percentAlong!==null){const m=this.graphicHandler.getFlagGraphic(c.mapPoint,t,c,o);(y=this._getGraphicLayer(E))==null||y.add(m),r.push({...c,type:t,globalId:c.attributes.globalid||c.attributes.GLOBALID,details:c,mapGraphic:m,id:this._uniqueFlagId})}}),this._flags=r,!0}return!1})}removeResultGraphicFromView(e){var l;const{view:t}=this;if(!t)return;const s=(l=this._getGraphicLayer(N))==null?void 0:l.graphics;e.graphicEnabled=!1;const i=s==null?void 0:s.filter(r=>r.attributes[r.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===e.trace.globalId);i==null||i.forEach(r=>{var o;(o=this._getGraphicLayer(N))==null||o.remove(r)})}removeFlag(e){const t=this._flags.filter(s=>{if(s.id!==e.id)return s});this._removeGraphic(e),this._flags=t}removeAllResultAreaGraphics(){var e;(e=this._resultAreaHandler)==null||e.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(e){var t,s;if(e.resultArea){e.resultArea.show=!1;const i=(s=this._resultAreaHandler)==null?void 0:s.removeResultArea(e.trace.globalId,(t=this.view)==null?void 0:t.map);i&&this.emit("remove-result-area",{graphic:i})}}removeSelection(){this._highlightHandler.forEach(e=>{e&&e.remove()}),this._highlightHandler=[]}removeTerminal(e,t){const s=[...this._flags];s.forEach(i=>{var l,r;if(i.globalId===t.globalId&&((l=t.selectedTerminals)!=null&&l.includes(parseInt(e,10)))){const o=t.selectedTerminals.indexOf(parseInt(e,10));(r=i.selectedTerminals)==null||r.splice(o,1)}}),this._flags=s}removeFlagsOnLoadWatcher(){this._watchHandler&&this._watchHandler!==null&&this._watchHandler.remove()}reset(){var t,s;this._flags=[],this.traceResults=[];const e=[...this.traces];e.forEach(i=>{i.selected=!1}),this.traces=e,this.view&&((t=this._getGraphicLayer(N))==null||t.removeAll(),(s=this._getGraphicLayer(E))==null||s.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}))}selectFeaturesById(e){const{view:t}=this;if(!t||!this.utilityNetwork)return;const s=Q(this.utilityNetwork,e);this._getUniqueMapLayerViews(t).forEach(i=>{var l,r;qe(i)&&((r=(l=i.layer)==null?void 0:l.parsedUrl)==null?void 0:r.path)===s[0].layerUrl&&We(i)&&this._highlightHandler.push(i.highlight(s[0].objectIds))})}selectResults(e){if(e.length>0){this.removeSelection();const t=this.groupResultsByNetworkSource(e),s=[];for(const i in t)this.selectFeaturesById(t[i]),s.push(this.queryFeaturesById(t[i]));Promise.all(s).then(i=>{this.emit("select-features",{resultSet:i})})}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(e,t){const s=[...this.traces];s.forEach(i=>{t===i.globalId&&(i.selected=e)}),this.traces=s}selectTracesOnLoad(){var e;(e=this.utilityNetwork)!=null&&e.hasOwnProperty("sharedNamedTraceConfigurations")&&(this.traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this.traces.forEach(t=>{t.selected=!1,this.selectedTraces.includes(t.globalId)&&(t.selected=!0)}))}zoomToAsset(e){var t;(t=this.view)==null||t.goTo(e).catch(s=>console.error(s))}async _createResultAreaInputGeometry(e){if(e.aggregatedGeometry!=null)return this._geometryHandler.mergeAggregatedToGeometries(e.aggregatedGeometry);const t=this.groupResultsByNetworkSource(e.elements),s=[];for(const i in t)s.push(this.queryFeaturesById(t[i]));try{const i=await Promise.all(s),l=[];for(const r of i)if(r)for(const o of r)for(const n of o.featureSet.features)l.push(n.geometry);return l}catch{return[]}}_loadUNSupportItems(){var s;if(!this.utilityNetwork)return;const{map:e}=this.view,{messages:t}=this;this._populateOutfields(),this._createGraphicLayer(E),this._createGraphicLayer(N),(s=this._resultAreaHandler)==null||s.createGraphicLayer(e,t==null?void 0:t.alertsStrings.genericResultHeader),this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(e,this.utilityNetwork)}_getUniqueMapLayerViews(e){const t=[];return e.layerViews.filter(({layer:{type:s}})=>s==="feature"||s==="group"||s==="subtype-group").toArray().forEach(s=>{switch(s.layer.type){case"group":if(ze(s))for(const i of s.layerViews)t.push(i);break;case"subtype-group":t.push(s);break;default:t.some(i=>i.layer.id===s.layer.id)||t.push(s)}}),t}_processFlags(e){const t=[];return e.forEach(s=>{if(s.selectedTerminals!==null&&s.selectedTerminals.length>0)s.selectedTerminals.forEach(i=>{const l=new X({globalId:s.globalId,percentAlong:s.percentAlong,terminalId:i,type:s.type,isFilterBarrier:s.isFilterBarrier});t.push(l)});else{const i=new X({globalId:s.globalId,percentAlong:s.percentAlong,terminalId:null,type:s.type,isFilterBarrier:s.isFilterBarrier});t.push(i)}}),t}_getDisplayField(e){var t;return((t=e==null?void 0:e.layer)==null?void 0:t.type)==="subtype-sublayer"?this._getDisplayFieldBySublayer(e):this._getDisplayFieldByFeatureLayer(e)}_getDisplayFieldBySublayer(e){let t="",s="";const i=e.layer;t=this._checkParentForData(i,"displayField");for(const l in e.attributes){const r=l.toLowerCase();r===(t==null?void 0:t.toLowerCase())?(s=e.attributes[l],r==="assetgroup"||r==="assettype"?s=this._checkSubtype(i,i.subtypeCode):(s=this._checkDomain(i.fields,l,s),typeof s=="string"&&(s=this._defaultDisplayField(s,i)))):(s=this._checkDomain(i.fields,l,s),typeof s=="string"&&(s=this._defaultDisplayField(s,i)))}return{field:t,value:s.toString()}}_getDisplayFieldByFeatureLayer(e){var l,r;const t=e.layer;let s=t.displayField,i="";for(const o in e.attributes){const n=o.toLowerCase();if(n===(s==null?void 0:s.toLowerCase()))if(i=e.attributes[o],n==="assetgroup"||n==="assettype"){let c=e.attributes[t.typeIdField.toUpperCase()];c||(c=e.attributes[t.typeIdField.toLowerCase()]),s=t.typeIdField,i=this._checkSubtype(t,c),s===""&&(t.templates&&t.templates.length>0?(s=(l=t.templates[0])==null?void 0:l.name,i=(r=t.templates[0])==null?void 0:r.name):(s=t.displayField,i=e.attributes[o]))}else i=this._checkDomain(t.fields,o,i),typeof i=="string"&&(i=this._defaultDisplayField(i,t));else i=this._checkDomain(t.fields,o,i),typeof i=="string"&&(i=this._defaultDisplayField(i,t))}return{field:s,value:i?i.toString():""}}_checkSubtype(e,t){let s=t;if(e.type==="subtype-sublayer"){const i=this._checkParentForData(e,"subtypes");(i==null?void 0:i.length)>0&&i.forEach(l=>{l.code===t&&(s=l.name)})}else if(e.types!=null&&e.types.length>0){const i=e.types.filter(l=>l.id===t);i.length>0&&(s=i[0].name)}return s}_checkDomain(e,t,s){var r;let i=s;const l=e.filter(o=>o.name.toLowerCase()===t.toLowerCase());if(l.length>0&&je(l[0].domain)&&((r=l[0].domain)!=null&&r.codedValues)){const o=l[0].domain.codedValues.filter(({code:n})=>n===s);o.length>0&&(i=o[0].name)}return i}_checkParentForData(e,t){var s;return((s=e.parent)==null?void 0:s[t])??null}_defaultDisplayField(e,t){var s;return e.trim()?e:t.templates&&((s=t.templates)==null?void 0:s.length)>0?t.templates[0].name:t.title}get _uniqueFlagId(){return this._flagId++}_groupBy(e,t){return e.reduce((s,i)=>((s[i[t]]=s[i[t]]||[]).push(i),s),{})}async _lookupFlagByHit(e){var i,l;if(e.mapPoint==null)return[];const t=await this.view.hitTest(e.screenPoint,{include:this._validUNLayers}),s=[];if(t.results.length>0){const r=t.results.find(o=>o.layer!==null);if(((i=r.graphic)==null?void 0:i.geometry)!=null){if(r.graphic.geometry.type==="polyline"){const o=this._geometryHandler.getPercentageAlong(r.graphic.geometry,e.mapPoint,r.graphic.geometry.spatialReference),n=this._getDisplayField(r.graphic);r.graphic.terminalId=null,r.graphic.isFilterBarrier=!1,r.graphic.allTerminals=null,r.graphic.selectedTerminals=null,r.graphic.percentAlong=o,r.graphic.displayValue=n,r.graphic.mapPoint=r.mapPoint,s.push(r)}else if((r.graphic.geometry.type==="point"||r.graphic.geometry.type==="polygon")&&this.utilityNetwork!==null){const o=(l=this.utilityNetwork)==null?void 0:l.getTerminalConfiguration(r.graphic),n=this._getDisplayField(r.graphic);r.graphic.terminalId=o?o.terminals[0].id||null:1,r.graphic.isFilterBarrier=!1,r.graphic.allTerminals=o??null,r.graphic.selectedTerminals=[o?o.terminals[0].id||null:1],r.graphic.percentAlong=null,r.graphic.displayValue=n,r.graphic.mapPoint=r.mapPoint,s.push(r)}}}return s}async _populateOutfields(){var s;const e=(s=this.view)==null?void 0:s.map,t=this.getValidSources();e==null||e.layers.forEach(i=>{i.type==="group"?i.layers.forEach(l=>{t.some(r=>r.layerId===l.layerId)&&l.fields.some(r=>r.name.toLowerCase()==="assetgroup")&&(l.outFields=["assetgroup","assettype","globalid","objectid"])}):t.some(l=>l.layerId===i.layerId)&&i.fields.some(l=>l.name.toLowerCase()==="assetgroup")&&(i.outFields=["assetgroup","assettype","globalid","objectid"])})}_removeGraphic(e){var t;(t=this._getGraphicLayer(E))==null||t.remove(e.mapGraphic)}_createGraphicLayer(e){const{map:t}=this.view;if(!t.findLayerById(e)){const s=new ce({title:e,listMode:"hide",id:e});t.add(s)}}_getGraphicLayer(e){const{map:t}=this.view;if(t){const s=t.findLayerById(e);if(s&&Je(s))return s}return null}};h([u()],w.prototype,"_activeProgress",void 0),h([u()],w.prototype,"_flags",void 0),h([u()],w.prototype,"traces",void 0),h([u()],w.prototype,"defaultGraphicColor",void 0),h([u()],w.prototype,"enableResultArea",void 0),h([u()],w.prototype,"flags",void 0),h([u()],w.prototype,"gdbVersion",void 0),h([u()],w.prototype,"messages",void 0),h([u()],w.prototype,"messagesUnits",void 0),h([u()],w.prototype,"resultAreaProperties",null),h([u()],w.prototype,"selectedTraces",void 0),h([u()],w.prototype,"selectOnComplete",void 0),h([u()],w.prototype,"showGraphicsOnComplete",void 0),h([u()],w.prototype,"showSelectionAttributes",void 0),h([u({readOnly:!0})],w.prototype,"state",null),h([u()],w.prototype,"traceResults",void 0),h([u()],w.prototype,"utilityNetwork",void 0),h([u({value:null})],w.prototype,"view",null),w=h([ae("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],w);const ue=w,b="esri-utility-trace-network",v={base:b,widgetIcon:Fe.polyline,loaderContainer:`${b}__loader-container`,loader:`${b}__loader`,fadeIn:`${b}--fade-in`,addButtonContainer:`${b}__add-button-container`,noticeContainer:`${b}__notice-container`,listContainer:`${b}__list-container`,resultsContainer:`${b}__results-container`,flow:`${b}__flow`,numberInput:`${b}__number-input`,clearPrompt:`${b}__reset-prompt`,promptDivider:`${b}__divider`,paddingTop:`${b}__padTop`},Qe="esri.widgets.UtilityNetworkTrace";function Xe(e){return{height:e+"px"}}function Ye(e){return{width:e+"px"}}function Ke(){return{width:"75%"}}function ie(){return{textAlign:"center",padding:"1rem"}}function et(e){return{width:"100%",height:window.getComputedStyle(e).getPropertyValue("max-height")}}function U(){return{height:"100%"}}function re(e){return{display:"flex",flexDirection:e}}function tt(e){return e instanceof ne}const st={noExtension:-2147208474};let d=class extends Te{constructor(e,t){super(e,t),this._selectToolActive=!1,this._activeTrace=null,this._activeSwatch="",this._traceHeaderForFlow="",this._assetGroupHeader="",this._assetTypeHeader="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this._activeTab="input",this._flagViewType="starting-point",this._alertRemoveModal=!1,this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoStartAssetFound=!1,this._warningNoBarrierAssetFound=!1,this._warningNoTerminal=!1,this._confirmReset=!1,this._showResultOptions=!1,this._resultObjectIdField="objectid",this._resultDisplayField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._swatchNode=null,this._individualResultNode=null,this._symbolStartFlag=null,this._symbolBarrier=null,this._watchHandler=null,this._loadUNError=!0,this._errorMessage="",this.disabled=!0,this.iconClass=v.widgetIcon,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new ue,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._utilityNetworkTraceInitialized(),this.addHandles(x(()=>{var e;return(e=this.viewModel)==null?void 0:e.resultAreaProperties},()=>this.scheduleRender()))}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(e){this.viewModel.defaultGraphicColor=e}get flags(){return this.viewModel.flags}set flags(e){this.viewModel.flags=e}get gdbVersion(){return this.viewModel.gdbVersion}set gdbVersion(e){this.viewModel.gdbVersion=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(e){this.viewModel.resultAreaProperties=e}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(e){this.viewModel.selectedTraces=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(e){this.viewModel.showGraphicsOnComplete=e}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(e){this.viewModel.enableResultArea=e}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(e){this.viewModel.showSelectionAttributes=e}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}async checkCanTrace(){this._confirmReset=!1;const e=this.viewModel.checkCanTrace();e.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this.switchTab("result"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):e.issues.forEach(t=>{switch(t){case"noStart":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}})}confirmReset(){this._confirmReset=!0}render(){const{state:e}=this.viewModel;this._mixCustomStrings(),this._overrideFlagSymbol();const t=e==="loading"?this._renderWarningMessage("noTraceConfig",!1):this._renderUtilityNetworkTrace();return a("div",{class:this.classes(v.base,D.widget,D.panel,{[D.widgetDisabled]:this.disabled}),styles:U()},t)}loadDependencies(){return Re({action:()=>_(()=>import("./calcite-action-ZdVFPgt3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),"action-group":()=>_(()=>import("./calcite-action-group-CkjR39cc.js"),__vite__mapDeps([16,17,2,3,4,18,11,8,9,5,6,10,13,19,20,1,7,12,14,15,21,22,23,24,25,26,27])),"action-pad":()=>_(()=>import("./calcite-action-pad-DjdXF3S7.js"),__vite__mapDeps([28,2,3,4,18,11,5,6,8,9,10,13,29,17,19,20,1,7,12,14,15,21,22,23,24,25,26,27])),block:()=>_(()=>import("./calcite-block-81ba3rfb.js"),__vite__mapDeps([30,2,3,4,18,11,5,6,7,9,10,13,26,8,25,1,12,14,15,19,20,21,22,23,24,27,31,32])),"block-section":()=>_(()=>import("./calcite-block-section-CeUeqwrZ.js"),__vite__mapDeps([33,2,3,4,5,6,10,9,11,13,8,14,34,35,12,36,37,7])),button:()=>_(()=>import("./calcite-button-BGRBzuhy.js"),__vite__mapDeps([38,39,2,3,4,37,5,6,7,35,12,8,9,10,11,13,14,15])),checkbox:()=>_(()=>import("./calcite-checkbox-DkooX0M9.js"),__vite__mapDeps([40,2,3,4,5,6,37,7,10,35,12,8])),"color-picker-swatch":()=>_(()=>import("./calcite-color-picker-swatch-DCYE1mcL.js"),__vite__mapDeps([41,42,2,3,4,5,6])),combobox:()=>_(()=>import("./calcite-combobox-BwRtESI8.js"),__vite__mapDeps([43,44,2,3,4,45,23,5,6,22,37,7,35,12,8,9,10,11,25,13,46,47,48,18,14,49,50])),"combobox-item":()=>_(()=>import("./calcite-combobox-item-C2B5UwPi.js"),__vite__mapDeps([51,49,2,3,4,18,11,5,6,7,46,12,14])),flow:()=>_(()=>import("./calcite-flow-xQpOKDcb.js"),__vite__mapDeps([52,2,3,4,11,8])),"flow-item":()=>_(()=>import("./calcite-flow-item-D1TgTmys.js"),__vite__mapDeps([53,2,3,4,5,6,7,8,9,10,11,13,54,19,20,1,12,14,15,21,22,23,24,25,26,27,32])),icon:()=>_(()=>import("./calcite-icon-DW07N_Fi.js"),__vite__mapDeps([55,14,2,3,4,5,6,11])),"input-number":()=>_(()=>import("./calcite-input-number-gkEhlGFQ.js"),__vite__mapDeps([56,57,2,3,4,5,6,37,7,10,35,12,8,9,11,13,47,58,14,50,59])),label:()=>_(()=>import("./calcite-label-CkrtQ7VS.js"),__vite__mapDeps([60,34,2,3,4,35,5,6,12])),list:()=>_(()=>import("./calcite-list-DXRoRXYC.js"),__vite__mapDeps([61,2,3,4,5,6,7,11,62,8,13,9,10,45,23,14,63,37,35,12,47,58,50,59,15,32])),"list-item":()=>_(()=>import("./calcite-list-item-CEYbVI0q.js"),__vite__mapDeps([64,2,3,4,5,6,7,62,9,10,11,13,8,1,12,14,15,31])),loader:()=>_(()=>import("./calcite-loader-s-EjqyOZ.js"),__vite__mapDeps([65,15,2,3,4,6])),notice:()=>_(()=>import("./calcite-notice-bdrVVIis.js"),__vite__mapDeps([66,2,3,4,18,11,5,6,8,9,10,13,25,12,14])),option:()=>_(()=>import("./calcite-option-BKQ8Tpdp.js"),__vite__mapDeps([67,2,3,4,11])),panel:()=>_(()=>import("./calcite-panel-D3Ac2cuQ.js"),__vite__mapDeps([68,54,2,3,4,5,6,7,8,11,19,20,10,1,9,12,13,14,15,21,22,23,24,25,26,27,32])),popover:()=>_(()=>import("./calcite-popover-CwWmXud9.js"),__vite__mapDeps([69,21,2,3,4,22,5,6,23,24,25,26,9,10,11,13,8,27,12,1,7,14,15])),scrim:()=>_(()=>import("./calcite-scrim-zRqTTpuY.js"),__vite__mapDeps([70,32,2,3,4,9,5,6,10,11,13,15])),select:()=>_(()=>import("./calcite-select-D8mWwcXY.js"),__vite__mapDeps([71,2,3,4,5,6,37,7,35,12,8,11,47,14,50])),tab:()=>_(()=>import("./calcite-tab-_lyJ2SrJ.js"),__vite__mapDeps([72,73,2,3,4,5,6])),"tab-nav":()=>_(()=>import("./calcite-tab-nav-DC8nV98J.js"),__vite__mapDeps([74,75,2,3,4,5,6,11])),"tab-title":()=>_(()=>import("./calcite-tab-title-BWKuLN4p.js"),__vite__mapDeps([76,77,2,3,4,5,6,7,11,9,10,13,12,14])),tabs:()=>_(()=>import("./calcite-tabs-BrlDYi4u.js"),__vite__mapDeps([78,79,2,3,4,11])),tooltip:()=>_(()=>import("./calcite-tooltip-CCCijpCd.js"),__vite__mapDeps([80,2,3,4,5,6,22,23,25,27]))})}switchTab(e){this._activeTab=e}switchToFunctions(e,t){this._traceResultsFunctions=e,this._showTraceResultFunctions=t}switchToAssetGroup(e,t,s){this._traceHeaderForFlow=t,this._traceResultsAssetGroup=e,this._showTraceResultAssetGroup=s}switchToAssetType(e,t,s){this._assetGroupHeader=t,this._traceResultsAssetType=e,this._showTraceResultAssetType=s}switchToIndividualRecords(e,t,s){this._assetTypeHeader=t,this._traceResultsIndividual=e,this._showIndividualRecords=s}_renderUtilityNetworkTrace(){const{messages:e,messagesCommon:t}=this;let s=a("calcite-tabs",{layout:"center",position:"top",styles:et(this.container)},a("calcite-tab-nav",{slot:"title-group"},a("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:this._activeTab==="input"},e.inputsStrings.headerTabInputs),a("calcite-tab-title",{onclick:()=>{this.switchTab("result")},selected:this._activeTab==="result"},e.resultsStrings.headerTabResults)),a("calcite-tab",{selected:this._activeTab==="input"},this._renderInputPanel()),a("calcite-tab",{selected:this._activeTab==="result"},this.viewModel._activeProgress?a("calcite-loader",{label:e.alertsStrings.traceExecuting,text:e.alertsStrings.traceExecuting,type:"indeterminate"}):this.viewModel.traceResults.length>0?this._renderResultPanel():this._renderWarningMessage("noTraceExecuted",!1),this._confirmReset?a("calcite-scrim",{key:"prompt"},a("div",{class:v.clearPrompt},a("h3",{slot:"header"},e.resultsStrings.startOverButton),a("div",{slot:"content"},e.resultsStrings.startOverValidation),a("div",{class:v.promptDivider}),a("div",{styles:re("row")},a("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},t.cancel),a("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},t.form.ok)))):null));return this.viewModel.traces.length===0&&(s=a("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUNError||(s=a("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),s}_renderInputPanel(){const{messages:e}=this;return a("calcite-flow",{class:v.flow},a("calcite-flow-item",null,this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?a("div",{styles:Xe(10)}):null,a("calcite-button",{kind:"brand",onclick:()=>{this.checkCanTrace()},scale:"m",slot:"footer",width:"full"},e.tracingStrings.runTrace)),this._selectToolActive?this._renderActiveTool():null)}_renderResultPanel(){return a("calcite-flow",{styles:U()},this._renderTraceResults(),this._showTraceResultFunctions?this._renderTraceResultFunctions():null,this._showTraceResultAssetGroup?this._renderTraceResultByAssetGroup():null,this._showTraceResultAssetType?this._renderTraceResultByAssetType():null,this._showIndividualRecords?this._renderTraceResultIndividual():null,this._showIndividualRecords?this._renderTraceResultIndividualPopover():null)}_renderStartFlagsContainer(){const{messages:e}=this,t=[];let s=[];s=this.viewModel._flags.filter(l=>l.type==="starting-point"),s.forEach(l=>{l.displayValue&&t.push(this._renderFlagRow(l,"start"))});let i=null;return this._symbolStartFlag&&(i=this._getSymbolIcon(this._symbolStartFlag)),a("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerStartingPoint+" ("+s.length+")",open:!0,overlayPositioning:"fixed"},a("div",{slot:"icon"},i||a("calcite-icon",{icon:"pin",scale:"s"})),a("div",null,e.inputsStrings.startingPointHint),a("div",{class:v.listContainer},t),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,a("div",{class:v.addButtonContainer},a("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="starting-point",this._selectToolActive=!0,this._warningNoStartAssetFound=!1,this.viewModel.addFlagByHit("starting-point",this._symbolStartFlag).then(l=>{this._changeCursor("default"),l?this._warningNoFlag=!1:this._warningNoStartAssetFound=!0,this._selectToolActive=!1})},round:!0,scale:"m"})))}_renderBarriersFlagsContainer(){const{messages:e}=this,t=[];let s=[];s=this.viewModel._flags.filter(l=>l.type==="barrier"),s.forEach(l=>{l.displayValue&&t.push(this._renderFlagRow(l,"barrier"))});let i=null;return this._symbolBarrier&&(i=this._getSymbolIcon(this._symbolBarrier)),a("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerBarrier+" ("+s.length+")",open:!1,overlayPositioning:"fixed"},a("div",{slot:"icon"},i||a("calcite-icon",{icon:"x-circle-f",scale:"s"})),a("div",null,e.inputsStrings.barrierPointHint),a("div",{class:v.listContainer},t),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,a("div",{class:v.addButtonContainer},a("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",kind:"brand",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="barrier",this._selectToolActive=!0,this._warningNoBarrierAssetFound=!1,this.viewModel.addFlagByHit("barrier",this._symbolBarrier).then(l=>{this._changeCursor("default"),l||(this._warningNoBarrierAssetFound=!0),this._selectToolActive=!1})},round:!0,scale:"m"})))}_renderFlagRow(e,t){var o;const{messages:s,messagesCommon:i}=this,l=[];let r=!1;return e.allTerminals!=null&&e.allTerminals.terminals.length>0&&(r=!0,e.allTerminals.terminals.forEach(n=>{var p;let c=!1;(p=e==null?void 0:e.selectedTerminals)!=null&&p.includes(n.id)&&(c=!0),l.push(a("calcite-combobox-item",{key:n.name,selected:c,textLabel:n.name,value:n.id}))})),a("calcite-block",{collapsible:e.allTerminals!==null||e.type==="barrier",heading:((o=e.displayValue)==null?void 0:o.value)??"",key:"pop"+e.globalId+e.type+e.id+t,overlayPositioning:"fixed"},a("calcite-action",{icon:"trash",label:i.remove,onclick:()=>{this.viewModel.removeFlag(e)},scale:"s",slot:"header-menu-actions",text:i.remove,textEnabled:!0}),a("calcite-action",{icon:"zoom-to-object",label:s.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(e.details.geometry)},scale:"s",slot:"header-menu-actions",text:s.globalStrings.zoomToFeature,textEnabled:!0}),e.type==="barrier"?a("calcite-label",{layout:"inline",scale:"s"},a("calcite-checkbox",{checked:e.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!e.isFilterBarrier,e)},scale:"s"}),s.inputsStrings.barrierFilter):null,r?a("calcite-combobox",{label:s.globalStrings.selectTerminalPlaceholder,maxItems:0,placeholder:s.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:n=>{n.target.selectedItems.length>0?(e.selectedTerminals=[],n.target.selectedItems.forEach(c=>{this.viewModel.addTerminal(c.value,e)})):e.selectedTerminals=[]},onCalciteComboboxChipClose:n=>{n.preventDefault(),this.viewModel.removeTerminal(n.target.value,e)}},l):null)}_renderActiveTool(){const{messages:e}=this;let t=null;return this._flagViewType==="starting-point"?this._symbolStartFlag&&(t=this._getSymbolIcon(this._symbolStartFlag)):this._symbolBarrier&&(t=this._getSymbolIcon(this._symbolBarrier)),a("calcite-flow-item",{heading:e.inputsStrings.addPointOption,onCalciteFlowItemBack:()=>{var s;this.viewModel._clickHandler&&(this.viewModel._clickHandler.remove(),(s=this.view)!=null&&s.popup&&(this.view.popupEnabled=!0)),this._selectToolActive=!1}},a("calcite-block",{collapsible:!1,heading:"",open:!0,overlayPositioning:"fixed"},a("div",{styles:ie()},t||a("calcite-icon",{icon:this._flagViewType==="starting-point"?"pin-plus":"x-circle-f",scale:"m"})),a("div",{styles:ie()},e.inputsStrings.addPointHint)))}_renderTraceSelectorContainer(){const{messages:e}=this,t=[];let s=e.tracingStrings.traceOperation,i=0;return this.viewModel.traces.length>0&&this.viewModel.traces.forEach(l=>{t.push(a("calcite-combobox-item",{key:l.globalId,selected:l.selected,textLabel:l.title,value:l.globalId,onCalciteComboboxItemChange:r=>{const o=r.target;this.viewModel.selectTraces(o.selected,o.value),this.viewModel.traces.length>0&&(this._warningNoTraceSelected=!1)}})),l.selected&&i++}),s+=` (${i})`,a("calcite-block",{collapsible:!0,heading:s,open:!0,overlayPositioning:"fixed"},a("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),a("calcite-combobox",{label:e.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:e.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple"},t))}_renderStartOverContainer(){const{messages:e}=this;return a("calcite-button",{kind:"brand",onclick:()=>{this.confirmReset()},scale:"m",slot:"footer",width:"full"},e.resultsStrings.startOverButton)}_renderWarningMessage(e,t,s){const{messages:i}=this;let l=i.alertsStrings.NoRunAlertHeader,r=i.alertsStrings.noResultsInfo;switch(e){case"flag":l=i.alertsStrings.startingPointAlertHeader,r=i.alertsStrings.startingPointAlert;break;case"noTerminal":l=i.alertsStrings.noTerminalDefinedHeader,r=i.alertsStrings.noTerminalDefined;break;case"trace":l=i.alertsStrings.selectTraceAlertHeader,r=i.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":l=i.alertsStrings.NoRunAlertHeader,r=i.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":l=i.alertsStrings.noAssetsFoundHeader,r=i.alertsStrings.noAssetFound;break;case"noTraceConfig":l="",r=i.alertsStrings.noTraceSupported;break;default:l=i.alertsStrings.genericErrorHeader,r=s||""}return a("div",{class:v.noticeContainer,key:e},a("calcite-notice",{closable:t,icon:!0,key:e,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>{switch(e){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1}}},a("div",{slot:"title"},l),a("div",{slot:"message"},r)))}_renderRemoveTraceContainer(e){const{messages:t}=this;return a("calcite-action",{icon:"trash",label:t.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=e.trace},scale:"s",slot:"header-menu-actions",text:t.globalStrings.clearResults,textEnabled:!0})}_renderHighlightColorPicker(e,t,s){const{messages:i}=this,{graphicHandler:l}=this.viewModel,r=[],o=new RegExp(`^${e.hex}$`,"i"),n=l.highlightColor.length>q.length?5:4;for(const c of l.highlightColor)r.push(a("calcite-action",{active:o.test(c.hex),key:c.hex,label:i.resultsStrings.graphicColor,onclick:()=>{s==="aggregate"?this.viewModel.changeResultGraphicColor(c,t):this.viewModel.changeResultAreaColor(t,c)},scale:"s",text:i.resultsStrings.graphicColor},a("calcite-color-picker-swatch",{active:o.test(c.hex),color:c.hex,scale:"s"})));return a("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},a("calcite-action-group",{columns:n,layout:"grid"},r))}_renderTraceResults(){const{messages:e,messagesCommon:t}=this,{selectFeatures:s}=e.resultsStrings,i=this.viewModel.traceResults,l=[];return i.forEach((r,o)=>{var A,F,k,I,C,R;let n=[],c=[],p=!1,g=!1,y=!1,m="";r.results!==null&&r.results.hasOwnProperty("elements")?(r.results.aggregatedGeometry!==null&&(g=!0),r.results.globalFunctionResults!==null&&r.results.globalFunctionResults.length>0&&(c=r.results.globalFunctionResults,c.length>0&&(y=!0)),r.results.elements&&r.results.elements.length>0&&(n=r.results.elements,n.length>0&&(p=!0)),(g||p)&&(m=(F=this.messagesUnits.units[(A=r.resultArea)==null?void 0:A.unit])==null?void 0:F.abbr),l.push(a("calcite-block",{collapsible:!0,description:r.trace.description??"",heading:r.trace.title,key:`${r.trace.title}${o}`,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(r),a("calcite-list",null,y?a("calcite-list-item",{label:e.resultsStrings.functionHeader+" ("+c.length+")",onCalciteListItemSelect:()=>{this.switchToFunctions(c,!0)}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,p&&this.viewModel.showSelectionAttributes?a("calcite-list-item",{key:this.id,label:e.resultsStrings.viewFeatures+" ("+n.length+")",onCalciteListItemSelect:()=>{this.switchToAssetGroup(this._groupResultsByAssetGroup(r),r.trace.title+" ("+n.length+")",!0)}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?a("calcite-label",{layout:"inline",scale:"s"},e.resultsStrings.noSelectionResults):null),p?a("div",{class:v.paddingTop},a("calcite-label",{layout:"inline",onclick:f=>{f.preventDefault(),f.stopPropagation(),this.viewModel.mergeSelection(!r.selectionEnabled,r.trace)},scale:"s"},a("calcite-checkbox",{checked:r.selectionEnabled,onclick:f=>{f.preventDefault(),f.stopPropagation(),this.viewModel.mergeSelection(!r.selectionEnabled,r.trace)},scale:"m"}),this.viewModel.showSelectionAttributes?s:`${s} (${n.length})`)):null,g?a("calcite-block-section",{key:`aggregate-${r.trace.title}-${o}`,open:r.graphicEnabled,text:e.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:f=>{f.target.open?this.viewModel.changeResultGraphicColor(r.graphicColor,r):this.viewModel.removeResultGraphicFromView(r)}},a("calcite-list",{selectionMode:"none"},a("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:f=>{const T=f.target;this._swatchNode=T,this._activeSwatch="aggGeom_"+o}},a("calcite-color-picker-swatch",{color:r.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(g||p)?a("calcite-block-section",{key:`area-${r.trace.title}-${o}`,open:(k=r.resultArea)==null?void 0:k.show,text:e.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:f=>{f.target.open?r.resultAreaGraphic?this.viewModel.addResultAreaToMap(r,r.resultAreaGraphic):this.viewModel.addResultAreaToMap(r):this.viewModel.removeResultAreaFromMap(r)}},a("calcite-list",{selectionMode:"none"},a("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:f=>{const T=f.target;this._swatchNode=T,this._activeSwatch="resultArea_"+o}},a("calcite-color-picker-swatch",{color:(I=r.resultArea)==null?void 0:I.color.hex,scale:"s",slot:"actions-end"}))),a("calcite-list",{selectionMode:"none"},a("calcite-list-item",{label:e.resultsStrings.resultAreaBuffer},a("calcite-input-number",{afterCreate:this._afterComponentCreate,class:v.numberInput,max:999999,maxLength:999999,min:0,scale:"s",slot:"actions-end",suffixText:m,value:(C=r.resultArea)==null?void 0:C.distance.toString(),onCalciteInputNumberChange:f=>{var z;if(!((z=this.view)!=null&&z.popup))return;this.view.popup.visible&&this.view.closePopup();const T=f.target;r.resultArea.distance>=0?(r.resultArea.distance=parseInt(T.value,10),this.viewModel.removeResultAreaFromMap(r),this.viewModel.addResultAreaToMap(r)):(r.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(r),this.viewModel.addResultAreaToMap(r))}})))):null,a("calcite-popover",{autoClose:!0,closable:!0,label:e.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+o||this._activeSwatch==="resultArea_"+o,placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+o?(R=r.resultArea)==null?void 0:R.color:r.graphicColor,r,this._activeSwatch==="resultArea_"+o?"resultArea":"aggregate"))))):l.push(a("calcite-block",{collapsible:!1,heading:r.trace.title,key:"error-"+o,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(r),this._renderWarningMessage("noController",!1,r.status)))}),a("calcite-flow-item",{key:"traceResults",styles:U()},l,this._renderStartOverContainer(),this._alertRemoveModal?a("calcite-scrim",{key:"prompt"},a("div",{class:v.clearPrompt},a("h3",{slot:"header"},e.globalStrings.clearResults),a("div",{slot:"content"},e.alertsStrings.clearResultsAlert),a("div",{class:v.promptDivider}),a("div",{styles:re("row")},a("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},t.cancel),a("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,this.viewModel.traceResults.length===0?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1)},slot:"primary",width:"full"},t.form.ok)))):null)}_renderTraceResultFunctions(){const{messages:e}=this,t=this._traceResultsFunctions,s=[];return t.forEach(i=>{s.push(this._renderResultRowFunctions(i))}),a("calcite-flow-item",{heading:e.resultsStrings.functionHeader,key:"functionResultMultiple",onCalciteFlowItemBack:()=>{this.switchToFunctions([],!1)}},s,this._renderStartOverContainer())}_renderTraceResultByAssetGroup(){const e=this._traceResultsAssetGroup,t=[];for(const s in e){const i=e[s];for(const l in i)t.push(this._renderResultRowAssetGroup(i[l]))}return a("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",onCalciteFlowItemBack:()=>{this.switchToAssetGroup([],"",!1)}},a("calcite-list",null,t),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const e=this._traceResultsAssetType,t=[];for(const s in e)e[s].length>0&&t.push(this._renderResultRowAssetType(e[s]));return a("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",onCalciteFlowItemBack:()=>{this.switchToAssetType([],"",!1)}},a("calcite-list",{selectionMode:"none"},t),this._renderStartOverContainer())}_renderTraceResultIndividual(){var i;const{messages:e}=this,t=this._traceResultsIndividual;t.sort(this._compare(this._resultSortField,this._resultSortOrder));const s=[];return t.length>0&&((((i=t[0].details)==null?void 0:i.fields.some(({name:l})=>l.toLowerCase()===this._resultDisplayField.toLocaleLowerCase()))??!1)||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),t.forEach(l=>{l!=null&&l.details&&s.push(this._renderResultRowIndividual(l))}),s.length===0&&s.push(a("calcite-list-item",{label:e.resultsStrings.noFeaturesInMap}))),a("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToIndividualRecords([],"",!1)}},a("calcite-action",{afterCreate:Se,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:e.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},scale:"m",slot:"header-actions-end",text:e.resultsStrings.displayAttribute}),a("calcite-list",{selectionMode:"none"},s),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:e}=this,t=this._traceResultsIndividual,s=[],i=[];return t.length>0&&(t[0].details?t[0].details.fields.forEach(({name:l,alias:r})=>{s.push(a("calcite-option",{key:`display-${l}`,label:r??l,selected:l===this._resultDisplayField,value:l})),i.push(a("calcite-option",{key:`sort-${l}`,label:r??l,selected:l===this._resultSortField,value:l}))}):(s.push(a("calcite-option",{key:`display-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})),i.push(a("calcite-option",{key:`sort-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})))),a("calcite-popover",{autoClose:!0,label:e.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:this.domNode!==null?Ye(.75*this.domNode.clientWidth):Ke()},a("calcite-block",{heading:"",open:!0,overlayPositioning:"fixed"},a("calcite-label",{scale:"s"},e.resultsStrings.displayAttribute,a("calcite-select",{label:e.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:l=>{const r=l.target;this._resultDisplayField=r.selectedOption.value,this._showResultOptions=!1}},s)),a("calcite-label",{scale:"s"},e.resultsStrings.sortBy,a("calcite-select",{label:e.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:l=>{const r=l.target;this._resultSortField=r.selectedOption.value,t.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=t,this._showResultOptions=!1}},i))))}_renderResultRowFunctions(e){return a("calcite-block",{collapsible:!1,heading:e.networkAttributeName+" "+e.functionType+" = "+e.result,overlayPositioning:"fixed"})}_renderResultRowAssetGroup(e){const t=this._getAssetGroupName(e[0]);return a("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.switchToAssetType(this._groupResultsByAssetType(e),t+" ("+e.length+")",!0)}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(e){const t=this._getAssetTypeName(e[0]);return a("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.viewModel.queryFeaturesById(e).then(s=>{if(s!=null&&s.length){this._resultObjectIdField=s[0].layer.objectIdField,this._resultDisplayField==="objectid"&&(this._resultDisplayField=s[0].layer.objectIdField),this._resultSortField==="objectid"&&(this._resultSortField=s[0].layer.objectIdField);const i=this._appendAttributes(e,s,"objectId");this.switchToIndividualRecords(i,t+" ("+e.length+")",!0)}else this.switchToIndividualRecords(e,t+" ("+e.length+")",!0)})}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(e){var n,c,p;const{messages:t}=this,s=`display-${e.objectId}-nso`,{nonSpatialObject:i,zoomToFeature:l}=t.globalStrings;let r="",o=null;if(o=(n=e==null?void 0:e.details)==null?void 0:n.fields.find(({name:g})=>g===this._resultDisplayField),(o==null?void 0:o.type)==="date")r=new Date(e.details.attributes[this._resultDisplayField]).toDateString();else if(this._resultDisplayField.toLowerCase()==="assetgroup")r=this._getAssetGroupName(e);else if(this._resultDisplayField.toLowerCase()==="assettype")r=this._getAssetTypeName(e);else if(o!=null&&o.domain&&tt(o.domain)){const g=o.domain.codedValues.find(({code:y})=>y===e.details.attributes[this._resultDisplayField]);r=g==null?void 0:g.name}else r=((c=e.details)==null?void 0:c.attributes[this._resultDisplayField])??e.objectId;return r&&r!==""&&r!==null?typeof r=="string"&&(r.trim()||(r=t.resultsStrings.noValue)):r=t.resultsStrings.noValue,((p=e==null?void 0:e.details)==null?void 0:p.geometry)!==null?a("calcite-list-item",{label:r,onCalciteListItemSelect:()=>{this.viewModel.zoomToAsset(e.details.geometry)}},a("calcite-icon",{icon:"zoom-to-object",scale:"s",slot:"content-end",textLabel:l})):a("calcite-list-item",{label:r},a("calcite-icon",{icon:"table",id:s,scale:"s",slot:"content-end",textLabel:i}),a("calcite-tooltip",{label:i,referenceElement:s},a("span",null,i)))}_afterComponentCreate(e){"value"in e&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"})}_mixCustomStrings(){const{messages:e}=this;this.inputSettings.length>0&&this.inputSettings.forEach(t=>{t.type==="starting-point"&&(e.inputsStrings.headerStartingPoint=t.label,e.inputsStrings.startingPointHint=t.description),t.type==="barrier"&&(e.inputsStrings.headerBarrier=t.label,e.inputsStrings.barrierPointHint=t.description)})}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach(e=>{e.type==="starting-point"?this._symbolStartFlag=e.symbol:this._symbolBarrier=e.symbol,this.viewModel.changeFlagSymbol(e.type,e.symbol)})}_utilityNetworkTraceInitialized(){return this.viewModel.loadUtilityNetwork().then(e=>{var t;if(e)return this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel.flags.length>0&&this._processFlagOnLoad(),(t=this.view)==null?void 0:t.when().then(()=>{this._watchViewState()});this.disabled=!1}).catch(e=>{const{messages:t}=this;this._loadUNError=!1,e.name==="utility-network:no-user-type-extension"||e.details.raw.extendedCode===st.noExtension?this._errorMessage=t.alertsStrings.noUserExtension:this._errorMessage=e.message,this.disabled=!1})}_processFlagOnLoad(){var e;return(e=this.view)==null?void 0:e.when().then(()=>{this._watchHandler=W(()=>{var t;return!((t=this.view)!=null&&t.updating)},async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const t=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),t.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),t.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,this._watchHandler!==null&&this._watchHandler.remove()})})}_registerWatchers(){this.addHandles([x(()=>this.selectedTraces,()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()}),x(()=>this.defaultGraphicColor,()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach(e=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,e)}),this.scheduleRender()})])}_groupResultsByAssetGroup(e){var l;const t=[],s=(l=e.results)==null?void 0:l.elements,i=this._groupBy(s??[],"networkSourceId");for(const r in i)t.push(this._groupBy(i[r],"assetGroupCode"));return t}_groupResultsByAssetType(e){return this._groupBy(e,"assetTypeCode")}_appendAttributes(e,t,s){const i=[];return e.forEach(l=>{t.forEach(r=>{r.featureSet.features.forEach(o=>{l[s]===o.attributes[this._resultObjectIdField]&&(l.details=o,l.details.fields=r.featureSet.fields,i.push(l))})})}),i}_getAssetGroupName(e){let t=e.assetGroupCode.toString();const s=e.assetGroupCode,i=this.viewModel.getValidSources().find(l=>l.sourceId===e.networkSourceId);if(i){const l=i.assetGroups.find(r=>r.assetGroupCode===s);l&&(t=l.assetGroupName)}return t}_getAssetTypeName(e){let t=e.assetTypeCode.toString();const s=e.assetGroupCode,i=this.viewModel.getValidSources().find(l=>l.sourceId===e.networkSourceId);if(i){const l=i.assetGroups.find(r=>r.assetGroupCode===s);if(l){const r=l.assetTypes.find(o=>o.assetTypeCode===e.assetTypeCode);r&&(t=r.assetTypeName)}}return t}_compare(e,t){return(s,i)=>{var n,c;let l=0,r=((n=s.details)==null?void 0:n.attributes[e])??s.objectId,o=((c=i.details)==null?void 0:c.attributes[e])??i.objectId;return isNaN(r)&&(r=r.toLowerCase()),isNaN(o)&&(o=o.toLowerCase()),t==="desc"?r>o?l=1:r<o&&(l=-1):r<o?l=1:r>o&&(l=-1),l}}_groupBy(e,t){return e.reduce((s,i)=>((s[i[t]]=s[i[t]]||[]).push(i),s),{})}_getSymbolIcon(e){return e.type==="picture-marker"?a("img",{height:e.height,src:e.url??void 0,width:e.width}):null}_watchViewState(){this._watchHandler=W(()=>{var e;return!((e=this.view)!=null&&e.updating)},()=>{this.disabled=!1,this._watchHandler!==null&&this._watchHandler.remove()},{initial:!0})}_changeCursor(e="default"){var s,i;const t=(i=(s=this.view)==null?void 0:s.container)==null?void 0:i.style;t&&(t.cursor=e)}};h([u()],d.prototype,"_selectToolActive",void 0),h([u()],d.prototype,"_activeTrace",void 0),h([u()],d.prototype,"_activeSwatch",void 0),h([u()],d.prototype,"_traceHeaderForFlow",void 0),h([u()],d.prototype,"_assetGroupHeader",void 0),h([u()],d.prototype,"_assetTypeHeader",void 0),h([u()],d.prototype,"_traceResultsFunctions",void 0),h([u()],d.prototype,"_traceResultsAssetGroup",void 0),h([u()],d.prototype,"_traceResultsAssetType",void 0),h([u()],d.prototype,"_traceResultsIndividual",void 0),h([u()],d.prototype,"_showTraceResultFunctions",void 0),h([u()],d.prototype,"_showTraceResultAssetGroup",void 0),h([u()],d.prototype,"_showTraceResultAssetType",void 0),h([u()],d.prototype,"_showIndividualRecords",void 0),h([u()],d.prototype,"_activeTab",void 0),h([u()],d.prototype,"_alertRemoveModal",void 0),h([u()],d.prototype,"_warningNoFlag",void 0),h([u()],d.prototype,"_warningNoTraceSelected",void 0),h([u()],d.prototype,"_confirmReset",void 0),h([u()],d.prototype,"_swatchNode",void 0),h([u()],d.prototype,"_errorMessage",void 0),h([u()],d.prototype,"defaultGraphicColor",null),h([u()],d.prototype,"disabled",void 0),h([u()],d.prototype,"flags",null),h([u()],d.prototype,"gdbVersion",null),h([u()],d.prototype,"iconClass",void 0),h([u()],d.prototype,"inputSettings",void 0),h([u()],d.prototype,"label",null),h([u(),B("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],d.prototype,"messages",void 0),h([u(),B("esri/t9n/common")],d.prototype,"messagesCommon",void 0),h([u(),B("esri/core/t9n/Units")],d.prototype,"messagesUnits",void 0),h([u()],d.prototype,"resultAreaProperties",null),h([u()],d.prototype,"selectedTraces",null),h([u()],d.prototype,"selectOnComplete",null),h([u()],d.prototype,"showGraphicsOnComplete",null),h([u()],d.prototype,"enableResultArea",null),h([u()],d.prototype,"showSelectionAttributes",null),h([u()],d.prototype,"utilityNetwork",null),h([u()],d.prototype,"view",null),h([ke(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area","create-result-area"]),u({type:ue})],d.prototype,"viewModel",void 0),d=h([ae(Qe)],d);const wt=d;export{wt as default};
