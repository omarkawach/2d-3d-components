function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/symbolLayerUtils-BBgvUxCt.js","assets/index-8ERthB3p.js","assets/index-CzRN3C0i.css","assets/Upload-Bl_Cn99v.js","assets/progressUtils-DVjrhSUb.js","assets/infoFor3D-CxOdoily.js","assets/helpMessageUtils3d-iCaxCkPU.js","assets/elevationInfoUtils-sHEwmo9N.js","assets/calcite-scrim-zRqTTpuY.js","assets/scrim-CkNnGmGz.js","assets/jsxFactory-BxQYPm-b.js","assets/locale-czPJjPyG.js","assets/dom-BvFmd0Ey.js","assets/guid-Cgw_FQNn.js","assets/key-wu7cp3Vu.js","assets/observers-hu61Hn6M.js","assets/t9n-GCZDzKCw.js","assets/loader-DeANvmkY.js","assets/calcite-button-BGRBzuhy.js","assets/button-Csva0FHl.js","assets/form-DjQ2sEGP.js","assets/interactive-juHwuDyB.js","assets/label2-D3Hkhas-.js","assets/component-CiBiWYk6.js","assets/loadable-C9pgOBpc.js","assets/icon-DyzVx5Y-.js","assets/calcite-notice-bdrVVIis.js","assets/conditionalSlot-DvaCB6Om.js","assets/openCloseComponent-C40eKxzi.js","assets/calcite-accordion-Dt_0K2BQ.js","assets/calcite-accordion-item-C0ydwyMG.js","assets/calcite-icon-DW07N_Fi.js","assets/calcite-loader-s-EjqyOZ.js","assets/calcite-flow-item-D1TgTmys.js","assets/panel-DgFCqyCW.js","assets/action-menu-BfqOv3CZ.js","assets/array-CG_obv_6.js","assets/action-CR32yz_4.js","assets/popover-CVy_TqWd.js","assets/floating-ui-azNa5k60.js","assets/debounce-Bd3Yf8RP.js","assets/focusTrapComponent-DOljTw4q.js","assets/Heading-CWhq9JWU.js","assets/FloatingArrow-Dv49hS4C.js","assets/calcite-flow-xQpOKDcb.js","assets/calcite-list-DXRoRXYC.js","assets/utils3-Ckz8Mzud.js","assets/filter-Dr_d0q4i.js","assets/input2-KR1QZnYy.js","assets/Validation-BbCdGpug.js","assets/input-eashyq5M.js","assets/input-message-DJd4uB0t.js","assets/progress-434a5olE.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{o,y as l,X as O,bO as ae,ak as Ie,oo as Yt,p0 as ea,p1 as ta,oK as aa,p2 as ia,h0 as sa,cr as _,b0 as F,a7 as it,h6 as Ct,nH as Et,a0 as ke,fZ as X,f$ as x,ac as ra,gt as oa,_ as $,v as Pe,hi as Ve,ga as na,p3 as la,dU as $t,mO as At,cB as Wt,fX as Ue,bE as Vt,s as A,jb as da,ag as st,b1 as ft,mr as pe,cX as Ce,gl as te,ej as ge,R as wt,gJ as rt,p4 as ca,g0 as pa,cW as gt,p5 as yt,nk as Re,mw as ua,P as G,fY as Ge,cY as ha,c_ as ma,cu as ze,ah as fa,ai as wa,a1 as xe,am as ga,a3 as ya,a2 as va,ct as Q,cs as ye,j7 as Ne,$ as _a,ja as ka,p6 as ba,mT as Ma,q as Be,ot as Fa}from"./index-8ERthB3p.js";import{l as Le,n as ot,a as Ia}from"./SketchViewModel-DKgcTZ3K.js";import{y as Ca,I as Ea}from"./Attachments-B3bjOZlK.js";import{J as Ot,$ as $a}from"./FeatureForm-DyGTRrJb.js";import{t as St,h as Aa,o as Wa,F as Va,m as Oa}from"./FeatureTemplates-9_3L7cl3.js";import{c as Sa,h as Ta}from"./Spinner-zqgek7zX.js";import{i as Pa,r as Y,n as h,g as qe,l as nt,q as La,e as De,O as Ua}from"./jsxFactory-BxQYPm-b.js";import{h as Tt}from"./UpdatingHandles-ugzlsvZF.js";import lt from"./GraphicsLayer-CapLCpoe.js";import{p as xa,u as Pt,j as Da}from"./SnappingManager-DUlqpdAB.js";import{e as Ha}from"./helpMessageUtils-M95XMmyR.js";import{_ as Lt}from"./screenUtils-BuM_Fswi.js";import{o as Ra,r as Ga}from"./drapedUtils-BdDXXXz6.js";import{L as je}from"./symbolUtils-DGJEMzVR.js";import{e as Ut}from"./GraphicState-BLKIyD3S.js";import{t as za,s as xt}from"./hitTestSelectUtils-UXJPjatw.js";import{h as Dt}from"./HighlightHelper-C9qxMKl7.js";import{n as Na}from"./layerViewUtils-Bi2wmOiN.js";import{K as Ba,J as qa}from"./featureUtils-v_3Xfkxx.js";import{u as ja,i as Za}from"./infoFor3D-CxOdoily.js";import{l as Ka}from"./ViewingMode-Dodu7ZZk.js";import{H as Qa}from"./featureFormUtils-DWtRp-Kj.js";import{s as dt,k as Ja,w as Xa}from"./SnappingControls-Dk3lPt8Y.js";import{e as Oe,n as Ee}from"./Heading-BZW3Ifza.js";import{s as Se}from"./substitute-DkE5N3Tl.js";import{l as Ya,m as ei,i as ti}from"./uploadAssetErrors-BGUPPV0P.js";import{e as vt}from"./globalCss-DfZw-NIf.js";import{e as ai}from"./vmEvent-D4Ubqkbq.js";import"./elevationInfoUtils-sHEwmo9N.js";import"./geodesicUtils-D1kRRrco.js";import"./layerUtils-BS1Di3Pm.js";import"./angularMeasurementUtils-CATp35qy.js";import"./vec2-Dt9Foiri.js";import"./vec2f64-Diu2Kaa8.js";import"./plane-Du3EYICn.js";import"./mat3f64-BBpwCtoL.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-BrpT0VRp.js";import"./mathUtils-iSLnUy_4.js";import"./sphere-Bf4ezJdT.js";import"./ObjectStack-BPo9QGhV.js";import"./geometry2dUtils-DoOkpuKA.js";import"./projectVectorToVector-C3SBBDgz.js";import"./projectPointToVector-qKp-AJ2b.js";import"./Cyclical-BY9qISY1.js";import"./quantityUtils-9zDVxeky.js";import"./SketchLabelOptions-BnZB654u.js";import"./unitFormatUtils-3MMEFLJJ.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./AttachmentInfo-CeKPRDIT.js";import"./FieldInput-BX8nL7O6.js";import"./utils-B6UP7_Wm.js";import"./arcade-CYPBEbsk.js";import"./TimeOnly-CdukLkzZ.js";import"./ImmutableArray-BlMso3qf.js";import"./FeatureRelationshipViewModel-CZQ1zx35.js";import"./AnchorElementViewModel-Bb21xlFI.js";import"./GraphicsCollection-CKieR40M.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./viewUtils-DC86MEAQ.js";import"./geometryEngine-MBwx6Ib1.js";import"./geometryEngineBase-Cz__5BKm.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-7yclY7Co.js";import"./projectVectorToWGS84ComparableLonLat-DuPw0-Mv.js";import"./geodesicMeasurementUtils-BcTpN3Xi.js";import"./signal-DoM1gSF0.js";import"./utils-j-RBNfeR.js";import"./cimSymbolUtils-DwzauUMk.js";import"./mat2df32-orApM5a3.js";import"./mat2d-D9yIh3Tx.js";import"./webStyleSymbolUtils-BzDS5WjL.js";import"./devEnvironmentUtils-Blrp8lZ5.js";import"./directionModeIcons-Br5woIHu.js";import"./layerListUtils-DD1BqbFJ.js";import"./LayerListViewModel-yodWjbdx.js";import"./ListItem-CrkhWk_H.js";import"./widget-D7hEnZDA.js";const ie="esri-editor",ee={base:ie,helpMessage:`${ie}__help-message`,updateActions:`${ie}__update-actions`,updateActionsList:`${ie}__update-actions-list`,featureTemplatesContainer:`${ie}__feature-templates-container`,templateItemContentEnd:`${ie}__template-item-content-end`,widgetIcon:Pa.edit};let z=class extends ae{constructor(t){super(t),this.creationInfo=null,this.editorItem=null,this.parent=null,this.pendingFeatures=new Ie,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this.upload=null}};o([l()],z.prototype,"creationInfo",void 0),o([l()],z.prototype,"editorItem",void 0),o([l()],z.prototype,"parent",void 0),o([l({constructOnly:!0})],z.prototype,"sketchOptions",void 0),o([l()],z.prototype,"snappingManager",void 0),o([l()],z.prototype,"viewModel",void 0),o([l()],z.prototype,"upload",void 0),z=o([O("esri.widgets.Editor.CreateFeaturesWorkflowData")],z);function ct(e){const t=e.sourceLayer;if(!t||t.type!=="feature"||!ni(t.renderer))return{rotation:null,size:null};let a=null,i=null;const s=t.renderer.getVisualVariablesForType("rotation").filter(n=>(!n.axis||n.axis==="heading")&&n.field&&!n.valueExpression&&Yt(n,e)!=null);s.length===1&&(a=ii(s[0],t));const r=t.renderer.getVisualVariablesForType("size").filter(n=>n.field&&!n.useSymbolValue&&!n.valueExpression&&ea(n)===ta.RealWorldSize&&aa(n,e)!=null);return r.length===1&&(i=oi(r[0],t)),{rotation:a,size:i}}function ii(e,t){const a=(e.axis||"heading")==="heading"&&e.rotationType==="arithmetic"?-1:1,i=e.field,s=t.fields&&t.fields.filter(d=>d.name===i),r=s&&s.length===1?s[0].type:"double",n={initial:0,current:0};return{field:i,fieldType:r,getDefault:()=>Promise.resolve(0),getValue:d=>(n.current=n.initial-a*d,Ze((n.current+360)%360,r)),initValue:d=>{n.initial=d??n.current,n.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}function si(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}async function ri(e,t,a){if(t==null)return 0;const{symbol:i}=oa(t);if(i==null||i.type==="web-style"||i.type==="cim")return 0;const s=i.symbolLayers.at(0);if(!s)return 0;switch(s.type){case"icon":{const{computeIconLayerResourceSize:r}=await $(()=>import("./symbolLayerUtils-BBgvUxCt.js"),__vite__mapDeps([0,1,2]));return s.size||Math.min(K.icon,(await r(s,K.icon))[0])||K.icon}case"text":return s.size||K.text;case"line":return s.size||K.line;case"object":{const{computeObjectLayerResourceSize:r}=await $(()=>import("./symbolLayerUtils-BBgvUxCt.js"),__vite__mapDeps([0,1,2]));return si(await r(s,e.scale/K.viewScaleSizeFactor),a)}case"path":return(s.width!=null?s.width:s.height)||e.scale/K.viewScaleSizeFactor;case"extrude":return s.size||e.scale/K.viewScaleSizeFactor;default:return 0}}function oi(e,t){const a=e.field,i=e.axis,s=t.fields&&t.fields.filter(p=>p.name===a),r=s&&s.length===1?s[0].type:"double",n={updating:!1,initial:0,current:0},d=ia[e.valueUnit]??1;let c;return c=e.valueRepresentation==="area"?p=>(p*d/2)**2*Math.PI:e.valueRepresentation==="radius"||e.valueRepresentation==="distance"?p=>p*d/2:p=>p*d,{field:a,fieldType:r,getDefault:async(p,u)=>Ze(c(await ri(u,p,i)),r),getValue:(p,u)=>(n.initial||(n.initial=u.pixelSizeAt(u.center)),n.current=n.initial*p,Ze(n.current,r)),initValue:p=>{n.initial=p??n.current,n.current=0},isUpdatingInteractively:!1,displayUnit:bi(e.valueUnit),axis:e.axis}}function Ze(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}function ni(e){switch(e==null?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function Z(e,t,a){const i=await je(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:a});sa(e.symbol,i)!=null&&(e.symbol=i)}function li(e){if(!e)throw new Error("no geometry type");return e==="multipatch"?"mesh":e}async function di(e,t,a){var u;const i=t.layer,s={...(u=t.template)==null?void 0:u.prototype.attributes,...t.attributeOverrides};let r=null;const{view:n}=e,d=(n==null?void 0:n.type)==="2d";if(await _t(e,i,s,a,d?n.scale:null),d){const m=Pe(f=>_t(e,i,s,a,f));r=_(()=>n.scale,f=>m(f))}const{data:c,editing:p}=i.capabilities;return e.layer.elevationInfo=i.elevationInfo,t.geometryToPlace==null?await e.create(li(i.geometryType),{graphicProperties:{attributes:s,sourceLayer:i},hasZ:c.supportsZ,defaultZ:(d?p.zDefault:null)??e.defaultCreateOptions.defaultZ}):await e.place(t.geometryToPlace,{graphicProperties:{attributes:s,sourceLayer:i}}),r??F()}async function _t(e,t,a,i,s){const r=new it({sourceLayer:t,attributes:a}),{rotation:n,size:d}=ct(r);let c=await je(r,{useSourceLayer:!0,webStyleCache:i,scale:s}),p=!1;for(const u of[d,n])u!=null&&a[u.field]==null&&(a[u.field]=await u.getDefault(c,e.view),p=!0);switch(p&&(c=await je(r,{useSourceLayer:!0,webStyleCache:i,scale:s})),c==null?void 0:c.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}Ht(e.tooltipOptions,d,n)}function Ht(e,t,a){e.visualVariables=t!=null||a!=null?{size:t!=null?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:a!=null?{valueType:a.fieldType,rotationType:a.rotationType??"geographic"}:null}:null}function ci(e,t){return e==null?void 0:e.find(a=>a.layer===t)}async function pi(e,t,a,i){switch(t.type){case"3d":return ui(e,t,a,i);case"2d":return hi(e,t,a,i)}}async function ui(e,t,a,i){if(e.length===0)return[];const{updatable:s,graphicsByLayer:r}=await a.async(async()=>{const{results:n}=await Ve(za(t,a),i),d=new Map,c=u=>{const m=u.layer,f=d.get(m);if(!f){const w=new Array;return d.set(m,w),w}return f};xt(n).forEach(({graphic:u})=>c(u).push(u));const p=e.filter(({capabilities:u,layer:m})=>u.update.enabled&&d.has(m));return p.length!==0&&a.stopPropagation(),{updatable:p,graphicsByLayer:d}});return Ve(Promise.allSettled(s.map(async({layer:n})=>{const d=r.get(n),c=Rt(n);if(d.every(m=>na(c,m)))return d;const p=[];for(const m of d){p.push(m.getObjectId());const f=Object.keys(m.attributes);la(c,f)}const u=n.createQuery();return u.returnGeometry=!1,u.objectIds=p,u.outFields=$t(n.fieldsIndex,c),n.queryFeatures(u,{signal:i}).then(({features:m})=>m)})),i)}async function hi(e,t,a,i){if(e.length===0)return[];const{mapPoint:s}=a;if(s==null)return[];let r=null;const n=await a.async(async()=>{const{results:d}=await Ve(t.hitTest(a),i);if(d.length===0)return[];const c=new Set;r=xt(d),r.forEach(({graphic:u})=>u&&c.add(u.layer));const p=e.filter(u=>c.has(u.layer)&&u.supportsUpdateWorkflow);return p.length>0&&a.stopPropagation(),p});return Ve(Promise.allSettled(n.map(async({layer:d})=>{const c=d.createQuery();c.returnGeometry=!1,c.outFields=Rt(d);const p="renderer"in d?Ra({renderer:d.renderer,pointerType:a.pointerType}):0;c.geometry=Ga(s,p,t),c.outSpatialReference=t.spatialReference;const{features:u}=await d.queryFeatures(c,{signal:i});return r==null||r.forEach(({graphic:m})=>{m.layer!==d||u.some(f=>f.getObjectId()===m.getObjectId())||u.push(m)}),u})),i)}function Rt(e){return $t(e.fieldsIndex,[e.objectIdField,At({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function mi(e,t,a){const{sourceLayer:i}=e,s=i.createQuery();s.objectIds=[e.getAttribute(i.objectIdField)],s.outFields=["*"],s.outSpatialReference=t,s.returnM=i.capabilities.data.supportsM,s.returnZ=i.capabilities.data.supportsZ,Ct()&&Et()&&i.type==="scene"&&i.infoFor3D!=null&&(s.returnGeometry=!0,s.formatOf3DObjects="3D_glb");const r=await i.queryFeatures(s,{signal:a});return ke(a),r.features[0]}async function Ke(e){var u;const{graphic:t,sketchViewModel:a,sourceLayer:i,visualVariables:s,webStyleCache:r}=e;let n=!1;const{rotation:d,size:c}=s;if([d,c].forEach(async m=>{if(m==null)return;const f=t.getAttribute(m.field);if(f!=null)m.initValue(f);else{const w=await m.getDefault(t.symbol,a.view);m.initValue(w),t.setAttribute(m.field,w),n=!0}}),n){const m=((u=a.view)==null?void 0:u.type)==="2d"?a.view.scale:null;await Z(t,r,m)}const p={multipleSelectionEnabled:!1};return i.geometryType==="point"&&(p.enableRotation=d!=null,p.enableScaling=c!=null),Ht(a.tooltipOptions,c,d),a.layer.elevationInfo=i.elevationInfo,a.update(t,p)}function fi(e){return e==null||e.type!=="rotate-start"&&e.type!=="rotate"&&e.type!=="rotate-stop"?null:e}function wi(e){return e==null||e.type!=="scale-start"&&e.type!=="scale"&&e.type!=="scale-stop"?null:e}async function Gt(e,t,a,i,s){var p;if(t.geometry==null||((p=t.geometry)==null?void 0:p.type)!=="point")return;const r=i.rotation,n=fi(a.toolEventInfo);if(r!=null&&n!=null)if(n.type==="rotate-stop")r.isUpdatingInteractively=!1,r.initValue();else{r.isUpdatingInteractively=!0;const{field:u,getValue:m}=r;t.setAttribute(u,m(n.angle,e))}const d=i.size,c=wi(a.toolEventInfo);if(d!=null&&c!=null)if(c.type==="scale-stop")d.isUpdatingInteractively=!1,d.initValue();else{d.isUpdatingInteractively=!0;const{field:u,getValue:m}=d;t.setAttribute(u,m(c.xScale,e))}await Z(t,s,e.type==="2d"?e.scale:null)}async function gi({feature:e,featureClone:t,visualVariableAttributes:a,sketchViewModel:i,view:s,onUpdate:r,webStyleCache:n}){var I;await Z(t,n,s.type==="2d"?s.scale:null);let d=null;if(((I=i==null?void 0:i.view)==null?void 0:I.type)==="2d"){const M=Pe(C=>Z(t,n,C));d=_(()=>{var C;return(C=i==null?void 0:i.view)==null?void 0:C.scale},C=>M(C))}const c=t.sourceLayer,p=he(s,c);await Ke({graphic:t,sketchViewModel:i,sourceLayer:c,visualVariables:a,webStyleCache:n});let u=null;p.then(M=>u=M).catch(()=>{});const m=a.size,f=a.rotation,w=_(()=>e.attributes,async M=>{let C=!1;for(const b in M){const q=M[b];q!==t.getAttribute(b)&&(t.setAttribute(b,q),m==null||m.isUpdatingInteractively||m.field!==b||m.initValue(q),f==null||f.isUpdatingInteractively||f.field!==b||f.initValue(q),(u==null||u.requiredFields.includes(b))&&(C=!0))}C&&await Z(t,n,s.type==="2d"?s.scale:null)}),k=i.on("update",async M=>{const C=M.graphics[0];if(M.state==="complete")return Ke({graphic:C,sketchViewModel:i,sourceLayer:c,visualVariables:a,webStyleCache:n});await Gt(s,C,M,a,n),r(Qe(C),M)}),y=i.on(["undo","redo"],async M=>{r(Qe(M.graphics[0]),M)});return X([y,k,F(()=>i.cancel()),w,d])}async function yi(e,t,a){const i=e.view;e.layer.add(a);const s=t.sourceLayer,r=t.layer,n=t.getAttribute(r.objectIdField);let d=null;function c(p){d==null||d.abort(),d=Wt(async u=>{var f;const m=await he(i,s);ke(u),(f=m.setVisibility)==null||f.call(m,n,p)})}return await _i(i,a),c(!1),X([vi(i,a,p=>c(!p)),F(async()=>{c(!0);try{const p=await he(i,s);await x(()=>!p.updating)}finally{e.layer.remove(a)}})])}function vi(e,t,a){if(e.type==="3d"){const i=new Ut({graphic:t});return X([e.trackGraphicState(i),_(()=>i.displaying,a)])}return _(()=>t.visible,a)}async function _i(e,t){if(e.type==="3d"){const a=new Ut({graphic:t}),i=e.trackGraphicState(a);await x(()=>a.displaying),i.remove()}else await x(()=>t.visible)}const K={icon:Ue(24),text:Ue(12),line:Ue(1),viewScaleSizeFactor:100};function zt(e,t,a){let i=!1;return e.filter(s=>!!i||(i=s===t,i)).map(s=>a[s]())}function ki(e,t){e.viewModel.syncFeatureTemplates();const a=e.creationInfo;if(t[0].id==="awaiting-feature-creation-info"&&a){const i=a.layer,s=St(i);s.length===1&&i.type!=="scene"&&(a.template=s[0],t.shift())}return t}function bi(e){switch(e){case"unknown":case"decimal-degrees":return null;default:return e}}function Mi(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Nt=e=>/-stop/.test(e)||/vertex-/.test(e),he=(e,t)=>{const a=t.type==="subtype-sublayer"?t.parent:t;return e.whenLayerView(a)};function Fi(e){return"createInteractiveEditSession"in e}function Qe(e){var a;const t=e.geometry;if((t==null?void 0:t.type)==="mesh"){const i=e.cloneShallow();return i.attributes=ra(e.attributes),i.geometry=t.cloneShallow(),i.geometry.transform=((a=t.transform)==null?void 0:a.clone())??null,i}return e.clone()}function Je(e){const t=e.cursor;return e.cursor="progress",F(()=>e.cursor=t)}async function Ii({view:e,data:t,signal:a,next:i,cancel:s}){const{creationInfo:r}=t;if(!r)return F();if(!ve(r))return F();const{layer:n}=r,d=r.geometryToPlace!=null;if(r.geometryToPlace=null,d)return s(),F();const{Upload:c}=await $(()=>import("./Upload-Bl_Cn99v.js"),__vite__mapDeps([3,1,2,4,5]));ke(a);const p=new c;t.upload=p;let u=null;const m=()=>u==null?void 0:u.remove(),f=X([_(()=>p.state,w=>{switch(w){case"default":case"error":m();break;case"pending":m(),u=Je(e);break;case"success":r.maxFeatures=1,r.geometryToPlace=p.result,m(),i()}}),F(()=>{p.cancel(),m()})]);return p.uploadTo(n),f}function ve(e){const t=e==null?void 0:e.layer;return(t==null?void 0:t.type)==="scene"}let E=class extends Vt.EventedAccessor{constructor(t){super(t),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new Tt,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:t}=this;return!!(t&&this._stepIndex<t.filter(a=>!a.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:t}=this,a=t&&t[this._stepIndex];return a&&a.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(t=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await t()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(t={force:!0}){return t.force!==!1?this._cancel(t):new Promise((a,i)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...t,force:!0}).then(a)},deny:()=>i(new A("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(t){const{steps:a}=this,i=a.findIndex(s=>s.id===t);this._indexHistory.push(this._stepIndex),await this._go(i)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(t={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),t.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const t=this._stepIndex===-1?0:this._stepIndex;await this._go(t)}async _cancel({emitCancelEvent:t=!0,error:a}={}){this.started&&(this._set("started",!1),await this._transaction(()=>{var i;return(i=this.steps[this._stepIndex])==null?void 0:i.tearDown({canceled:!0})})),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(t),t&&this.emit("cancel",{error:a})}_go(t=-1,a=!1){return this._transaction(async()=>{const{steps:i}=this;if(!(t<=-1||t>=i.length)){if(!this.started)return this._stepIndex=t,void this._notifyStepProps();this._lastStepIndex>-1&&await i[this._lastStepIndex].tearDown({canceled:a});try{await i[t].setUp()}catch(s){da(s)}this._lastStepIndex=t,this._stepIndex=t,this._notifyStepProps()}})}async _transaction(t){const a=this._pendingOperation,i=st(),s=(a??Promise.resolve()).then(()=>i.promise);this._pendingOperation=s,this._updatingHandles.addPromise(s);try{a&&await a,await t()}finally{i.resolve(),s===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(t=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,t&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};o([l()],E.prototype,"data",void 0),o([l()],E.prototype,"hasNextStep",null),o([l()],E.prototype,"hasPreviousStep",null),o([l()],E.prototype,"onCommit",void 0),o([l()],E.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],E.prototype,"hasInvalidFormTemplate",null),o([l()],E.prototype,"shouldShowAttachments",null),o([l()],E.prototype,"shouldAllowAttachmentEditing",null),o([l()],E.prototype,"started",void 0),o([l({readOnly:!0})],E.prototype,"stepId",null),o([l()],E.prototype,"steps",void 0),o([l({readOnly:!0})],E.prototype,"type",void 0),o([l()],E.prototype,"helpMessage",null),o([l()],E.prototype,"hasPendingEdits",null),o([l()],E.prototype,"keyboardCancellationEnabled",null),o([l()],E.prototype,"updating",null),E=o([O("esri.widgets.Editor.Workflow")],E);const pt=E;var $e;const He=Symbol(),se=Symbol(),Me=Symbol();let W=$e=class extends pt{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new Ot,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=Pe((t,a,i)=>Z(t,a,i))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var r,n;if(this.numPendingFeatures>0)return!0;const{creationInfo:e,upload:t}=this.data,a=this._sketchViewModel,{activeComponent:i}=a,s=(n=(r=a.createGraphic)==null?void 0:r.geometry)==null?void 0:n.type;return!(s!=="polyline"&&s!=="polygon"&&s!=="multipoint"||(i==null?void 0:i.type)!=="draw-2d"&&(i==null?void 0:i.type)!=="draw-3d")&&i.drawOperation.committedVertices.length>0||!(!t||t.state!=="pending"&&t.state!=="success")||!!(e!=null&&e.geometryToPlace)}get helpMessage(){var s;const{creationInfo:e,viewModel:t}=this.data;if(this.stepId!=="creating-features"||!e)return;const a=e.layer.geometryType,i=this._sketchViewModel.createGraphic;if(a==="mesh"){this._getDrawMeshHelpMessage||$(()=>import("./helpMessageUtils3d-iCaxCkPU.js"),__vite__mapDeps([6,1,2,7])).then(n=>{this._getDrawMeshHelpMessage=n.getDrawMeshHelpMessage});const{view:r}=t;return(r==null?void 0:r.type)==="3d"?(s=this._getDrawMeshHelpMessage)==null?void 0:s.call(this,i,r):void 0}return Ha(a,i==null?void 0:i.geometry)}get layer(){var e;return(e=this.data.creationInfo)==null?void 0:e.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return this.numPendingFeatures===0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.data.editorItem)==null?void 0:e.capabilities.create.reliesOnOwnerAdminPrivileges)??!1}get shouldShowAttachments(){var e;return((e=this.data.editorItem)==null?void 0:e.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){return{addAttachment:(e,t)=>{this._attachmentFileInfos.set(e,t)},sketchViewModel:this._sketchViewModel}}async enter(){this._isActive=!0,this.stepId!=="awaiting-feature-creation-info"&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([Me])}async updatePendingFeature(e,t){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),ft(this._lastActiveGraphics,e),this._startUpdating(e,t)}async start(){var e;return await super.start(),pe((e=this.data.creationInfo)==null?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:a,isNested:i,creationInfo:s,parent:r,snappingManager:n,startAt:d,viewModel:c}=e,p=e.sketchOptions??new Le,u=s==null?void 0:s.layer,m=u?c.findEditorItemForLayer(u):void 0,f=new $e({data:new z({creationInfo:s,editorItem:m,parent:r,sketchOptions:p,snappingManager:n,viewModel:c}),isNested:i,onCommit:async w=>{var q;const{creationInfo:k}=w;if(!k)return;const y=w.pendingFeatures.toArray(),{layer:I}=k,M=((q=I.capabilities)==null?void 0:q.editing.supportsGlobalId)&&"globalIdField"in I,C=f._attachmentFileInfos;if(M){const me=$i(y,I,C);return void await a(I,me,{globalIdUsed:!0})}const b=await a(I,{addFeatures:y});if(C.size>0){const me=(b==null?void 0:b.addFeatureResults)??[];await t(I,Ei(y,me,I,C))}}});return f._set("steps",this._createWorkflowSteps(f,d)),f}_fadeExistingFeatures(e){if("effect"in e){const a=e.effect;return e.effect="saturate(0.6) opacity(0.8)",F(()=>e.effect=a)}const t=e.opacity;return e.opacity=.7,F(()=>e.opacity=t)}_highlight(e){const t=this.data.viewModel.view;(t==null?void 0:t.type)==="3d"&&this._highlightHandles.set(e,t.highlight(e))}_removeHighlight(e){Ce(this._highlightHandles.get(e)),this._highlightHandles.delete(e)}async _startCreating(e){this.removeHandles(se);const{creationInfo:t}=this.data;if(!t)return;this.createFeatureState="create-new";const a=await di(this._sketchViewModel,t,e);this.addHandles(a,se)}async _startUpdating(e,t){var k;const{pendingFeatures:a}=this;a.includes(e)||a.add(e);const{_featureFormViewModel:i,_sketchViewModel:s}=this,{creationInfo:r,viewModel:n}=this.data,{attachmentsViewModel:d,layerInfos:c,view:p}=n;if(!p||!r)return;const u=r.layer,m=ci(c,u),f=m==null?void 0:m.formTemplate,w=p.spatialReference;if(i.set({arcadeEditType:"INSERT",feature:e,formTemplate:f,spatialReference:w,map:p.map}),d.mode!=="add"&&d.mode!=="edit"||((k=n.activeWorkflow)==null||k.previous()),d.graphic=e,d.fileInfos.removeAll(),d.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach(({file:y,form:I})=>d.addFile(y,I)),this._removeHighlight(e),await Z(e,t,p.type==="2d"?p.scale:null),this.removeHandles(se),Ce(this._featureFormHandle),p.type==="2d"){const y=_(()=>p.scale,I=>this._updateGraphicDebounced(e,t,I));this.addHandles(y,se)}return this._featureFormHandle=X([i.on("value-change",async()=>{e.attributes=i.getValues(),await Z(e,t,p.type==="2d"?p.scale:null)}),s.on(["update","undo","redo"],y=>{(y.type==="undo"||y.type==="redo"||y.type==="update"&&y.toolEventInfo!=null&&Nt(y.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()})]),this.createFeatureState="update-pending",this._visualVariableAttributes=ct(e),pe(u)?void 0:Ke({graphic:e,sketchViewModel:s,sourceLayer:u,visualVariables:this._visualVariableAttributes,webStyleCache:t})}static _createWorkflowSteps(e,t="awaiting-feature-creation-info"){const{data:a}=e,i=zt(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:s,viewModel:r}=a,{view:n}=r;n&&(ve(s)?e.addHandles(await Ii({view:n,data:a,next:()=>e.next(),cancel:()=>r.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(a.parent&&s&&(e.addHandles(r.lockFeatureTemplatesViewModel(),this.id),r.featureTemplatesViewModel.layers=[s.layer]),e.addHandles(r.featureTemplatesViewModel.on("select",({item:d})=>{d&&(a.creationInfo={...a.creationInfo,layer:d.layer,template:d.template},e.next())}),this.id)))},async tearDown(){e.removeHandles([this.id,se])}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(s){const{viewModel:r}=a;s.canceled&&(e.removeHandles([Me,He,se]),r.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=a.viewModel,{graphic:r,fileInfos:n}=s;e._attachmentFileInfos.set(r,n.toArray()),s.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=a.viewModel,{graphic:r,fileInfos:n}=s;e._attachmentFileInfos.set(r,n.toArray()),s.mode="view"}})});return ki(a,i)}static _configureSketchViewModel(e,t){const{data:a}=e,{creationInfo:i,viewModel:s}=a,{view:r}=s,n=e._sketchViewModel;let d=null;const c=[];if(!r)return F();r.type==="2d"&&i&&c.push(e._fadeExistingFeatures(i.layer)),c.push(n.on("create",async u=>{if(u.state==="cancel"){if(e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(e._lastActiveGraphics.length<1)return e._startCreating(t);const m=e._lastActiveGraphics.pop();return e._startUpdating(m,t)}if(u.state==="complete"&&u.graphic)return e._startUpdating(u.graphic,t)}),n.on("update",async u=>{var C;const{attachmentsViewModel:m}=s,{_featureFormViewModel:f}=e,w=u.graphics[0];if(u.state==="complete"){if(w!==d&&(e._lastActiveGraphics.push(w),e._highlight(w)),d=null,e.numPendingFeatures===(i==null?void 0:i.maxFeatures)){const b=e._lastActiveGraphics.pop();return e._startUpdating(b,t)}if(!f.submittable){f.submit();const b=e._lastActiveGraphics.pop();return e._startUpdating(b,t)}if(m.mode!=="add"&&m.mode!=="edit"||((C=s.activeWorkflow)==null||C.previous()),u.aborted&&e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);e.addHandles([Je(r),r.on("click",b=>b.preventDefault())],He),await x(()=>!f.updating),e.removeHandles(He),e._startCreating(t)}u.state==="start"&&e._removeHighlight(w);const k=e._visualVariableAttributes;await Gt(r,w,u,k,t);const y=w.attributes,{rotation:I,size:M}=k;if(I!=null){const{field:b}=I;f.setValue(b,y[b])}if(M!=null){const{field:b}=M;f.setValue(b,y[b])}}),n.on("delete",async u=>{const m=u.graphics[0];e.pendingFeatures.remove(m),ft(e._lastActiveGraphics,m),d=m}),r.on("immediate-click",async u=>{if(ve(i))return;const{results:m}=await r.hitTest(u,{include:n.layer}),f=m.find(k=>k.type==="graphic"&&k.graphic.sourceLayer===(i==null?void 0:i.layer));if(!f)return;const w=f.graphic;if(n.activeTool==="transform"||n.activeTool==="reshape"){if(n.updateGraphics.at(0)===w||!e._featureFormViewModel.submittable)return;await e.updatePendingFeature(w,t)}},Lt.TOOL),F(()=>{e._preventDefaultActionOnCancel=!0,n.cancel()}),Ci(n,a));const p=X(c);return n.addHandles(p),p}_initializeSketchViewModel(){var s;const{data:e}=this,{view:t}=e.viewModel,a=new lt({elevationInfo:(s=e.creationInfo)==null?void 0:s.layer.elevationInfo,internal:!0,listMode:"hide"}),i=new ot({layer:a,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:t});this._sketchViewModel=i,t==null||t.map.add(a),this.addHandles(F(()=>{t!=null&&t.destroyed||(t==null||t.map.remove(a)),a.destroy()}))}async _setUpCreatingFeaturesStep(){var k;if(this.hasHandles(Me))return;const{creationInfo:e,viewModel:t}=this.data,{attachmentsViewModel:a,view:i}=t;if(!i||!(e!=null&&e.layer))throw new A("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:s,layer:r}=e,n=this._sketchViewModel,d=new Map,c=[];this._lastActiveGraphics=[],this._featureFormHandle=Ce(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=t.findEditorItemForLayer(e.layer),Mi(a),c.push(_(()=>a.mode,y=>{switch(y){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const p=Je(i);c.push(p);const u=pe(e.layer);try{if(u){const y=s??new it({attributes:{...(k=e.template)==null?void 0:k.prototype.attributes,...e.attributeOverrides},sourceLayer:r});await this._startUpdating(y,d)}else c.push($e._configureSketchViewModel(this,d)),s?(n.layer.add(s),await this._startUpdating(s,d)):await this._startCreating(d)}finally{p.remove()}const m=F(()=>this.pendingFeatures.drain(y=>n.layer.remove(y))),f=_(()=>i==null?void 0:i.timeZone,y=>this._featureFormViewModel.timeZone=y,te),w=F(()=>{ve(e)&&t.cancelWorkflow({warnIfNoWorkflow:!1})});this._featureFormHandle&&c.push(this._featureFormHandle),this.addHandles(c,this._handleKeys.beforeCommit),this.addHandles([F(()=>a.fileInfos.removeAll()),X(c),w,m,f],Me)}};function Ci(e,t){let a=null;const i=()=>e.snappingOptions.featureSources,s=()=>(a=new xa({layer:e.layer}),i().add(a),a),r=()=>{a!=null&&(i().remove(a),a=rt(a))};return X([_(()=>{var c;const n=(c=t.creationInfo)==null?void 0:c.layer,d=i().find(p=>p.layer===n);return{hasFeatureLayerSource:!!d,enabled:(d==null?void 0:d.enabled)??!1}},({hasFeatureLayerSource:n,enabled:d})=>{if(!n)return r();a??(a=s()),a.enabled=d},ge),F(r)])}function Ei(e,t,a,i){const s=[];return t.forEach((r,n)=>{if(!r.error){const d=e[n],c=i.get(d)||[];d.attributes[a.objectIdField]=r.objectId,c.forEach(({form:p})=>s.push({feature:d,attachment:p}))}}),s}function $i(e,t,a){const i=[],s=t.globalIdField;return e.forEach((r,n)=>{var d;(d=e[n].attributes)[s]??(d[s]=wt()),((a==null?void 0:a.get(r))||[]).forEach(({file:c})=>i.push({feature:r,attachment:{globalId:wt(),data:c}}))}),i.length?{addFeatures:e,addAttachments:i}:{addFeatures:e}}o([l({constructOnly:!0})],W.prototype,"isNested",void 0),o([l()],W.prototype,"featureFormViewModel",null),o([l()],W.prototype,"hasPendingEdits",null),o([l()],W.prototype,"_getDrawMeshHelpMessage",void 0),o([l()],W.prototype,"helpMessage",null),o([l()],W.prototype,"layer",null),o([l()],W.prototype,"parent",null),o([l()],W.prototype,"parentLayer",null),o([l()],W.prototype,"keyboardCancellationEnabled",null),o([l()],W.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],W.prototype,"shouldShowAttachments",null),o([l()],W.prototype,"shouldAllowAttachmentEditing",null),o([l()],W.prototype,"sketchViewModel",null),W=$e=o([O("esri.widgets.Editor.CreateFeaturesWorkflow")],W);const Bt=W;function kt(e){return e==null?null:JSON.stringify(e)}let j=class extends ae{constructor(t){super(t),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){return this._stringifyAttributes(this.feature)!==this._stringifyAttributes(this.initialFeature)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){var t;this.initialFeature=(t=this.feature)==null?void 0:t.clone()}updateAttributes(t){const{feature:a}=this;a&&(a.attributes=t,this.notifyChange("attributesModified"))}updateGeometry(t){const{feature:a}=this;a&&(a.geometry=t,this.notifyChange("geometryModified"))}_stringifyAttributes(t){return kt(t==null?void 0:t.attributes)}_stringifyGeometry(t){const a=t==null?void 0:t.geometry;return kt((a==null?void 0:a.type)==="mesh"?{transform:a.transform,vertexSpace:a.vertexSpace}:a)}};o([l()],j.prototype,"_stagedForDelete",void 0),o([l()],j.prototype,"attributesModified",null),o([l()],j.prototype,"feature",void 0),o([l()],j.prototype,"geometryModified",null),o([l()],j.prototype,"initialFeature",void 0),o([l()],j.prototype,"modified",null),j=o([O("esri.widgets.Editor.Edits")],j);var Ae;let N=Ae=class extends ae{constructor(e){super(e),this.editorItem=null,this.edits=null,this.parent=null,this.relatedRecordCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const e=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:e,update:e,delete:e}}}get formTemplate(){return this.editorItem.formTemplate}static async create(e){const t=Ae._makeConstructorProps(e);return new Ae(t)}static _makeConstructorProps(e){const{feature:t,parent:a,relatedRecordCallbacks:i,viewModel:s}=e,r=s.editorItems.find(n=>n.layer===t.layer);if(!r)throw new A("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{editorItem:r,edits:new j({feature:t}),parent:a,relatedRecordCallbacks:i,viewModel:s}}};o([l()],N.prototype,"attachmentsCapabilities",null),o([l({constructOnly:!0})],N.prototype,"editorItem",void 0),o([l()],N.prototype,"edits",void 0),o([l()],N.prototype,"formTemplate",null),o([l()],N.prototype,"parent",void 0),o([l()],N.prototype,"relatedRecordCallbacks",void 0),o([l()],N.prototype,"viewModel",void 0),N=Ae=o([O("esri.widgets.Editor.UpdateRecordWorkflowData")],N);const qt=N;var We;let de=We=class extends qt{constructor(e){super(e),this.sketchOptions=null,this.snappingManager=null}static async create(e){const{feature:t,snappingManager:a,viewModel:i}=e,s=e.sketchOptions??new Le,{view:r}=i;if(!r)throw new A("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const n=await he(r,t.layer);return new We({...We._makeConstructorProps(e),layerView:n,sketchOptions:s,snappingManager:a})}};o([l()],de.prototype,"layerView",void 0),o([l({constructOnly:!0})],de.prototype,"sketchOptions",void 0),o([l()],de.prototype,"snappingManager",void 0),de=We=o([O("esri.widgets.Editor.UpdateFeatureWorkflowData")],de);const Ai=de;var Xe;const Ye={exit:Symbol()},Wi="esri.widgets.Editor.UpdateRecordWorkflow";let T=Xe=class extends pt{constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:a}=e.viewModel,i=t.feature,s=new AbortController;this.addHandles(ca(s)),this._updatingHandles.addPromise(mi(i,e.viewModel.view.spatialReference,s.signal).then(r=>{pa(s)||(this._onFullFeatureLoaded(r),this._initializeFeatureFormViewModel())},r=>this.cancel({force:!0,error:new A("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:r}})}))),a&&(this._highlightHelper=new Dt({view:a}),this.addHandles(F(()=>{var r;return(r=this._highlightHelper)==null?void 0:r.removeAll()})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const e=this.editorItem.capabilities;return e.update.reliesOnOwnerAdminPrivileges||e.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(e){this.removeHandles(Ye.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:a,viewModel:i}=e,{attachmentsViewModel:s}=i;s.set({capabilities:a,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([F(()=>s.fileInfos.removeAll()),_(()=>s.mode,r=>{switch(r){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],Ye.exit)}_initializeFeatureFormViewModel(){const{edits:e,formTemplate:t,viewModel:{view:a}}=this.data,i=this._featureFormViewModel=new Ot({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:t,highlightHelper:this._highlightHelper,map:a==null?void 0:a.map,spatialReference:a.spatialReference,timeZone:a==null?void 0:a.timeZone});i.relatedRecordCallbacks={...this.data.relatedRecordCallbacks,showAllRelatedRecords:r=>i.relationshipId=r.relationshipId};const{initialFeature:s}=e;s&&i.overrideInitialFeature(s),this.addHandles([i.on("value-change",()=>{e.updateAttributes(i.getValues()),this.fullFeature.attributes=e.feature.attributes}),_(()=>a==null?void 0:a.timeZone,r=>i.timeZone=r)])}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new Xe({data:await qt.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}};T._onCommitFactory=e=>async t=>{var d;const{edits:a}=t,{feature:i}=a;if(!i)return;const s=i.sourceLayer,r=i.clone();if(!a.attributesModified||a.stagedForDelete){const c=s.objectIdField;if(r.attributes={[c]:i.getAttribute(c)},Ct()&&Et()&&s.type==="scene"&&s.infoFor3D!=null){const p=(d=s.associatedLayer)==null?void 0:d.globalIdField;p!=null&&r.setAttribute(p,i.getAttribute(p))}}a.geometryModified&&!a.stagedForDelete||(r.geometry=null);const n=a.stagedForDelete?"deleteFeatures":"updateFeatures";await e(s,{[n]:[r]})},o([l()],T.prototype,"editorItem",null),o([l()],T.prototype,"featureFormViewModel",null),o([l()],T.prototype,"fullFeature",void 0),o([l()],T.prototype,"hasPendingEdits",null),o([l()],T.prototype,"layer",null),o([l()],T.prototype,"parent",null),o([l()],T.prototype,"parentLayer",null),o([l()],T.prototype,"shouldShowAttachments",null),o([l()],T.prototype,"shouldAllowAttachmentEditing",null),o([l()],T.prototype,"reliesOnOwnerAdminPrivileges",null),T=Xe=o([O(Wi)],T);var et;const H={...Ye,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol()};let ce=et=class extends T{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var e;(e=this._layerViewEditSession)==null||e.rollback()}async commit(){this.removeHandles(H.sketchGraphics);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?t==null||t.rollback():t==null||t.commit()}catch(e){throw await this._configureSketchViewModel(),new A("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:e})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles(this._featureFormViewModel.on("value-change",e=>{var t;(t=this._layerViewEditSession)==null||t.setAttribute(e.fieldName,e.value)}))}_configureHighlight(){const{edits:e,layerView:t}=this.data;Na(t)&&this.addHandles(t.highlight(e.feature),H.highlights)}async _configureSketchViewModel(){const e=this._sketchViewModel;if(!e)return;const{data:t,_featureFormViewModel:a,_sketchGraphicClone:i}=this,{edits:s,viewModel:r}=t,n=s.feature,{view:d}=r,c=ct(n),p=await gi({feature:n,featureClone:i,visualVariableAttributes:c,sketchViewModel:e,view:d,onUpdate:({geometry:u,attributes:m},f)=>{if(s.updateAttributes(m),s.updateGeometry(u),a.feature.geometry=u,c.rotation!=null){const{field:w}=c.rotation;a.setValue(w,m[w])}if(c.size!=null){const{field:w}=c.size;a.setValue(w,m[w])}(f.type==="undo"||f.type==="redo"||f.type==="update"&&f.toolEventInfo!=null&&Nt(f.toolEventInfo.type))&&a.notifyFeatureGeometryChanged()},webStyleCache:this._webStyleCache});this.addHandles(p,H.sketchGraphics),e.addHandles(p)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,a=e.edits.feature,{capabilities:i,layer:s}=e.editorItem,{view:r}=e.viewModel;if(this.removeHandles([H.highlights,H.sketchGraphics,H.sketchViewModel]),!i.update.geometry)return{enter:async()=>{this.hasHandles(H.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([H.highlights])};const n=new lt({elevationInfo:s.elevationInfo,internal:!0,listMode:"hide"}),d=new ot({allowDeleteKey:!1,layer:n,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:r});return this._sketchViewModel=d,r==null||r.map.add(n),this.addHandles(F(()=>{r!=null&&r.destroyed||(r==null||r.map.remove(n)),n.destroy(),this._sketchViewModel=rt(d)}),H.sketchViewModel),await Z(t,this._webStyleCache,(r==null?void 0:r.type)==="2d"?r.scale:null),this.addHandles([await yi(d,a,t)]),{enter:async()=>{this.hasHandles(H.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([H.sketchGraphics]),viewModel:d}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e);const t=this._sketchGraphicClone=Qe(e),{edits:a,layerView:i}=this.data;a.updateGeometry(e.geometry),a.trackChanges(),Fi(i)&&(this._layerViewEditSession=i.createInteractiveEditSession(t))}static async create(e){const t=new et({data:await Ai.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}get test(){return{graphicClone:this._sketchGraphicClone,sketchViewModel:this._sketchViewModel}}};o([l()],ce.prototype,"_layerViewEditSession",void 0),o([l()],ce.prototype,"_sketchGraphicClone",void 0),o([l()],ce.prototype,"_sketchViewModel",void 0),ce=et=o([O("esri.widgets.Editor.UpdateFeatureWorkflow")],ce);let B=class extends ae{constructor(t){super(t),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};o([l()],B.prototype,"addAttachmentsCallback",void 0),o([l()],B.prototype,"applyEditsCallback",void 0),o([l()],B.prototype,"candidates",void 0),o([l()],B.prototype,"rootFeature",void 0),o([l({constructOnly:!0})],B.prototype,"sketchOptions",void 0),o([l()],B.prototype,"snappingManager",void 0),o([l()],B.prototype,"viewModel",void 0),B=o([O("esri.widgets.Editor.UpdateWorkflowData")],B);const Vi=B;var tt;const jt="esri.widgets.Editor.UpdateWorkflow",Oi=()=>G.getLogger(jt);let S=tt=class extends pt{constructor(e){super(e),this._workflowStack=new gt(yt),this._sketchStack=new gt(yt),this.type="update"}get activeEditorItem(){var e;return((e=this.activeWorkflow)==null?void 0:e.data.editorItem)??void 0}get activeFeatureFormViewModel(){var e;return(e=this.activeWorkflow)==null?void 0:e.featureFormViewModel}get activeSketchViewModel(){var e;return(e=this._sketchStack.peek())==null?void 0:e.viewModel}get activeWorkflow(){return this._workflowStack.last()}get hasUpdatableCandidates(){const{candidates:e,viewModel:t}=this.data;return e.some(({layer:a})=>{var i;return(i=t.findEditorItemForLayer(a))==null?void 0:i.supportsUpdateWorkflow})}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var e;return!!((e=this.activeEditorItem)!=null&&e.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var e;return!!((e=this.activeEditorItem)!=null&&e.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some(e=>e.hasPendingEdits)}get helpMessage(){var e;return(e=this.activeWorkflow)!=null&&e.helpMessage?this.activeWorkflow.helpMessage:this.stepId==="awaiting-feature-to-update"?"select":void 0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.activeWorkflow)==null?void 0:e.reliesOnOwnerAdminPrivileges)??!1}get hasInvalidFormTemplate(){var e;return!!((e=this.activeEditorItem)!=null&&e.hasInvalidFormTemplate)}async back(e=()=>Promise.resolve(!0)){const{activeWorkflow:t}=this;if((t==null?void 0:t.featureFormViewModel.relationshipId)==null)if(t){if(t.hasPendingEdits&&!await e())return;t.hasPreviousStep?await t.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else t.featureFormViewModel.relationshipId=null}async cancelActiveWorkflow(e){var t;await((t=this.activeWorkflow)==null?void 0:t.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(e=>e.commit()),await super.commit()}static create(e){const{viewModel:t,snappingManager:a,startAt:i,addAttachmentsCallback:s,applyEditsCallback:r}=e,n=e.sketchOptions??new Le,d=new tt({data:new Vi({addAttachmentsCallback:s,applyEditsCallback:r,sketchOptions:n,snappingManager:a,viewModel:t}),onCommit:async()=>{}});return d._set("steps",this._createWorkflowSteps(d,i)),d}async save(){var e;this.nestedWorkflowCount>1?(await((e=this.activeWorkflow)==null?void 0:e.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=await this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new A("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:t})}}async startUpdating(e){try{const t=await this._createNestedUpdateWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new A("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:t})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new A("editor:nothing-to-delete","There is no feature to delete");Si(e)?await e.deleteAndCommit():await e.cancel(),this.nestedWorkflowCount===1?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack(e=>e.cancel({force:!0}))}async _createNestedCreateFeaturesWorkflow(e){var u;const{relatedLayer:t}=e,{addAttachmentsCallback:a,applyEditsCallback:i,sketchOptions:s,snappingManager:r,viewModel:n}=this.data;if(!Re(t))throw new A("editor:unsupported-layer","Editing is not supported on the provided layer");const d=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),c=d.template||d.initialFeature?"creating-features":"awaiting-feature-creation-info",p=((u=this.activeWorkflow)==null?void 0:u.type)!=="create-features"?this.activeWorkflow:void 0;return Bt.create({addAttachmentsCallback:a,applyEditsCallback:i,creationInfo:d,isNested:!0,parent:p,sketchOptions:s,snappingManager:r,startAt:c,viewModel:n})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!Re(t)||ua(t))throw new A("editor:unsupported-layer","Editing is not supported on the provided layer");const a={layer:t,maxFeatures:1},i=this._makeRelatedRecordAttributes(e),s=St(t);return(s==null?void 0:s.length)>0?(a.attributeOverrides=i,s.length===1&&(a.template=s[0])):a.initialFeature=new it({sourceLayer:t,attributes:i}),a}async _createNestedUpdateWorkflow(e){var c;const t=pe(e.sourceLayer)?T:ce,{applyEditsCallback:a,sketchOptions:i,snappingManager:s,viewModel:r}=this.data,n=((c=this.activeWorkflow)==null?void 0:c.type)!=="create-features"?this.activeWorkflow:void 0,d=await t.create({feature:e,parent:n,sketchOptions:i,snappingManager:s,viewModel:r,applyEdits:a,relatedRecordCallbacks:{addRelatedRecord:async p=>await this.startCreatingRelatedRecord(p),editRelatedRecord:async({relatedFeature:p})=>await this.startUpdating(p)}});return await x(()=>!d.updating),d}async _drainWorkflowStack(e){const t=this._workflowStack,a=[];for(;t.length>0;){const i=t.pop();this._sketchStack.pop();const s=e(i).then(()=>i.destroy());this._updatingHandles.addPromise(s),a.push(s)}await Promise.all(a)}_makeRelatedRecordAttributes(e){var c,p;const{parentFeature:t,relatedLayer:a,relationshipId:i}=e;if(!Ba(t))return;const s=(c=a.relationships)==null?void 0:c.find(u=>u.id===i);if(!s)return void fe("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if(s.role==="origin")return void fe("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const r=t.sourceLayer;s.relatedTableId!==r.layerId&&fe("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const n=(p=r.relationships)==null?void 0:p.find(u=>u.id===i);if(!n)return void fe("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=t.getAttribute(n.keyField);return d||fe("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[s.keyField]:d}}async _popWorkflow(){var t;(t=this._workflowStack.pop())==null||t.destroy(),this._sketchStack.pop();const e=await this._reconcileWorkflowStack();if(e.failureCount>0)throw new A("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",e)}async _pushWorkflow(e){var n;const t=this._workflowRequiresSketchViewModel(e);(n=this.activeWorkflow)==null||n.exit({removeSketchHandles:t});const a=this._sketchStack,i=await(e==null?void 0:e.start()),s=a.peek();i?(s==null||s.exit(),a.push(i)):a.push(this._cloneSketchController(s)),this._workflowStack.push(e);const r=await this._reconcileWorkflowStack();if(r.failureCount>0)throw new A("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",r)}async _reconcileWorkflowStack(){var a;const e=this._workflowStack,t=this._sketchStack;try{const i=e.peek();return await(i==null?void 0:i.enter()),await((a=t.peek())==null?void 0:a.enter()),{activeWorkflow:i,failureCount:0}}catch{e.pop().destroy(),t.pop();const{activeWorkflow:s,failureCount:r}=await this._reconcileWorkflowStack();return{activeWorkflow:s,failureCount:r+1}}}_cloneSketchController(e){return{enter:(e==null?void 0:e.enter)??(async()=>{}),exit:(e==null?void 0:e.exit)??(async()=>{}),viewModel:e==null?void 0:e.viewModel}}_workflowRequiresSketchViewModel(e){var a;const{type:t}=e;return t==="update-feature"||t==="create-features"&&!pe((a=e.data.creationInfo)==null?void 0:a.layer)}static _createWorkflowSteps(e,t="awaiting-feature-to-update"){const{data:a}=e;return zt(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:i}=a.viewModel,s=a.viewModel.view;let r=null;e.addHandles(F(()=>{r=Ge(r)}),this.id),a.rootFeature=null,a.candidates=[];const n=s.on("immediate-click",async d=>{i.location=d.mapPoint,i.visible=!0,r==null||r.abort();const{editorItems:c}=a.viewModel;r=new AbortController;const p=await d.async(()=>new Promise((u,m)=>{ha(r==null?void 0:r.signal,()=>m(ma())),u(pi(c,s,d,r==null?void 0:r.signal))}));ke(r),a.candidates=p.filter(u=>u.status==="fulfilled").flatMap(u=>u.value),i.visible=a.candidates.length===1,a.candidates.length!==0&&(d.stopPropagation(),a.candidates.length===1?(a.rootFeature=a.candidates[0],e.go("editing-existing-feature").catch(()=>{}).then(()=>i.visible=!1)):e.next())},Lt.TOOL);s.focus(),e.addHandles(n,this.id)},async tearDown(){a.candidates.length===0&&(a.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){a.rootFeature=null;const{view:i}=a.viewModel;if(!i)return;const s=new Dt({view:i});e.addHandles([_(()=>a.rootFeature,(r,n)=>{s.remove(n),s.add(r)},ze),F(()=>s.removeAll())],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:i,viewModel:s}=e.data;if(!i)throw new A("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(i),s.spinnerViewModel.visible=!1;const r=Pe(async()=>{await x(()=>!e.updating),e.previous()});e.addHandles([_(()=>e.nestedWorkflowCount,(n,d)=>{n===0&&d!==0&&r()},ze)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){a.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){a.viewModel.attachmentsViewModel.mode="view"}})})}};o([l()],S.prototype,"activeEditorItem",null),o([l()],S.prototype,"activeFeatureFormViewModel",null),o([l()],S.prototype,"activeSketchViewModel",null),o([l()],S.prototype,"activeWorkflow",null),o([l()],S.prototype,"hasUpdatableCandidates",null),o([l()],S.prototype,"nestedWorkflowCount",null),o([l()],S.prototype,"shouldShowAttachments",null),o([l()],S.prototype,"shouldAllowAttachmentEditing",null),o([l()],S.prototype,"hasPendingEdits",null),o([l()],S.prototype,"helpMessage",null),o([l()],S.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],S.prototype,"hasInvalidFormTemplate",null),S=tt=o([O(jt)],S);const fe=(e,t)=>Oi().warn(`editor:${e}`,t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),Si=e=>!!e&&/update-/.test(e.type),Ti=S;let L=class extends ae{constructor(t){super(t),this.layer=null}get attachments(){var t;return{enabled:this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.data.supportsAttachment)}}get create(){var d;const{_effectiveCapabilities:t,layer:a}=this,i=this._createEnabled,s=i,r=(d=a.capabilities)==null?void 0:d.operations.supportsAdd,n=!!(t!=null&&t.operations.supportsAdd);return{attachments:{enabled:i&&this.attachments.enabled},attributes:i,enabled:i,geometry:s,reliesOnOwnerAdminPrivileges:!r&&n}}get delete(){var r;const{_effectiveCapabilities:t,layer:a}=this,i=(r=a.capabilities)==null?void 0:r.operations.supportsDelete,s=!!(t!=null&&t.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!!(t!=null&&t.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!i&&s}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var p;const{_effectiveCapabilities:t,layer:a}=this,i=this._updateEnabled,s=!(!i||!(t!=null&&t.editing.supportsGeometryUpdate)),r=(p=a.capabilities)==null?void 0:p.operations.supportsUpdate,n=!!(t!=null&&t.operations.supportsUpdate),d=this.attachments.enabled,c=d&&this._canCreateOrUpdate;return{attachments:{enabled:d,create:c,update:c},attributes:i,enabled:i,geometry:s,reliesOnOwnerAdminPrivileges:!r&&n}}get _createEnabled(){var t;return this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.operations.supportsAdd)}get _updateEnabled(){var t;return this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return fa(this.layer)}get _effectiveCapabilities(){return wa(this.layer)}};o([l()],L.prototype,"attachments",null),o([l()],L.prototype,"create",null),o([l()],L.prototype,"delete",null),o([l()],L.prototype,"layer",void 0),o([l()],L.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],L.prototype,"update",null),o([l()],L.prototype,"_createEnabled",null),o([l()],L.prototype,"_updateEnabled",null),o([l()],L.prototype,"_canCreateOrUpdate",null),o([l()],L.prototype,"_effectiveEnabled",null),o([l()],L.prototype,"_effectiveCapabilities",null),L=o([O("esri.layers.support.EditingCapabilities")],L);const bt=L,re="esri.views.layers.support.editableLayerViews";function Pi(e,t){const{associatedLayer:a}=e,i=a==null?void 0:a.infoFor3D;if(!i)return!1;const{supportedFormats:s,queryFormats:r}=i,n=ja("model/gltf-binary",s)??Za("glb",s);if(!(n!=null&&r.includes(n)))return G.getLogger(re).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const d=e.spatialReference,c=a.spatialReference;if(!xe(d,c))return G.getLogger(re).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${d.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${c.wkid}).`),!1;const p=a.sourceJSON.sourceSpatialReference;if(!(p==null||xe(p,c)))return G.getLogger(re).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${c.wkid}) is different from its source spatial reference (wkid:${p.wkid}).`),!1;const{view:{spatialReference:u,state:{viewingMode:m}}}=t,f=ga(d),w=m===Ka.Global;return f&&!w?(G.getLogger(re).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${d.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!f&&w?(G.getLogger(re).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${d.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(xe(d,u)||w&&ya(u)&&va(d))||(G.getLogger(re).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${d.wkid}) does not match the view spatial reference (wkid:${u.wkid}).`),!1)}let U=class extends bt{constructor(t){super(t),this.layerInfo=null,this.layerView=null}get attachments(){const t=this.defaults.attachments.enabled,a=this.layerInfo;return{enabled:t&&(a==null?void 0:a.allowAttachments)!==!1&&(a==null?void 0:a.enabled)!==!1}}get create(){const{attachments:t,defaults:a,layerInfo:i,layer:s,layerView:r}=this,n=a.create,d=(i==null?void 0:i.enabled)!==!1&&(i==null?void 0:i.addEnabled)!==!1,c=n.enabled&&d;return{attributes:c&&n.attributes,enabled:c,geometry:c&&n.geometry&&Mt(s,r),attachments:{enabled:t.enabled&&c&&(i==null?void 0:i.attachmentsOnCreateEnabled)!==!1},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get defaults(){return new bt({layer:this.layer})}get delete(){const{defaults:t,layerInfo:a}=this,i=t.delete,s=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.deleteEnabled)!==!1;return{enabled:i.enabled&&s,reliesOnOwnerAdminPrivileges:i.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:t,layerInfo:a}=this;return a!=null&&a.formTemplate?a.formTemplate:t&&"formTemplate"in t?t.formTemplate:null}get relationship(){var s,r,n;const{layer:t}=this,a=!(!qa(t)||!((s=t.relationships)!=null&&s.length)),i=!!((n=(r=this.formTemplate)==null?void 0:r.elements)!=null&&n.some(d=>d.type==="relationship"));return{enabled:a&&i}}get update(){const{attachments:t,defaults:a,layerInfo:i,layer:s,layerView:r}=this,n=a.update,d=(i==null?void 0:i.enabled)!==!1&&(i==null?void 0:i.updateEnabled)!==!1,c=n.enabled&&d,p=c&&n.attributes&&(i==null?void 0:i.attributeUpdatesEnabled)!==!1,u=c&&n.geometry&&(i==null?void 0:i.geometryUpdatesEnabled)!==!1&&Mt(s,r),m=t.enabled&&(i==null?void 0:i.attachmentsOnUpdateEnabled)!==!1;return{attributes:p,enabled:c,geometry:u,attachments:{enabled:m,create:m&&n.attachments.create,update:m&&n.attachments.update},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}};function Mt(e,t){return e.type!=="scene"||t!=null&&"type"in t&&t.type==="scene-layer-3d"&&Pi(e,t)}o([l()],U.prototype,"attachments",null),o([l()],U.prototype,"create",null),o([l()],U.prototype,"defaults",null),o([l()],U.prototype,"delete",null),o([l()],U.prototype,"formTemplate",null),o([l()],U.prototype,"layerInfo",void 0),o([l()],U.prototype,"layerView",void 0),o([l()],U.prototype,"relationship",null),o([l()],U.prototype,"update",null),U=o([O("esri.widgets.Editor.support.EditorEditingCapabilities")],U);const Li=U;let V=class extends ae{constructor(t){super(t),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var t;return!!((t=this.layerView)!=null&&t.suspended)}get capabilities(){return new Li({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:t,relationship:a,update:i,delete:{enabled:s}}=this.capabilities,r=t.attachments.enabled||i.attachments.enabled;return!this.disabled&&(t.enabled||i.enabled||r||s||a.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return Qa(this.layer,this.formTemplate)}get isTable(){return pe(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:t,geometry:a}=this.capabilities.create;return this.isTable?t:t&&a}get supportsUpdateWorkflow(){const{capabilities:t}=this;return!this.disabled&&(t.update.enabled||t.update.attachments.enabled||t.delete.enabled)}get visible(){const{layer:t}=this,a=t.parent;return!this._suspended&&t.visible&&(!a||!("visible"in a)||a.visible)}};o([l()],V.prototype,"_suspended",null),o([l()],V.prototype,"capabilities",null),o([l()],V.prototype,"disabled",void 0),o([l()],V.prototype,"editable",null),o([l()],V.prototype,"formTemplate",null),o([l()],V.prototype,"hasInvalidFormTemplate",null),o([l()],V.prototype,"isTable",null),o([l()],V.prototype,"layer",void 0),o([l()],V.prototype,"layerInfo",void 0),o([l()],V.prototype,"layerView",void 0),o([l()],V.prototype,"supportsCreateFeaturesWorkflow",null),o([l()],V.prototype,"supportsUpdateWorkflow",null),o([l()],V.prototype,"visible",null),V=o([O("esri.widgets.editor.support.EditorItem")],V);const Ui=V,Zt="esri.widgets.Editor.EditorViewModel",Kt=()=>G.getLogger(Zt),Qt=["create-features","update"];function oe(e,t,a){Kt().error(new A(e,t,a))}function xi(e,t){return e==null?void 0:e.find(a=>a.layer===t)}let g=class extends Vt.EventedAccessor{constructor(e){super(e),this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new lt({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updatingHandles=new Tt,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=new Ie,this.editorItems=new Ie,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new Ca({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new Aa({disabledItemFunction:({layer:t})=>this._itemIsSuspended(t)}),this.ownSketchViewModel=new ot({layer:this._sketchGraphicsLayer}),this.sketchOptions=new Le,this.snappingOptions=new Pt,this.spinnerViewModel=new Sa,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var t;this.canGoBack&&((t=this.activeWorkflow)!=null&&t.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var a;const{featureFormViewModel:t}=this;if(t){if(t.submit(),!t.submittable)return;const i=t.getValues();if(t.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)return}await((a=this.activeWorkflow)==null?void 0:a.save())},this.selectFeature=(t,a=!1)=>{const i=this.activeWorkflow;this._candidateCommitted||(i==null?void 0:i.type)!=="update"||(i.data.rootFeature=t,a&&(i.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([_(()=>{var s;const e=this.view,t=(s=e==null?void 0:e.map)==null?void 0:s.editableLayers,a=e==null?void 0:e.allLayerViews,i=a==null?void 0:a.filter(r=>!!(t!=null&&t.includes(r.layer)));return[t,i,this.layerInfos,this.allowedWorkflows]},()=>this._updateEditorItems(),ge),_(()=>this.hideTemplatesForInactiveLayers,()=>this.syncFeatureTemplates()),Q(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),Q(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),Q(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),ye(()=>{var e;return(e=this.view)==null?void 0:e.map},e=>e.add(this._sketchGraphicsLayer),te),Q(()=>this.editorItems,"change",()=>this._afterEditorItemsChange()),_(()=>[this.canCreate,this.canUpdateVisible],()=>this._afterEditorItemsChange()),_(()=>this.page,(e,t)=>{const a=[...this.pageStack];if(a.indexOf(e)===-1)a.push(e);else for(;a.length&&a.at(-1)!==e;)a.pop();this.pageStack=a},ge),ye(()=>this.state==="awaiting-update-feature-candidate",()=>this._candidateCommitted=!1),Q(()=>this.featureTemplatesViewModel,"select",async({item:e,oldItem:t})=>{var s;const{activeWorkflow:a}=this;if(a){if(a.type==="update"&&((s=a.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-creation-info")return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(t,{emit:!1})}}if(!e)return;const i={layer:e.layer,template:e.template};if(e.supportsUpload)return this.featureTemplatesViewModel.select(t,{emit:!1}),this.startCreateFeaturesWorkflow(i);this.startCreateFeaturesWorkflowAtFeatureCreation(i)}),Q(()=>this.view,"key-down",e=>{var t;e.key==="Escape"&&((t=this.activeWorkflow)!=null&&t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())}),Q(()=>this.sketchViewModel,["create","delete","update"],e=>{var n,d;const{activeWorkflow:t}=this,a=(t==null?void 0:t.type)==="update",i=a?(n=t.activeWorkflow)==null?void 0:n.layer:t==null?void 0:t.layer,s=a?(d=t==null?void 0:t.activeWorkflow)==null?void 0:d.parentLayer:void 0,r=`sketch-${e.type}`;this.emit(r,{type:r,detail:e,layer:i,parentLayer:s})},ze),_(()=>this.view,e=>{if(this._snappingManager=rt(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new Da({view:e,options:t})},ge),_(()=>this.snappingOptions,e=>{this._snappingManager&&(this._snappingManager.options=e)},ge)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{var e,t;(t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._sketchGraphicsLayer),this.view=null}),this._updateItemsTask=Ge(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=Ce(this._sketchEventListenerHandle)}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(e){Ne(G.getLogger(this),"allowedWorkflows",{replacement:"Editor.visibleElements",version:"4.29",warnOnce:!0}),e&&e.length!==0||(e=[...Qt]),this._set("allowedWorkflows",e)}get canCreate(){return this.editorItems.some(e=>e.supportsCreateFeaturesWorkflow)}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some(e=>e.supportsUpdateWorkflow)}get canUpdateVisible(){return this.editorItems.some(e=>e.supportsUpdateWorkflow&&e.visible)}get featureTemplatesLayers(){const e=new Ie;for(const t of this.editorItems){const a=t.supportsCreateFeaturesWorkflow&&!t.isTable,i=this.hideTemplatesForInactiveLayers&&!t.visible;a&&!i&&e.push(t.layer)}return e}get editableItems(){return Ne(G.getLogger(this),"editableItems",{replacement:"editorItems",version:"4.29",warnOnce:!0}),this.editorItems.map(e=>{const{capabilities:t,disabled:a,hasInvalidFormTemplate:i,layer:s}=e,r=[],n=t.create,d=t.update,c=t.delete;return n.enabled&&r.push("create"),d.enabled&&r.push("update"),c.enabled&&r.push("delete"),{layer:s,supports:r,suspended:a,attributeUpdatesEnabled:d.attributes,geometryUpdatesEnabled:d.geometry,attachmentsOnCreateEnabled:n.attachments.enabled,attachmentsOnUpdateEnabled:d.attachments.enabled,hasInvalidFormTemplate:i,hasAttachments:t.attachments.enabled}})}get featureFormViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeFeatureFormViewModel:(e==null?void 0:e.type)==="create-features"?e.featureFormViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}set layerInfos(e){(e==null?void 0:e.some(a=>"allowAttachments"in a))&&_a(Kt(),"Property: layerInfo.allowAttachments",{replacement:"layerInfo.attachmentsOnCreateEnabled or layerInfo.attachmentsOnUpdateEnabled",version:"4.26"}),this._set("layerInfos",e)}get sketchViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeSketchViewModel:(e==null?void 0:e.type)==="create-features"?e.sketchViewModel:this.ownSketchViewModel}get state(){var a,i;if(!((a=this.view)!=null&&a.ready))return"disabled";const e=this.attachmentsViewModel.mode;if(e==="add")return"adding-attachment";if(e==="edit")return"editing-attachment";const{activeWorkflow:t}=this;return t!=null&&t.stepId?t.type==="update"&&((i=t.activeWorkflow)!=null&&i.stepId)?t.activeWorkflow.stepId:t.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||((e=this.activeWorkflow)==null?void 0:e.updating)===!0}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get page(){const{activeWorkflow:e,state:t}=this;if((e==null?void 0:e.type)==="update"&&e.stepId==="awaiting-feature-to-update")return"ready";if((e==null?void 0:e.type)==="create-features"&&e.numPendingFeatures===0){const a=e.data.upload;if(a)return a.state==="default"?"ready":"creating-features-upload-details"}return t??"disabled"}get featureFormDisabled(){var t;const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"&&((t=e.activeEditorItem)==null?void 0:t.capabilities.update.attributes)===!1}get canGoBack(){return this.activeWorkflow!=null&&!this.syncing}get shouldShowDeleteButton(){var t;const{activeWorkflow:e}=this;return!!e&&e.type==="update"&&!!((t=e.activeEditorItem)!=null&&t.capabilities.delete.enabled)}get hasPendingEdits(){var e;return((e=this.activeWorkflow)==null?void 0:e.hasPendingEdits)??!1}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e,t="awaiting-feature-creation-info"){if(await x(()=>!this.updating),!this.canCreate)throw new A("editing:unsupported-workflow","Creating features is unsupported or disabled.");const a=this._createUpdatingResolver();await this._cancelWorkflow();const i=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",i),await i.start(),a.resolve()}async startCreateFeaturesWorkflowAtFeatureEdit(e){await x(()=>!this.updating);const t=this._createUpdatingResolver(),{initialFeature:a}=e,i=a.sourceLayer=a.layer,s=i?this.findEditorItemForLayer(i):void 0;if(!(s!=null&&s.supportsCreateFeaturesWorkflow))throw new A("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const r=this._createCreateFeaturesWorkflow({initialFeature:a,layer:s.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",r),await r.start(),t.resolve()}async startUpdateWorkflowAtFeatureSelection(){if(await x(()=>!this.updating),!this.canUpdate)return void oe("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();await this._cancelWorkflow();const t=this._createUpdateWorkflow();this._set("activeWorkflow",t),await t.start(),e.resolve()}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await x(()=>!this.updating),!this.canUpdate)return void oe("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();await this._cancelWorkflow();const a=this._createUpdateWorkflow("awaiting-update-feature-candidate");a.data.candidates=e,this._set("activeWorkflow",a),await a.start(),t.resolve()}async startUpdateWorkflowAtFeatureEdit(e){if(await x(()=>!this.updating),!this.canUpdate)return void oe("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();await this._cancelWorkflow();const a=this._createUpdateWorkflow("editing-existing-feature");a.data.rootFeature=e,this._set("activeWorkflow",a),await a.start(),t.resolve()}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&e.type==="update"?await e.deleteActiveFeature():oe("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find(t=>t.layer===e)}itemHasInvalidFormTemplate(e){var t;return e!=null&&((t=this.findEditorItemForLayer(e.layer))==null?void 0:t.hasInvalidFormTemplate)===!0}syncFeatureTemplates(){this._featureTemplatesViewModelLocked||(this.featureTemplatesViewModel.layers=this.featureTemplatesLayers.toArray())}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&this.state==="awaiting-feature-to-update"?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,F(()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()})}async _getEditorItemCandidates(e){const{view:t}=this;if(!(t!=null&&t.map))return[];const{map:a}=t,i=a.editableLayers.toArray()??[],s=a.allTables.toArray().filter(ka)??[];return await Promise.allSettled([...i.map(r=>r.type==="subtype-group"?r.loadAll():Promise.resolve()),...s.map(r=>r.load())]),ke(e),[...i.reverse(),...s.reverse()].filter(r=>Re(r)&&(r.geometryType!=="mesh"||t.type==="3d")).flatMap(r=>r.type==="subtype-group"?r.sublayers.toArray():r)}_drainEditorItems(){this.editorItems.drain(e=>e.destroy())}async _updateEditorItems(){Ge(this._updateItemsTask);const{view:e}=this,t=Wt(async a=>{if(!(e!=null&&e.map)||!(e!=null&&e.allLayerViews))return;const i=await this._getEditorItemCandidates(a);if(!i.length)return void this._drainEditorItems();const s=[],r=[],n=[],{layerInfos:d}=this;for(const p of i){const u=xi(d,p),m=await he(e,p).catch(()=>null);(u?s:m?r:n).push(new Ui({layer:p,layerInfo:u,layerView:m}))}d!=null&&d.length&&s.sort((p,u)=>d.findIndex(({layer:m})=>m===p.layer)-d.findIndex(({layer:m})=>m===u.layer));const c=[...s,...r,...n];a.aborted||(this._drainEditorItems(),this.editorItems.addMany(c))});this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;e.type!=="create-features"?e.type==="update"&&(t==="awaiting-feature-to-update"&&!this.canUpdateVisible||t==="awaiting-update-feature-candidate"&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():t!=="awaiting-feature-creation-info"||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(!t)return void((e==null?void 0:e.warnIfNoWorkflow)&&oe("editing:no-active-workflow","There is no active workflow to cancel."));if(!e||e.force!==!1)return this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await t.cancel(e);await t.cancel(e),this._set("activeWorkflow",null)}_createCreateFeaturesWorkflow(e,t){return Bt.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(a,i,s)=>this._applyEdits(a,i,s),addAttachmentsCallback:(a,i)=>this._addAttachments(a,i)})}_createUpdateWorkflow(e){return Ti.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(t,a,i)=>this._applyEdits(t,a,i),addAttachmentsCallback:(t,a)=>this._addAttachments(t,a)})}_addAttachments(e,t){const a=t.map(i=>this._addAttachment(e,i.feature,i.attachment))??[];return Promise.all(a)}async _addAttachment(e,t,a){var s;let i=null;if(!("addAttachment"in e)||((s=e.capabilities)==null?void 0:s.attachment)==null)throw new A("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>{var r;return i=await((r=e.addAttachment)==null?void 0:r.call(e,t,a).catch(n=>{throw(n==null?void 0:n.error)||n}))??null,i}),i}async _applyEdits(e,t,a){let i=null;const s=e.url?await ba(e.url):null,r={returnServiceEditsOption:(!s||!Ma(s))&&!RegExp("/hosted/","i").test(e.url)?"original-and-current-features":void 0,...a};return await this._queueOperation(async()=>{const{view:n}=this;if(!n)return null;const d=await he(n,e).catch(()=>null);return i=await e.applyEdits(t,r),d&&await x(()=>!d.updating),i}),i}_queueOperation(e){this._activityQueue.push(e);const t=(a,i)=>{const s=i.indexOf(a);s>-1&&i.splice(s,1)};return e().then(a=>{if(a!=null&&"error"in a&&a.error!=null)throw a.error;if(a!=null&&"addFeatureResults"in a){const{addFeatureResults:i,deleteFeatureResults:s,updateFeatureResults:r}=a,n=i.find(d=>!!d.error)||r.find(d=>!!d.error)||s.find(d=>!!d.error);if(n)throw n.error}return a}).catch(a=>{oe("editing:operation-error","An error occurred.",{error:a});const i={error:a,retry:()=>(t(i,this.failures),this._queueOperation(e)),cancel:()=>{t(i,this.failures)}};this._set("failures",[...this.failures,i])}).then(()=>{t(e,this._activityQueue)})}_createUpdatingResolver(){const e=st();return this._updatingHandles.addPromise(e.promise),e}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return t!=null&&(!t.visible||t.disabled)}};o([l({readOnly:!0})],g.prototype,"activeWorkflow",void 0),o([l({readOnly:!0})],g.prototype,"_activityQueue",void 0),o([l({value:[...Qt]})],g.prototype,"allowedWorkflows",null),o([l({readOnly:!0})],g.prototype,"canCreate",null),o([l()],g.prototype,"canCreateVisible",null),o([l({readOnly:!0})],g.prototype,"canUpdate",null),o([l()],g.prototype,"canUpdateVisible",null),o([l()],g.prototype,"featureTemplatesLayers",null),o([l()],g.prototype,"editableItems",null),o([l()],g.prototype,"editorItems",void 0),o([l({readOnly:!0})],g.prototype,"failures",void 0),o([l()],g.prototype,"hideTemplatesForInactiveLayers",void 0),o([l()],g.prototype,"attachmentsViewModel",void 0),o([l()],g.prototype,"featureFormViewModel",null),o([l()],g.prototype,"featureTemplatesViewModel",void 0),o([l()],g.prototype,"labelOptions",null),o([l()],g.prototype,"layerInfos",null),o([l()],g.prototype,"ownSketchViewModel",void 0),o([l()],g.prototype,"sketchOptions",void 0),o([l()],g.prototype,"sketchViewModel",null),o([l({type:Pt,nonNullable:!0})],g.prototype,"snappingOptions",void 0),o([l()],g.prototype,"spinnerViewModel",void 0),o([l()],g.prototype,"state",null),o([l({readOnly:!0})],g.prototype,"syncing",null),o([l()],g.prototype,"updating",null),o([l()],g.prototype,"tooltipOptions",null),o([l()],g.prototype,"valueOptions",null),o([l()],g.prototype,"view",null),o([l()],g.prototype,"pageStack",void 0),o([l()],g.prototype,"showDiscardEditsPrompt",void 0),o([l()],g.prototype,"_candidateCommitted",void 0),o([l()],g.prototype,"page",null),o([l()],g.prototype,"featureFormDisabled",null),o([l()],g.prototype,"canGoBack",null),o([l()],g.prototype,"shouldShowDeleteButton",null),o([l()],g.prototype,"hasPendingEdits",null),g=o([O(Zt)],g);const Di=g,ut="exclamation-mark-triangle";let R=class extends ae{constructor(t){super(t),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.labelsToggle=!0,this.snappingControls=!0,this.snappingControlsElements=new dt,this.tooltipsToggle=!0,this.undoRedoButtons=!1}};o([l({type:Boolean,nonNullable:!0})],R.prototype,"createFeaturesSection",void 0),o([l({type:Boolean,nonNullable:!0})],R.prototype,"directionModePicker",void 0),o([l({type:Boolean,nonNullable:!0})],R.prototype,"editFeaturesSection",void 0),o([l({type:Boolean,nonNullable:!0})],R.prototype,"labelsToggle",void 0),o([l({type:Boolean,nonNullable:!0})],R.prototype,"snappingControls",void 0),o([l({type:dt,nonNullable:!0})],R.prototype,"snappingControlsElements",void 0),o([l({type:Boolean,nonNullable:!0})],R.prototype,"tooltipsToggle",void 0),o([l({type:Boolean,nonNullable:!0})],R.prototype,"undoRedoButtons",void 0),R=o([O("esri.widgets.Editor.VisibleElements")],R);const Jt=R,we="esri-editor__panel-content",_e={base:we,message:`${we}__message`,section:`${we}__section`,sectionGroup:`${we}__section__group`,scrimContainer:`${we}__scrim-container`},be=()=>Y({scrim:()=>$(()=>import("./calcite-scrim-zRqTTpuY.js"),__vite__mapDeps([8,9,10,1,2,11,12,13,14,15,16,17]))});function J(e,...t){return h("div",{class:qe(_e.base,e!=null&&e.showScrimOverlay?_e.scrimContainer:void 0),key:(e==null?void 0:e.key)??"panel-content"},...t,e!=null&&e.showScrimOverlay?h("calcite-scrim",null):void 0)}function ht(e,...t){return h("div",{class:_e.message,"data-testid":"panel-content-message",key:(e==null?void 0:e.key)??"panel-content-message"},...t)}function ue(e,...t){return h("div",{class:_e.section,key:(e==null?void 0:e.key)??"panel-content-section"},...t)}function Hi(e,...t){return h("div",{class:_e.sectionGroup,key:(e==null?void 0:e.key)??"panel-content-section-group"},...t)}const Ri=()=>be();function Gi({helpMessage:e}){return h(J,{key:"creating-features-panel-content"},h(ht,{key:"content-message"},e))}const zi=()=>be();function Ni({editorItems:e,filterText:t,id:a,messagesTemplates:i,onFilterTextChange:s,onSelectFeature:r,workflow:n}){const d=new Map,c=n.data.candidates;let p=0;c.map(f=>({label:Bi(f),id:f.attributes[f.layer.objectIdField],data:f})).filter(({label:f,data:w})=>{const k=t.toLowerCase(),{title:y}=w.layer,I=e.find(M=>M.layer===w.sourceLayer);return I?I.supportsUpdateWorkflow&&(!k||(f==null?void 0:f.toLowerCase().includes(k))||(y==null?void 0:y.toLowerCase().includes(k))):null}).filter(Be).forEach(f=>{var k;p++;const w=f.data.layer;d.has(w)?(k=d.get(w))==null||k.items.push(f):d.set(w,{id:`${w.id}`,label:w.title??"",items:[f]})});const u=e.toArray().map(({layer:f})=>d.get(f)).filter(Be),m=p>10||t.length>0;return h(J,{key:"feature-list"},h(ue,null,Wa({enableListScroll:!1,filterEnabled:m,filterText:t,id:a,items:u,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},onFilterChange:f=>s(f),onItemMouseEnter:f=>r(f.data),onItemMouseLeave:()=>r(null),onItemSelect:f=>r(f.data,!0)})))}function Bi(e){const t=e.layer;if(!t)return null;const a=t.fieldsIndex.get(t.objectIdField),i=a.alias||a.name,{attributes:s}=e,r=At(t);return r&&s[r]&&`${s[r]}`||`${i}: ${s[a.name]}`}const qi={base:"esri-editor__actions"},mt=()=>Y({button:()=>$(()=>import("./calcite-button-BGRBzuhy.js"),__vite__mapDeps([18,19,10,1,2,20,12,13,21,22,23,24,11,14,15,16,25,17]))});function Te({buttons:e,key:t}){return h("div",{class:qi.base,key:t??"footer-actions",slot:"footer"},e.filter(Be).map(({disabled:a,onClick:i,label:s,...r},n)=>h("calcite-button",{disabled:a??!1,key:`action-${n}`,onclick:()=>{a||i()},slot:"footer-actions",width:"full",...r},s)))}const ji={notice:"esri-editor__notice"},Xt=()=>Y({notice:()=>$(()=>import("./calcite-notice-bdrVVIis.js"),__vite__mapDeps([26,10,1,2,27,15,12,13,24,11,14,16,28,23,25]))});function Zi({workflow:e,messages:t}){return h(nt,null,e!=null&&e.reliesOnOwnerAdminPrivileges?h(at,{message:t.ownerAdminNotice}):void 0,e!=null&&e.hasInvalidFormTemplate?h(at,{icon:ut,message:t.formFieldUpdateError}):void 0)}function at({message:e,...t}){return h("calcite-notice",{class:ji.notice,open:!0,scale:"s",...t},h("div",{slot:"message"},e))}const Ki={settingsContainer:"esri-editor__settings"},Qi=()=>Y({accordion:()=>$(()=>import("./calcite-accordion-Dt_0K2BQ.js"),__vite__mapDeps([29,10,1,2,15])),"accordion-item":()=>$(()=>import("./calcite-accordion-item-C0ydwyMG.js"),__vite__mapDeps([30,10,1,2,27,15,12,13,23,25]))});function Ji({editorViewModel:e,messagesCommon:t,visibleElements:a}){const{snappingOptions:i,sketchOptions:s,view:r}=e,n=[],d={directionModePicker:a.directionModePicker,labelsToggle:a.labelsToggle,tooltipsToggle:a.tooltipsToggle};return La(d)&&n.push(h(Ja,{sketchOptions:s,viewType:r==null?void 0:r.type,visibleElements:d})),a.snappingControls&&n.push(h(Xa,{afterCreate:c=>c.layerListOpen=!1,snappingOptions:i,view:r,visibleElements:a.snappingControlsElements??new dt})),n.length===0?null:h("calcite-accordion",{appearance:"transparent",class:Ki.settingsContainer,key:"settings"},h("calcite-accordion-item",{"data-testid":"settings",heading:t.settings,iconStart:"gear"},n))}const Xi={base:"esri-editor__panel-toolbar"},Yi=()=>Promise.all([Y({button:()=>$(()=>import("./calcite-button-BGRBzuhy.js"),__vite__mapDeps([18,19,10,1,2,20,12,13,21,22,23,24,11,14,15,16,25,17]))}),Qi()]);function es({editorViewModel:e,messagesCommon:t,visibleElements:a}){const{sketchViewModel:i}=e;return h("div",{class:Xi.base,key:"panel-toolbar"},h(Ji,{editorViewModel:e,messagesCommon:t,visibleElements:a}),a.undoRedoButtons?[h("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(i!=null&&i.canUndo()),iconStart:"undo",key:"undo-button",kind:"neutral",label:t.undo,onclick:()=>i==null?void 0:i.undo(),scale:"l"},t.undo),h("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(i!=null&&i.canRedo()),iconStart:"redo",key:"redo-button",kind:"neutral",label:t.redo,onclick:()=>i==null?void 0:i.redo(),scale:"l"},t.redo)]:null)}const ne="esri-editor__prompt",le={base:ne,header:`${ne}__header`,heading:`${ne}__header__heading`,message:`${ne}__message`,divider:`${ne}__divider`,actions:`${ne}__actions`},ts=()=>Y({button:()=>$(()=>import("./calcite-button-BGRBzuhy.js"),__vite__mapDeps([18,19,10,1,2,20,12,13,21,22,23,24,11,14,15,16,25,17])),icon:()=>$(()=>import("./calcite-icon-DW07N_Fi.js"),__vite__mapDeps([31,25,10,1,2,12,13,15])),scrim:()=>$(()=>import("./calcite-scrim-zRqTTpuY.js"),__vite__mapDeps([8,9,10,1,2,11,12,13,14,15,16,17]))});function as({actions:e,context:t,headingLevel:a,message:i,title:s}){const r=e.secondary;let n;switch(t){case"danger":n="danger";break;case"info":n="brand";break;default:n="neutral"}const d=h("calcite-button",{afterCreate:is,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:n,onclick:e.primary.action,scale:"m",width:r?"half":"full"},e.primary.label),c=r&&h("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:n,onclick:r.action,scale:"m",width:"half"},r.label);return h("calcite-scrim",{"data-testid":"prompt",key:"prompt"},h("div",{class:`${le.base}--${t}`},h("div",{class:le.header},h("calcite-icon",{icon:ut}),h(Oe,{class:le.heading,level:a},s)),h("div",{class:le.message},i),h("div",{class:le.divider}),h("div",{class:le.actions},c,d)))}function is(e){requestAnimationFrame(()=>e.setFocus())}const ss=()=>Promise.all([mt(),Xt(),be()]);function Ft({editorViewModel:e,headingLevel:t,messages:a,messagesCommon:i,onDelete:s,onSave:r,renderAttachments:n,renderFeatureForm:d}){const{activeWorkflow:c,featureFormViewModel:p,syncing:u}=e;if(!c||!p)return null;const m=c.type,f="activeWorkflow"in c?c.activeWorkflow:void 0,w=f==null?void 0:f.type,k=f&&!f.hasPendingEdits||m==="update"&&!c.hasPendingEdits||u||p.updating,y=m==="update"&&w!=="create-features"?i.update:i.create,I=m==="create-features"&&c.createFeatureState==="create-new",M=m==="create-features"?c.numPendingFeatures:0,C=M>1?Se(a.createFeaturesTemplate,{numFeatures:M}):y,b=c.shouldShowAttachments&&!p.activeRelationshipInput,q=p.inputs.every(me=>!me.visible)&&!b?h(ht,{key:"panel-content-message"},Se(a.clickToFinishTemplate,{button:y})):h(ue,{key:"panel-content-section"},h(Zi,{messages:a,workflow:c}),h(Hi,null,d(),b?h("div",{key:"attachments"},h(Oe,{level:Ee(t)},a.attachments),n()):null));return h(nt,null,h(J,{key:"attribute-panel-content",showScrimOverlay:I},q),h(Te,{buttons:[{onClick:r,disabled:k,label:C},e.shouldShowDeleteButton?{appearance:"outline",onClick:s,disabled:u,kind:"danger",label:i.delete}:void 0]}))}const P="esri-editor__upload-details",D={base:P,status:`${P}__status`,titleWrapper:`${P}__title-wrapper`,title:`${P}__title`,description:`${P}__description`,loader:`${P}__loader`,iconSuccess:`${P}__icon ${P}__icon--success`,iconError:`${P}__icon ${P}__icon--error`,fileList:`${P}__file-list`,file:`${P}__file`,fileIcon:`${P}__file-icon`,fileName:`${P}__file-name`},rs=()=>Promise.all([Y({icon:()=>$(()=>import("./calcite-icon-DW07N_Fi.js"),__vite__mapDeps([31,25,10,1,2,12,13,15])),loader:()=>$(()=>import("./calcite-loader-s-EjqyOZ.js"),__vite__mapDeps([32,17,10,1,2,13]))}),mt(),be()]);function os(e){const{messages:t,key:a,upload:i}=e;return h(nt,null,h(J,{key:a??"upload-details"},h(ue,null,ns(e))),i.state==="error"?h(Te,{buttons:[{onClick:()=>i.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function ns(e){const t=ls(e);return t?h("div",{class:D.base,"data-testid":"upload-details",key:"upload-details-content"},h("div",{class:D.status,key:"status"},t.iconContent,h("div",{class:D.titleWrapper,key:"text"},h("div",{class:D.title,key:"title"},t.title),h("div",{class:D.description,key:"description"},t.description))),cs(e.upload)):null}function ls({helpMessage:e,messages:t,upload:a}){switch(a.state){case"pending":{const{title:i,description:s}=t.modelUploads.pending;return{title:i,description:s,iconContent:h("calcite-loader",{"aria-hidden":"true",class:D.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*a.progress),a.progress===1?100:99)})}}case"success":{const{title:i}=t.modelUploads.success;return{title:i,description:e||t.helpMessages3d.mesh,iconContent:h("calcite-icon",{class:qe(D.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:i}=t.modelUploads.error;return{title:i,description:ds(a.error,t),iconContent:h("calcite-icon",{class:qe(D.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}function ds(e,t){if(!e)return null;const a=t.modelUploads.error.messages;switch(e.constructor){case ti:return a.noModel;case ei:return a.multipleModels;case Ya:return a.conversionFailed;default:return a.default}}function cs(e){return h("div",{class:D.fileList,key:"file-list"},e.files.map(t=>h("div",{class:D.file,key:`file-${t.name}`},h("calcite-icon",{class:D.fileIcon,icon:us(t),scale:"s"}),h("span",{class:D.fileName},ps(t.name)))))}function ps(e){var t;return((t=e.split("/").pop())==null?void 0:t.split("\\").pop())??""}function us(e){var a;const t=(a=e.name.split(".").pop())==null?void 0:a.toLowerCase();return(t?ms[t]:null)??hs}const hs="file",It="file-shape",Fe="file-image",ms={glb:It,gltf:It,jpeg:Fe,jpg:Fe,png:Fe,svg:Fe,zip:"file-zip"};let v=class extends Ua{constructor(e,t){super(e,t),this._featureForm=new $a,this._attachments=new Ea({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new Va({enableListScroll:!1,renderItemContentEnd:a=>a.supportsUpload?h("calcite-icon",{class:ee.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:a=>a.label,renderCustomGroupContent:a=>this._renderCustomTemplateGroupContent(a)}),this._filterText="",this._prompt=null,this._spinner=new Ta,this.headingLevel=4,this.iconClass=ee.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new Di,this.visibleElements=new Jt,this._renderSelectIcon=()=>h("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:a,key:i},...s)=>{var r;return h("calcite-flow-item",{closable:!1,heading:a,headingLevel:this.headingLevel,key:i,loading:this._loading,onCalciteFlowItemBack:this._onBack,onCalciteFlowItemScroll:(r=this._featureForm)==null?void 0:r.onScroll},h(es,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:this.visibleElements}),...s)},this._showDiscardEditsPrompt=()=>{var s;const{messages:a,activeWorkflow:i}=this;return(i==null?void 0:i.type)==="create-features"&&ve(i.data.creationInfo)?this._showPrompt(((s=i.data.upload)==null?void 0:s.state)==="success"?a.modelUploads.cancelPlacementPrompt:a.modelUploads.cancelUploadPrompt):this._showPrompt({title:a.cancelEditTitle,message:a.cancelEditWarningMessage,yesLabel:a.discardEdits,noLabel:a.continueEditing})},this._showGenericCancelPrompt=()=>{const{messages:a,messagesCommon:i}=this;return this._showPrompt({title:a.cancelRequestTitle,message:a.cancelRequestWarningMessage,yesLabel:i.form.yes,noLabel:i.form.no})},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:a,messagesCommon:i}=this;this._prompt={title:a.deleteWarningTitle,message:a.deleteWarningMessage,context:"danger",actions:{primary:{label:i.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:a.keepFeature,action:this._clearPrompt}}}},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=a=>(a==null||a.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var i;const{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"||a.type==="update"&&((i=a.activeWorkflow)==null?void 0:i.type)==="create-features"?(this._attachments.addFile(),a.back()):this._attachments.addAttachment().then(()=>a.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"?(this._attachments.updateFile(),a.back()):this._attachments.updateAttachment().then(()=>a.back()))},this._onAttachmentDelete=()=>{const{messages:a,messagesCommon:i}=this;this._prompt={title:a.deleteAttachmentWarningTitle,message:a.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:i.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:a.keepAttachment,action:this._clearPrompt}}}},this._onAttachmentDeleteConfirm=async()=>{const a=this._attachments,{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"?a.deleteFile():(await a.deleteAttachment(a.viewModel.activeAttachmentInfo),this._clearPrompt()),await i.back(),this._clearPrompt())},this._onAttachmentsError=a=>{this._prompt={title:this.messages.errorWarningTitle,message:a.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}}},this._clearPrompt=()=>{this._prompt=null}}initialize(){this.addHandles([_(()=>Ee(this.headingLevel),e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e},te),Q(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(t=>t?e.allow():e.deny())}),ye(()=>this.viewModel.featureFormViewModel,e=>{this._featureForm.viewModel=e},te),_(()=>this.viewModel,e=>{this._attachments.viewModel=(e==null?void 0:e.attachmentsViewModel)??null,this._featureTemplates.viewModel=(e==null?void 0:e.featureTemplatesViewModel)??null,this._spinner.viewModel=(e==null?void 0:e.spinnerViewModel)??null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt},te),_(()=>this.view,(e,t)=>{const a=`editor-${this.id}-spinner`;t==null||t.ui.remove(this._spinner,a),e==null||e.ui.add(this._spinner,{key:a,position:"manual"})},te),_(()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel],([e])=>{var t;e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),(t=this.viewModel.sketchViewModel)==null||t.set(e.sketch))},te),ye(()=>{var e;return(e=this._attachments)==null?void 0:e.error},e=>this._onAttachmentsError(e)),ye(()=>{var e;return(e=this.viewModel)==null?void 0:e.failures},e=>{const{messages:t}=this,[{error:a,retry:i,cancel:s}]=e;this._prompt={title:t.errorWarningTitle,message:Se(t.errorWarningMessageTemplate,{errorMessage:a.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{i(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{s(),this._clearPrompt()}}}}}),_(()=>{var e;return(e=this.viewModel)==null?void 0:e.state},e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),_(()=>this.viewModel.featureFormDisabled,e=>this._featureForm.disabled=e)])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([Y({"flow-item":()=>$(()=>import("./calcite-flow-item-D1TgTmys.js"),__vite__mapDeps([33,10,1,2,12,13,21,24,11,14,15,16,34,35,36,37,23,25,17,38,39,40,41,28,42,43,9])),flow:()=>$(()=>import("./calcite-flow-xQpOKDcb.js"),__vite__mapDeps([44,10,1,2,15,24])),icon:()=>$(()=>import("./calcite-icon-DW07N_Fi.js"),__vite__mapDeps([31,25,10,1,2,12,13,15])),list:()=>$(()=>import("./calcite-list-DXRoRXYC.js"),__vite__mapDeps([45,10,1,2,12,13,21,15,46,24,16,11,14,47,40,25,48,20,22,23,49,50,51,52,17,9]))}),Ri(),zi(),mt(),Xt(),be(),Yi(),ts(),ss(),rs()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _loading(){const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(e){Ne(G.getLogger(this),"allowedWorkflows",{replacement:"visibleElements",version:"4.29",warnOnce:!0}),this.viewModel.allowedWorkflows=e}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureEdit(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{viewModel:e}=this,t=this.classes(ee.base,vt.widget,vt.panel);return e?h("div",{class:t,key:"base"},h("calcite-flow",{key:"flow"},e.pageStack.map(a=>this._renderPage(a))),this._prompt?h(as,{...this._prompt,headingLevel:this.headingLevel}):void 0):h("div",{class:t,key:"empty"})}_renderPage(e){switch(e){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return h("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:e,messages:t}=this;return h(e,{heading:t.selectTemplate,key:"templates-panel"},h(J,{key:"feature-templates"},h(ue,null,this._featureTemplates.render())))}_renderUploadDetails(){const{EditorPanel:e,activeWorkflow:t,messages:a}=this;if((t==null?void 0:t.type)!=="create-features")return null;const i=t.data.upload;return i?h(e,{heading:a.createFeatures,key:"upload-details-panel"},h(os,{helpMessage:this._helpMessage,messages:a,upload:i})):null}_renderCreatingFeatures(){var d,c;const{EditorPanel:e,activeWorkflow:t,messages:a,messagesCommon:i,headingLevel:s,viewModel:r}=this;if(!t)return null;const n=t.type==="create-features"&&t.numPendingFeatures>0||t.type==="update"&&((d=t==null?void 0:t.activeWorkflow)==null?void 0:d.type)==="create-features"&&((c=t.activeWorkflow)==null?void 0:c.numPendingFeatures)>0;return h(e,{heading:a.createFeatures,key:"create-features-panel"},n?h(Ft,{editorViewModel:r,headingLevel:s,messages:a,messagesCommon:i,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}):h(Gi,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:e,messages:t,messagesCommon:a,headingLevel:i,viewModel:s}=this;return h(e,{heading:t.editFeature,key:"update-feature-panel"},h(Ft,{editorViewModel:s,headingLevel:i,messages:t,messagesCommon:a,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:a}=this,i=Fa(e.group.items,s=>a.itemHasInvalidFormTemplate(s)?t.formFieldCreateError:void 0);return i?h(at,{icon:ut,message:i}):null}_renderAttachmentAdding(){const{EditorPanel:e,_attachments:t,messages:a,messagesCommon:i}=this;return h(e,{heading:a.addAttachment,key:"attachment-adding-panel"},h(J,{key:"attachments"},t.render()),h(Te,{buttons:[{label:t.submitting?i.cancel:i.add,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:e,_attachments:t,activeWorkflow:a,messages:i,messagesCommon:s}=this;return a?h(e,{heading:i.editAttachment,key:"attachment-editing-panel"},h(J,{key:"attachments"},t.render()),a.shouldAllowAttachmentEditing?h(Te,{buttons:[{label:s.update,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:t.submitting,label:s.delete}]}):void 0):null}_renderReady(){const{EditorPanel:e,messages:t,viewModel:a,visibleElements:i}=this,s=this._helpMessage;return h(e,{heading:t.widgetLabel,key:"landing-panel"},h(J,{key:"landing-content"},a.editorItems.length?[i.editFeaturesSection?h(ue,{key:"edit-actions"},this._renderUpdateActions()):null,i.createFeaturesSection&&a.canCreateVisible?h(ue,{key:"create-actions"},this._renderCreateActions()):null]:h(ht,{key:"no-content"},t.noEditableLayers)),s?h("div",{class:ee.helpMessage,key:"footer-actions",slot:"footer"},s):void 0)}get _helpMessage(){var s;const{activeWorkflow:e,messages:t,view:a}=this,i=e==null?void 0:e.helpMessage;return i?(s=t[(a==null?void 0:a.type)==="3d"?"helpMessages3d":"helpMessages2d"])==null?void 0:s[i]:void 0}_renderUpdateActions(){var s;const{messages:e,messagesCommon:t,viewModel:a}=this,i={id:"select",label:t.select};return h("div",{class:ee.updateActions,key:"update-actions"},h(Oe,{level:Ee(this.headingLevel)},e.editFeatures),h("calcite-list",{class:ee.updateActionsList,selectionAppearance:"border",selectionMode:"single"},Oa({disabled:!a.canUpdateVisible,grouped:!1,item:i,selectedItem:((s=a.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-to-update"?i:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return h("div",{key:"create-actions"},h(Oe,{level:Ee(this.headingLevel)},this.messages.createFeatures),h("div",{class:ee.featureTemplatesContainer,key:"templates"},this._featureTemplates.render()))}_renderFeatureList(){const{EditorPanel:e,viewModel:t}=this,{activeWorkflow:a}=t;if((a==null?void 0:a.type)!=="update")return null;const i=a.data.candidates,s=Se(this.messages.multipleFeaturesTemplate,{total:i.length});return h(e,{heading:s,key:"feature-list"},h(Ni,{editorItems:t.editorItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:a,onFilterTextChange:r=>this._filterText=r,onSelectFeature:(r,n)=>t.selectFeature(r,n)}))}_showPrompt({title:e,message:t,yesLabel:a,noLabel:i}){const s=st(),{view:r}=this,n=r==null?void 0:r.focused;return this._prompt={title:e,message:t,context:"danger",actions:{primary:{label:a,action:()=>s.resolve(!0)},secondary:{label:i,action:()=>s.resolve(!1)}}},s.promise.finally(()=>{this._clearPrompt(),n&&(r==null||r.focus())})}};o([l()],v.prototype,"_featureForm",void 0),o([l()],v.prototype,"_attachments",void 0),o([l()],v.prototype,"_featureTemplates",void 0),o([l()],v.prototype,"_filterText",void 0),o([l()],v.prototype,"_prompt",void 0),o([l()],v.prototype,"_spinner",void 0),o([l()],v.prototype,"_deleteButtonCommonInfo",null),o([l()],v.prototype,"_loading",null),o([l({readOnly:!0})],v.prototype,"activeWorkflow",null),o([l()],v.prototype,"allowedWorkflows",null),o([l()],v.prototype,"headingLevel",void 0),o([l()],v.prototype,"hideTemplatesForInactiveLayers",null),o([l()],v.prototype,"iconClass",void 0),o([l()],v.prototype,"label",null),o([l()],v.prototype,"labelOptions",null),o([l()],v.prototype,"layerInfos",null),o([l(),De("esri/widgets/Editor/t9n/Editor")],v.prototype,"messages",void 0),o([l(),De("esri/t9n/common")],v.prototype,"messagesCommon",void 0),o([l(),De("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],v.prototype,"messagesTemplates",void 0),o([l()],v.prototype,"snappingOptions",null),o([l()],v.prototype,"tooltipOptions",null),o([l()],v.prototype,"supportingWidgetDefaults",void 0),o([l({type:Ia,nonNullable:!0})],v.prototype,"valueOptions",null),o([l()],v.prototype,"view",null),o([l(),ai(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],v.prototype,"viewModel",void 0),o([l({type:Jt,nonNullable:!0})],v.prototype,"visibleElements",void 0),o([l()],v.prototype,"_helpMessage",null),v=o([O("esri.widgets.Editor")],v);const jr=v;export{jr as default};
