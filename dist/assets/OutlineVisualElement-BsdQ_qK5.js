import{o as c,y as f,X as $,bO as E,jp as z,d1 as o,jq as G,j3 as g,jr as h,bE as j,cd as O,c4 as w,dg as T,di as M,dj as x,de as F,js as I,f5 as H,bW as P}from"./index-8ERthB3p.js";import{V as W}from"./ExtendedLineVisualElement-CQkDkcGr.js";import{h as l}from"./Material-DwPnlQDw.js";import{h as B,l as q,b as R,p as U}from"./lineStippleUtils-B9K4R8oO.js";import{r as v,t as L}from"./vec4f32-CjrfB-0a.js";import{t as N}from"./DoubleArray-068mylUp.js";import{e as V}from"./projectVectorToVector-C3SBBDgz.js";import{i as Y}from"./elevationInfoUtils-sHEwmo9N.js";import{t as X}from"./EngineVisualElement-DUG0X7vS.js";import{c as k}from"./LaserlineVisualElement-CzVKEaBL.js";import{H as b,m as J,o as K}from"./RenderGeometry-rcUvJmRA.js";import{e as Q}from"./VertexAttribute-BnAa5VW0.js";const p=.3;function u(i,e){e&&Object.assign(i,e)}class Z{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=l.Opaque,this.color=e.accent}}class y{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=l.Opaque,this.hoverOutlineColor=e.selectedOutline,u(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:h(e),renderOccluded:this.renderOccluded})}}class ee{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=l.Transparent,this.minSquaredEdgeLength=900,this.color=g(e.accent,.5),this.hoverColor=e.accent,u(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:h(e),renderOccluded:this.renderOccluded})}}class te{constructor(e){this.vertex=new y({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new y({colors:e,color:G(g(e.accent,2/3),.5),outlineColor:g(e.outline,.5),size:8,collisionPadding:8}),this.selected=new y({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new ee({colors:e})}}class C{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=B(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=l.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,u(this,t)}apply(e){e.color=h(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=h(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=h(this.innerColor),e.renderOccluded=this.renderOccluded}}class re{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,u(this,t)}apply(e){e.color=h(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=h(this.outlineColor),e.primitive=this.shape}}class m{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=p,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,u(this,t)}apply(e,t=1){const r={glowColor:o.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:o.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=r:e.laserlineStyle=r}}class se{constructor(e){this.outline=new C({colors:e,color:e.stippleOff,renderOccluded:l.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new C({colors:e,color:e.stippleOn,renderOccluded:l.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new m({colors:e,globalAlpha:p,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class ie{constructor(e){this.outline=new re({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new m({colors:e,globalAlpha:p,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class le extends C{constructor({colors:e,...t}){super({colors:e}),this.extensionType=W.GROUND_RAY,u(this,t)}}class oe{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineGraphics=new se(e),this.pointGraphics=new ie(e),this.heightPlane=new m({colors:e,globalAlpha:p,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new m({colors:e,globalAlpha:p,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new le({colors:e,color:g(e.accent,5*p/3),falloff:2,innerColor:g(e.selected,0),renderOccluded:l.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:W.GROUND_RAY})}}let a=class extends E{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:z(e),selected:o.fromArray([255,255,255,t]),selectedOutline:o.fromArray([255,255,255,t]),staged:o.fromArray([12,207,255,t]),stagedSolid:o.fromArray([12,207,255,1]),outline:o.fromArray([0,0,0,.5*t]),stippleOn:o.fromArray([255,255,255,1]),stippleOff:o.fromArray([0,0,0,.5])}}get visualElements(){return new oe(this.colors)}get manipulators(){return new te(this.colors)}get zManipulator(){return new Z(this.colors)}};c([f()],a.prototype,"colors",null),c([f()],a.prototype,"visualElements",null),c([f()],a.prototype,"manipulators",null),c([f()],a.prototype,"zManipulator",null),c([f()],a.prototype,"getTheme",void 0),a=c([$("esri.views.3d.interactive.editingTools.settings.Settings")],a);let Ce=class extends X{constructor(e){super(e),this._attachmentOrigin=V(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new j,this._geometry=null,this._width=1,this._color=v(1,0,1,1),this._innerWidth=0,this._innerColor=v(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=l.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new k({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,r)=>{t.geometries.length=0,this._recreateGeometry(r,t.material,t.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>{t.geometries=this._createRenderGeometriesDraped(t.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){O(e,this._color)||(w(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){O(e,this._innerColor)||(w(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&O(e,this._stippleOffColor)||(this._stippleOffColor=e?L(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var r;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(r=this.object3dResources.resources)==null?void 0:r.geometries;if(!e||e.length===0)return null;T(d,0,0,0);let t=0;for(const s of e)s.computeAttachmentOrigin(A)&&(M(d,d,A),t++);return t===0?null:(x(d,d,1/t),this.view.renderCoordsHelper.fromRenderCoords(d,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources!=null&&this.object3dResources.resources.material.setParameters(this._materialParameters),this.drapedResources.resources!=null&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===l.OccludeAndTransparentStencil?l.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const s of r)e.addGeometry(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[]}_createObject3DResources(e){const t=new b(this._materialParameters),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r,forEach:s=>{s(t),r.forEach(s)}}}_createDrapedResources(){const e=new b(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,s=r.basemapTerrain.spatialReference;return t==null||s==null?[]:q(t,s).lines.map(({position:n})=>{const _={overlayInfo:{spatialReference:s,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};return new J(R(e,_))})}calculateMapBounds(e){if(this.object3dResources.resources==null)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const s=r.attributes.get(Q.POSITION),n=N(s.data.length);F(s.data,t.spatialReference,0,n,this.view.spatialReference,0,s.data.length/3),I(e,n)}return!0}_createRenderGeometries(e,t){const r=this.geometry;if(r==null)return;const s=U(r,this.view.elevationProvider,this.view.renderCoordsHelper,K.fromElevationInfo(this.elevationInfo??new H({mode:Y(r,null)}))),n=new Array;for(const{position:_,mapPositions:S}of s.lines){const D={mapPositions:S,attributeData:{position:_},removeDuplicateStartEnd:this._isClosed};t.push(R(e,D)),n.push(_)}this._laserline.pathVerticalPlane=n}};const A=P(),d=P();export{Ce as w,a as z};
