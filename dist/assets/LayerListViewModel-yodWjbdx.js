import{ak as H,bE as f,cr as h,gl as c,o,y as n,X as M}from"./index-8ERthB3p.js";import{k as I}from"./ListItem-CrkhWk_H.js";import{v as _,a as V}from"./layerListUtils-DD1BqbFJ.js";const a={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},E="hide",b=H.ofType(I);let r=class extends f.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new b,this.view=null}initialize(){this.addHandles([h(()=>{var e;return((e=this.view)==null?void 0:e.ready)===!0},()=>this._viewHandles(),c),h(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],a.view)}destroy(){this.view=null,this.operationalItems.removeAll()}get state(){const{view:e}=this;return e!=null&&e.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,s,i){var L,u;const l=e==null?void 0:e.layer;if(!l||l.type==="subtype-sublayer")return;const d=(u=(L=this.view)==null?void 0:L.map)==null?void 0:u.layers,y=t?_(t):d,m=s?_(s):d;if(!y||!m)return;const{operationalItems:p}=this,g=(t==null?void 0:t.children)||p,v=(s==null?void 0:s.children)||p,w=m.length-i;e.parent=s||null,g.remove(e),y.remove(l),v.includes(e)||v.add(e,w),m.includes(l)||m.add(l,w),this._compileList()}_createLayerViewHandles(e){this.removeHandles(a.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),a.layerViews)}_createMapLayerHandles(e){this.removeHandles(a.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),a.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:s,checkPublishStatusEnabled:i}=this;return new I({checkPublishStatusEnabled:i,layer:e,listItemCreatedFunction:s,view:t})}_removeAllItems(){this.operationalItems.removeAll()}_getViewableLayers(e){if(e)return e.filter(t=>V(t)!==E)}_watchLayersListMode(e){this.removeHandles(a.layerListMode),e&&e.forEach(t=>{"listMode"in t&&this.addHandles(h(()=>t.listMode,()=>this._compileList()),a.layerListMode)})}_compileList(){var s,i;const e=(i=(s=this.view)==null?void 0:s.map)==null?void 0:i.layers;this._watchLayersListMode(e);const t=this._getViewableLayers(e);t!=null&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(s=>{t.some(i=>i.layer===s)||t.add(this._createListItem(s))})}_removeItems(e){const{operationalItems:t}=this,s=[];t.forEach(i=>{i&&e&&e.includes(i.layer)||s.push(i)}),t.removeMany(s)}_sortItems(e){const{operationalItems:t}=this;t.sort((s,i)=>{const l=e.indexOf(s.layer),d=e.indexOf(i.layer);return l>d?-1:l<d?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([a.mapLayers,a.layerViews,a.viewLayers]),e!=null&&e.ready?this.addHandles([h(()=>{var t,s;return(s=(t=this.view)==null?void 0:t.map)==null?void 0:s.allLayers},t=>this._createMapLayerHandles(t),c),h(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},t=>this._createLayerViewHandles(t),c)],a.viewLayers):this._removeAllItems()}};o([n()],r.prototype,"checkPublishStatusEnabled",void 0),o([n()],r.prototype,"listItemCreatedFunction",void 0),o([n({type:b})],r.prototype,"operationalItems",void 0),o([n({readOnly:!0})],r.prototype,"state",null),o([n()],r.prototype,"totalItems",null),o([n()],r.prototype,"view",void 0),r=o([M("esri.widgets.LayerList.LayerListViewModel")],r);const C=r;export{C as y};
