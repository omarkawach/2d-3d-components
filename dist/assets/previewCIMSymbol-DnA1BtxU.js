import{fX as w,h9 as j,br as v,ha as G}from"./index-8ERthB3p.js";import{K as g}from"./CIMSymbolHelper-C-U_lWVp.js";import{CIMSymbolRasterizer as O}from"./CIMSymbolRasterizer-DfFXCkHE.js";import{t as b,l as R}from"./symbolUtils-DGJEMzVR.js";import"./BidiEngine-DL33fnW5.js";import"./fontUtils-Dz0hN_7q.js";import"./OptimizedGeometry-DLPswkPy.js";import"./GeometryUtils-_MjrRDxY.js";import"./enums-BRqP_wXA.js";import"./definitions-B54owTRu.js";import"./mat2d-D9yIh3Tx.js";import"./mat2df32-orApM5a3.js";import"./vec2-Dt9Foiri.js";import"./vec2f32-BbH2jxlN.js";import"./Rect-CUzevAry.js";import"./BoundingBox-BhuXqU4L.js";import"./CIMResourceManager-W60JuM0E.js";import"./imageUtils-D1MsbWS6.js";import"./utils-j-RBNfeR.js";import"./cimSymbolUtils-DwzauUMk.js";import"./jsxFactory-BxQYPm-b.js";import"./webStyleSymbolUtils-BzDS5WjL.js";import"./devEnvironmentUtils-Blrp8lZ5.js";const u=new O(null),c=w(b.size),S=w(b.maxSize),C=w(b.lineWidth),V=1;async function $(l,e,a){const i=e==null?void 0:e.size;let t=i!=null&&typeof i=="object"&&"width"in i?i.width:i,o=i!=null&&typeof i=="object"&&"height"in i?i.height:i;if(t==null||o==null)if(a==="esriGeometryPolygon")t=c,o=c;else{const r=await q(l,e,a);r&&(t=r.width,o=r.height),a==="esriGeometryPolyline"&&(t=C),t=t!=null&&isFinite(t)?Math.min(t,S):c,o=o!=null&&isFinite(o)?Math.max(Math.min(o,S),V):c}return e.style==="legend"&&a==="esriGeometryPolyline"&&(t=C),{width:t,height:o}}async function q(l,e,a){const{feature:i,fieldMap:t,viewParams:o}=e.cimOptions||e,r=await G.resolveSymbolOverrides(l.data,i,null,t,a,null,o);if(!r)return null;(l=l.clone()).data={type:"CIMSymbolReference",symbol:r},l.data.primitiveOverrides=void 0;const n=[];return g.fetchResources(r,u.resourceManager,n),g.fetchFonts(r,u.resourceManager,n),n.length>0&&await Promise.all(n),g.getEnvelope(r,null,u.resourceManager)}async function ae(l,e={}){var M;const{node:a,opacity:i,symbolConfig:t}=e,o=t!=null&&typeof t=="object"&&"isSquareFill"in t&&t.isSquareFill,r=e.cimOptions||e,n=r.geometryType||j((M=l==null?void 0:l.data)==null?void 0:M.symbol),f=await $(l,e,n),{feature:P,fieldMap:I}=r,L=o||n!=="esriGeometryPolygon"?"preview":"legend",h=await u.rasterizeCIMSymbolAsync(l,P,f,L,I,n,null,r.viewParams,r.allowScalingUp);if(!h)return null;const{width:x,height:z}=h,m=document.createElement("canvas");m.width=x,m.height=z,m.getContext("2d").putImageData(h,0,0);const y=v(f.width),d=v(f.height),s=new Image(y,d);s.src=m.toDataURL(),s.ariaLabel=e.ariaLabel??null,s.alt=e.ariaLabel??"",i!=null&&(s.style.opacity=`${i}`);let p=s;if(e.effectView!=null){const F={shape:{type:"image",x:0,y:0,width:y,height:d,src:s.src},fill:null,stroke:null,offset:[0,0]};p=R([[F]],[y,d],{effectView:e.effectView,ariaLabel:e.ariaLabel})}return a&&p&&a.appendChild(p),p}export{ae as previewCIMSymbol};
