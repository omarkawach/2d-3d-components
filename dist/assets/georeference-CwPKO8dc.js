import{o as h,y as P,X as Ae,bg as $e,bW as I,ku as de,ci as Pe,dA as w,kv as xe,fp as re,fc as X,kw as Fe,$ as Te,P as V,de as O,bV as Y,kx as ve,bX as Me,ky as be,kz as we,kA as Re,g7 as Ce,a5 as _e,dS as Oe,g5 as H,kB as Se,fo as Ee,dt as je,fv as ze}from"./index-8ERthB3p.js";import{e as te}from"./mat3f64-BBpwCtoL.js";import{e as v,o as _}from"./mat4f64-Dk4dwAN8.js";import{n as J,u as K,j as E,z as ne}from"./mat3-CqxUQBLP.js";import{a as b}from"./spatialReferenceEllipsoidUtils-CmEPjh7T.js";import{R as S}from"./computeTranslationToOriginAndRotation-BbJd4iYX.js";import{t as Q,o as Ne}from"./DoubleArray-068mylUp.js";import{I as ke}from"./quat-DUnoL8dP.js";import{e as Ge}from"./quatf64-BrpT0VRp.js";import{C as Le,q as Ve,y as Z,z as We,A as Be}from"./axisAngleDegrees-CaSFQR2z.js";import{g as j,f as Ie,u as oe}from"./meshVertexSpaceUtils-KRc33Yrq.js";import{n as F,s as ae,i as qe,r as M}from"./vec3-DPXcG_yS.js";import{i as A,T as $}from"./BufferView-CHYzaV9A.js";var W;let y=W=class extends $e{constructor(e){super(e),this.translation=I(),this.rotationAxis=de(Le),this.rotationAngle=0,this.scale=Pe(1,1,1)}get rotation(){return Ve(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=w(Z(e)),this.rotationAngle=We(e)}get localMatrix(){const e=v();return ke(D,Z(this.rotation),Be(this.rotation)),xe(e,D,this.translation,this.scale),e}get localMatrixInverse(){return re(v(),this.localMatrix)}applyLocal(e,r){return X(r,e,this.localMatrix)}applyLocalInverse(e,r){return X(r,e,this.localMatrixInverse)}equals(e){return this===e||e!=null&&Fe(this.localMatrix,e.localMatrix)}clone(){const e={translation:w(this.translation),rotationAxis:w(this.rotationAxis),rotationAngle:this.rotationAngle,scale:w(this.scale)};return new W(e)}};h([P({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"translation",void 0),h([P({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"rotationAxis",void 0),h([P({type:Number,nonNullable:!0,json:{write:!0}})],y.prototype,"rotationAngle",void 0),h([P({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"scale",void 0),h([P()],y.prototype,"rotation",null),h([P()],y.prototype,"localMatrix",null),h([P()],y.prototype,"localMatrixInverse",null),y=W=h([Ae("esri.geometry.support.MeshTransform")],y);const D=Ge(),ee=y;function ie(e,r){return e.isGeographic||e.isWebMercator&&(r??!0)}function se(e,r){switch(e.type){case"georeferenced":return r.isGeographic;case"local":return r.isGeographic||r.isWebMercator}}function vr(e,r,t,n){if(n!==void 0){Te(V.getLogger(e),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const o=r.type==="local";if(!j(r)||n===o)return t.isGeographic||t.isWebMercator&&n;V.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${n}) for a Mesh vertex space of type "${r.type}" is not supported. This parameter will be ignored.`)}return se(r,t)}const z=()=>V.getLogger("esri.geometry.support.meshUtils.normalProjection");function Ue(e,r,t,n,o){return k(n)?(N(m.TO_PCPF,A.fromTypedArray(e),$.fromTypedArray(r),$.fromTypedArray(t),n,A.fromTypedArray(o)),o):(z().error("Cannot convert spatial reference to PCPF"),o)}function Xe(e,r,t,n,o){return k(n)?(N(m.FROM_PCPF,A.fromTypedArray(e),$.fromTypedArray(r),$.fromTypedArray(t),n,A.fromTypedArray(o)),o):(z().error("Cannot convert to spatial reference from PCPF"),o)}function Ye(e,r,t){return O(e,r,0,t,b(r),0,e.length/3),t}function He(e,r,t){return O(e,b(t),0,r,t,0,e.length/3),r}function Je(e,r,t){return E(u,t),F(r,e,u),ne(u)||ae(r,r),r}function Ke(e,r,t){if(E(u,t),F(r,e,u,4),ne(u)||ae(r,r,4),e!==r)for(let n=3;n<e.length;n+=4)r[n]=e[n];return r}function Qe(e,r,t,n,o){if(!k(n))return z().error("Cannot convert spatial reference to PCPF"),o;N(m.TO_PCPF,A.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),$.fromTypedArray(r),$.fromTypedArray(t),n,A.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<e.length;a+=4)o[a]=e[a];return o}function Ze(e,r,t,n,o){if(!k(n))return z().error("Cannot convert to spatial reference from PCPF"),o;N(m.FROM_PCPF,A.fromTypedArray(e,16),$.fromTypedArray(r),$.fromTypedArray(t),n,A.fromTypedArray(o,16));for(let a=3;a<e.length;a+=4)o[a]=e[a];return o}function N(e,r,t,n,o,a){if(!r)return;const l=t.count,c=b(o);if(le(o))for(let i=0;i<l;i++)n.getVec(i,R),r.getVec(i,g),S(c,R,C,c),J(u,C),e===m.FROM_PCPF&&K(u,u),Y(g,g,u),a.setVec(i,g);else for(let i=0;i<l;i++){n.getVec(i,R),r.getVec(i,g),S(c,R,C,c),J(u,C);const s=ve(t.get(i,1));let f=Math.cos(s);e===m.TO_PCPF&&(f=1/f),u[0]*=f,u[1]*=f,u[2]*=f,u[3]*=f,u[4]*=f,u[5]*=f,e===m.FROM_PCPF&&K(u,u),Y(g,g,u),Me(g,g),a.setVec(i,g)}return a}function k(e){return le(e)||De(e)}function le(e){return e.isWGS84||be(e)||we(e)||Re(e)}function De(e){return e.isWebMercator}var m;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(m||(m={}));const R=I(),g=I(),C=v(),u=te();function q(e,r,t){return ie(r.spatialReference,t==null?void 0:t.geographic)?U(e,r,!1,t):nr(e,r,t)}function ce(e,r=_){const{position:t,normal:n,tangent:o}=e;return{position:M(new Float64Array(t.length),t,r),normal:n!=null?Je(n,new Float32Array(n.length),r):null,tangent:o!=null?Ke(o,new Float32Array(o.length),r):null}}function ue(e,r,t,n){const{position:o,normal:a,tangent:l}=e;if(!j(r))return{position:o,normal:a,tangent:l};const c=oe(r,n);return q(ce(e,t==null?void 0:t.localMatrix),c,{geographic:r.type==="local"})}function er(e,r,t){const n=Ie(r,t),o=r.spatialReference,a=j(n);if(!a)return{vertexAttributes:q(e,r,t),vertexSpace:n,transform:null};const{position:l,normal:c,tangent:i}=e,s=se(n,o);switch(n.type){case"georeferenced":return s?{vertexAttributes:U(e,r,a,t),vertexSpace:n,transform:null}:{vertexAttributes:{position:l,normal:c,tangent:i},vertexSpace:n,transform:new ee};case"local":return{vertexAttributes:{position:l,normal:c,tangent:i},vertexSpace:n,transform:new ee}}}function B(e,r,t){return ie(r.spatialReference,t==null?void 0:t.geographic)?pe(e,r,t):fe(e,r,t)}function rr(e,r,t,n,o){if(!j(r))return B(e,n,o);const{spatialReference:a}=n,l=ue(e,r,t,a);return n.equals(oe(r,a))?fe(l,n,o):B(l,n,o)}function tr({positions:e,transform:r,vertexSpace:t,inSpatialReference:n,outSpatialReference:o,outPositions:a,localMode:l}){const c=t.origin??H,i=t.origin!=null?(r==null?void 0:r.localMatrix)??_:_;if(t.type==="georeferenced"){const p=a??Q(e.length);if(Se(i,_)?Ne(p,e):M(p,e,i),!Ee(c,H)){const[L,me,he]=c;for(let T=0;T<p.length;T+=3)p[T]+=L,p[T+1]+=me,p[T+2]+=he}return O(p,n,0,p,o,0,p.length/3),p}let s=n;const f=b(n);s=o.isWebMercator&&l||!je(n,f)?s:f,S(n,c,x,s),ze(x,x,i);const d=a??Q(e.length);return M(d,e,x),O(d,s,0,d,o,0,d.length/3),d}function nr(e,r,t){const n=new Float64Array(e.position.length),o=e.position,a=r.x,l=r.y,c=r.z??0,i=G(t?t.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)n[s]=o[s]*i+a,n[s+1]=o[s+1]*i+l,n[s+2]=o[s+2]*i+c;return{position:n,normal:e.normal,tangent:e.tangent}}function U(e,r,t,n){const o=r.spatialReference,a=ge(r,n,x),l=new Float64Array(e.position.length),c=or(e.position,a,o,l),i=E(ye,a),s=ar(c,l,e.normal,i,o),f=ir(c,l,e.tangent,i,o);if(t){const{x:d,y:p,z:L}=r;qe(c,c,[-d,-p,-(L??0)])}return{position:c,normal:s,tangent:f}}function or(e,r,t,n){M(n,e,r);const o=new Float64Array(e.length);return He(n,o,t)}function ar(e,r,t,n,o){if(t==null)return null;const a=new Float32Array(t.length);return F(a,t,n),Xe(a,e,r,o,a),a}function ir(e,r,t,n,o){if(t==null)return null;const a=new Float32Array(t.length);F(a,t,n,4);for(let l=3;l<a.length;l+=4)a[l]=t[l];return Ze(a,e,r,o,a),a}function fe(e,r,t){const n=new Float64Array(e.position.length),o=e.position,a=r.x,l=r.y,c=r.z??0,i=G(t?t.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)n[s]=(o[s]-a)/i,n[s+1]=(o[s+1]-l)/i,n[s+2]=(o[s+2]-c)/i;return{position:n,normal:e.normal,tangent:e.tangent}}function pe(e,r,t){const n=r.spatialReference;ge(r,t,x);const o=re(ur,x),a=new Float64Array(e.position.length),l=sr(e.position,n,o,a),c=E(ye,o);return{position:l,normal:lr(e.normal,e.position,a,n,c),tangent:cr(e.tangent,e.position,a,n,c)}}function ge(e,r,t){S(e.spatialReference,[e.x,e.y,e.z??0],t,b(e.spatialReference));const n=G(r?r.unit:null,e.spatialReference);return Ce(t,t,[n,n,n]),t}function sr(e,r,t,n){const o=Ye(e,r,n),a=new Float64Array(o.length);return M(a,o,t),a}function lr(e,r,t,n,o){if(e==null)return null;const a=Ue(e,r,t,n,new Float32Array(e.length));return F(a,a,o),a}function cr(e,r,t,n,o){if(e==null)return null;const a=Qe(e,r,t,n,new Float32Array(e.length));return F(a,a,o,4),a}function G(e,r){if(e==null)return 1;const t=_e(r);return 1/Oe(t,"meters",e)}const x=v(),ur=v(),ye=te(),Mr=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:ce,georeference:q,georeferenceApplyTransform:ue,georeferenceByTransform:er,georeferenceGlobal:U,getUnitScale:G,project:tr,ungeoreference:B,ungeoreferenceByTransform:rr,ungeoreferenceGlobal:pe},Symbol.toStringTag,{value:"Module"}));export{rr as C,He as E,tr as G,U as I,Je as M,Ye as O,ue as P,pe as Q,Ke as R,er as V,G as _,Xe as a,Ze as b,vr as c,ee as d,ce as e,Mr as g,Qe as h,Ue as j};
