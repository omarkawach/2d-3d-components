import{i as x}from"./earcut-BqgeR2O3.js";import{cp as P,fs as f,ds as F,hm as W,dg as X,M as Z,bi as v,gw as C}from"./index-8ERthB3p.js";import{a as H,e as Y,t as N}from"./DoubleArray-068mylUp.js";import{A as j,t as R}from"./Indices-DP3oX5Sg.js";import{e as M}from"./deduplicate-j8p9VETP.js";import{E as B,F as G,X as V}from"./plane-Du3EYICn.js";import{t as b}from"./Attribute-B-NAci_J.js";import{e as _}from"./ContentObject-BTgEhnct.js";import{I as T}from"./Geometry-CqGtfd4N.js";import{e as A}from"./VertexAttribute-BnAa5VW0.js";function k(t,n,r,o){const e=(a=>!Array.isArray(a[0]))(n)?(a,i)=>n[3*a+i]:(a,i)=>n[a][i],s=o?F(o)/W(o):1;return V(t,(a,i)=>X(a,e(i,0)*s,e(i,1)*s,e(i,2)),r)}function U(t,n,r){const o=k(S,t,n,r)?G(S):[0,0,1];return Math.abs(o[2])>Math.cos(P(80))?f.Z:Math.abs(o[1])>Math.abs(o[0])?f.Y:f.X}const S=B();function at(t,n,r){const o=U(t,(n.length>0?n[0]:t.length/3)-1,r);if(o!==f.Z){t=t.slice();for(let e=0;e<t.length;e+=3)t[e+o]=t[e+2]}return x(t,n,3)}function ct(t){const n=[[A.POSITION,new b(t.attributeData.position,t.indices,3,!0)]],r=j(t.indices.length);return t.attributeData.colorFeature!=null?n.push([A.COLORFEATUREATTRIBUTE,new b([t.attributeData.colorFeature],r,1,!0)]):t.attributeData.color&&n.push([A.COLOR,new b(t.attributeData.color,r,4,!0)]),t.attributeData.uvMapSpace&&n.push([A.UVMAPSPACE,new b(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&n.push([A.BOUNDINGRECT,new b(t.attributeData.boundingRect,t.indices,9,!0)]),new T(t.material,n,t.mapPositions,_.Mesh,t.attributeData.objectAndLayerIdColor)}function lt(t,n=null){const r=[[A.POSITION,new b(t.attributeData.position,t.indices,3,!0)],[A.UV0,new b(t.attributeData.uv0,t.indices,2,!0)]];return new T(t.material,r,t.mapPositions,_.Mesh,n)}function ut(t){switch(t.type){case"extent":if(t instanceof Z)return v.fromExtent(t);break;case"polygon":return t}return null}class ft{constructor(n,r,o){this.renderData=n,this.layerUid=r,this.graphicUid=o,this.outGeometries=new Array}}function ht(t){const n=z(t.rings,t.hasZ,D.CCW_IS_HOLE,t.spatialReference),r=new Array;let o=0,e=0;for(const i of n.polygons){const c=i.count,h=i.index,d=H(n.position,3*h,3*c),I=i.holeIndices.map(u=>u-h),m=R(x(d,I,3));r.push({position:d,faces:m}),o+=d.length,e+=m.length}const s=q(r,o,e),a=Array.isArray(s.position)?M(s.position,3,{originalIndices:s.faces}):M(s.position.buffer,6,{originalIndices:s.faces});return s.position=Y(new Float64Array(a.buffer)),s.faces=a.indices,s}function q(t,n,r){if(t.length===1)return t[0];const o=N(n),e=new Array(r);let s=0,a=0,i=0;for(const c of t){for(let h=0;h<c.position.length;h++)o[s++]=c.position[h];for(const h of c.faces)e[a++]=h+i;i=s/3}return{position:o,faces:R(e)}}function z(t,n,r,o){const e=t.length,s=new Array(e),a=new Array(e),i=new Array(e);let c=0,h=0,d=0,I=0;for(let p=0;p<e;++p)I+=t[p].length;const m=N(3*I);let u=0;for(let p=e-1;p>=0;p--){const l=t[p],E=r===D.CCW_IS_HOLE&&J(l,n,o);if(E&&e!==1)s[c++]=l;else{let L=l.length;for(let g=0;g<c;++g)L+=s[g].length;const w={index:u,pathLengths:new Array(c+1),count:L,holeIndices:new Array(c)};w.pathLengths[0]=l.length,l.length>0&&(i[d++]={index:u,count:l.length}),u=E?O(l,l.length-1,-1,m,u,l.length,n):O(l,0,1,m,u,l.length,n);for(let g=0;g<c;++g){const y=s[g];w.holeIndices[g]=u,w.pathLengths[g+1]=y.length,y.length>0&&(i[d++]={index:u,count:y.length}),u=O(y,0,1,m,u,y.length,n)}c=0,w.count>0&&(a[h++]=w)}}for(let p=0;p<c;++p){const l=s[p];l.length>0&&(i[d++]={index:u,count:l.length}),u=O(l,0,1,m,u,l.length,n)}return a.length=h,i.length=d,{position:m,polygons:a,outlines:i}}function O(t,n,r,o,e,s,a){e*=3;for(let i=0;i<s;++i){const c=t[n];o[e++]=c[0],o[e++]=c[1],o[e++]=a?c[2]:0,n+=r}return e/3}function J(t,n,r){if(n){const o=t.length-1,e=U(t,o,r);if(e===f.X)return!C(t,f.Y,f.Z);if(e===f.Y)return!C(t,f.X,f.Z)}return!C(t,f.X,f.Y)}var D;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(D||(D={}));export{ut as A,lt as D,ft as O,ct as d,ht as f,z as g,D as u,at as w};
