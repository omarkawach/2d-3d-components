import{fY as y,cX as _,cB as E,a0 as $,cr as n,h4 as D,fZ as R,o as c,y as f,X as H,bO as L,ej as l,jo as P,d1 as b,an as T,ju as k,gJ as u}from"./index-8ERthB3p.js";import{r as z,t as v}from"./ElevationProfile-Ds6SYnTP.js";import{a as O}from"./HoveredPoints-0-jXO6Mx.js";import{a as S}from"./elevationInfoUtils-sHEwmo9N.js";import{z as V,w}from"./OutlineVisualElement-BsdQ_qK5.js";import{e as G}from"./GraphicState-BLKIyD3S.js";import{h as I}from"./Material-DwPnlQDw.js";import{n as M}from"./layerViewUtils-Bi2wmOiN.js";import{e as j}from"./throttle-jjSnxk80.js";import"./memoize-DsJmrG76.js";import"./jsxFactory-BxQYPm-b.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./ElevationQueryTileCache-CV2Fph_A.js";import"./projectVectorToVector-C3SBBDgz.js";import"./projectPointToVector-qKp-AJ2b.js";import"./LayerConstants-B33OP6sh.js";import"./ElevationProvider-Bd4qfXCi.js";import"./mat4f64-Dk4dwAN8.js";import"./sphere-Bf4ezJdT.js";import"./ObjectStack-BPo9QGhV.js";import"./plane-Du3EYICn.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-BrpT0VRp.js";import"./vec2f64-Diu2Kaa8.js";import"./mathUtils-iSLnUy_4.js";import"./ViewingMode-Dodu7ZZk.js";import"./boundedPlane-CLJ-Xnn_.js";import"./lineSegment-DVvvMBnG.js";import"./verticalOffsetUtils-BYv4Nk2v.js";import"./mat3-CqxUQBLP.js";import"./orientedBoundingBox-BQvYwCTM.js";import"./quat-DUnoL8dP.js";import"./spatialReferenceEllipsoidUtils-CmEPjh7T.js";import"./computeTranslationToOriginAndRotation-BbJd4iYX.js";import"./Attribute-B-NAci_J.js";import"./Intersector-8rpRuT_8.js";import"./Intersector-CTjLkyei.js";import"./defaultUnit-gjMTMp_C.js";import"./getDefaultUnitForView-BEilgbp7.js";import"./vec2-Dt9Foiri.js";import"./geodesicUtils-D1kRRrco.js";import"./QueueProcessor-DFkcFyJt.js";import"./ReactiveMap-C-O0lKvJ.js";import"./signal-DoM1gSF0.js";import"./Scheduler-DaHJO6l7.js";import"./debugFlags-BbJIqrPU.js";import"./RenderState-DaVlEYWY.js";import"./traversalUtils-DmE6QkgJ.js";import"./ElevationQuery-CP-aI38G.js";import"./ElevationSamplerData-CC_B5wrl.js";import"./TileKey-DZd6gJy7.js";import"./GraphicsLayer-CapLCpoe.js";import"./GraphicsCollection-CKieR40M.js";import"./screenUtils-BuM_Fswi.js";import"./SketchViewModel-DKgcTZ3K.js";import"./layerUtils-BS1Di3Pm.js";import"./angularMeasurementUtils-CATp35qy.js";import"./geometry2dUtils-DoOkpuKA.js";import"./Cyclical-BY9qISY1.js";import"./quantityUtils-9zDVxeky.js";import"./SketchLabelOptions-BnZB654u.js";import"./SnappingManager-DUlqpdAB.js";import"./UpdatingHandles-ugzlsvZF.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./viewUtils-DC86MEAQ.js";import"./geometryEngine-MBwx6Ib1.js";import"./geometryEngineBase-Cz__5BKm.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-7yclY7Co.js";import"./projectVectorToWGS84ComparableLonLat-DuPw0-Mv.js";import"./geodesicMeasurementUtils-BcTpN3Xi.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./unitFormatUtils-3MMEFLJJ.js";import"./substitute-DkE5N3Tl.js";import"./UnitSelect-vwLT4dGV.js";import"./globalCss-DfZw-NIf.js";import"./AnchorElementViewModel-Bb21xlFI.js";import"./ExtendedLineVisualElement-CQkDkcGr.js";import"./vec4f32-CjrfB-0a.js";import"./frustum-BrAPXuhm.js";import"./EngineVisualElement-DUG0X7vS.js";import"./RenderGeometry-rcUvJmRA.js";import"./vec3f32-Cw9Q6TO_.js";import"./DoubleArray-068mylUp.js";import"./Texture-C7A05GrI.js";import"./interfaces-B8ge7Jg9.js";import"./BindType-BmZEZMMh.js";import"./Util-B8vYs4k8.js";import"./enums-DSseSvdG.js";import"./Texture-O7Pyotwx.js";import"./VertexAttribute-BnAa5VW0.js";import"./basicInterfaces-DngWxyLO.js";import"./ShaderTechniqueConfiguration-D3UbJ2mX.js";import"./doublePrecisionUtils-B0owpBza.js";import"./requestImageUtils-DP1V3HlH.js";import"./ContentObject-BTgEhnct.js";import"./Indices-DP3oX5Sg.js";import"./Geometry-CqGtfd4N.js";import"./triangle-CTblFuF6.js";import"./hydratedFeatures-DqrDm0_F.js";import"./axisAngleDegrees-CaSFQR2z.js";import"./weather-D00pIeau.js";import"./NestedMap-DgiGbX8E.js";import"./Octree-E7a40xr7.js";import"./InterleavedLayout-s3MgOYN8.js";import"./BufferView-CHYzaV9A.js";import"./types-D0PSWh4d.js";import"./OrderIndependentTransparency-Cua2R8AE.js";import"./floatRGBA-CCqnXShd.js";import"./glUtil-DS73TAjp.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./VertexArrayObject-Cv4RwmVi.js";import"./BufferObject-CaEbWulZ.js";import"./VisualElement-CI1nOGdz.js";import"./LaserlineVisualElement-CzVKEaBL.js";import"./lineStippleUtils-B9K4R8oO.js";import"./triangulationUtils-C0V38kt7.js";import"./earcut-BqgeR2O3.js";import"./deduplicate-j8p9VETP.js";let x=class{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new V({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!g(t))return;const e=t.layer;this._highlightTask=E(async i=>{const s=await this._params.view.whenLayerView(e);$(i),M(s)&&(this._highlightHandle=s.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const e=this._params.view,i=new w({view:e,geometry:g(t)?t.geometry:null,attached:!1,elevationInfo:S(t),renderOccluded:I.OccludeAndTransparentStencil,isDecoration:!0}),s=new G({graphic:t}),o=[n(()=>s.isDraped,m=>{i.isDraped=m}),s.on("changed",()=>{i.geometry=g(t)?t.geometry:null}),e.trackGraphicState(s),e.maskOccludee(t),D(i)];this._settings.visualElements.lineGraphics.outline.apply(i),i.attached=!0,this._visualElementHandle=R(o)}};function g(r){return r.geometry!=null&&r.geometry.type==="polyline"}const A=100;let h=class extends L{constructor(r){super(r),this._chartData=null,this._visualElements=[]}initialize(){const r=j(t=>{this._update(t)},A);this.addHandles([n(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),r,l),r])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_update(r){const{chartData:t}=r;if(t==null)return this.remove();if(!t.refined)return;const e=this._visualElements,i=t.lines.filter(p=>p.viewVisualizationEnabled),s=i.length;for(;e.length>s;)e.pop().destroy();const o=z().profileLinesStyle3D;for(;e.length<s;){const p=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:o.width-o.outlineSize,width:o.width,falloff:o.falloff,color:o.outlineColor,renderOccluded:o.renderOccluded,isDecoration:!0});e.push(p)}const m=r.spatialReference;for(let p=0;p<s;++p){const d=e[p],a=i[s-1-p];d.geometry=this._createLineGeometry(a,m),d.innerColor=P(b.toUnitRGBA(a.color))}}_createLineGeometry(r,t){const e=r.samples??[],i=e.length-1,s=[];let o=[];for(let m=0;m<=i;m++){const{x:p,y:d,z:a}=e[m];a!=null&&o.push([p,d,a]),m!==i&&a!=null||!o.length||(s.push(o),o=[])}return new T({paths:s,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach(r=>r.destroy()),this._visualElements.length=0}};c([f()],h.prototype,"view",void 0),c([f()],h.prototype,"_chartData",void 0),h=c([H("esri.widgets.ElevationProfile.support.ProfileLines3D")],h);class Qi{constructor(t,e){this._handles=new k,this._inputRepresentation=new x({view:t}),this._hoveredPoints=new O({view:t}),this._profileLines=new h({view:t}),this._handles.add([n(()=>e.viewModel.hoveredPoints,i=>this._hoveredPoints.update(i),l),n(()=>{const{state:i,editable:s,highlightEnabled:o,viewModel:m}=e,p=m.input;return p&&(p.commitProperty("geometry"),p.commitProperty("layer")),{input:p,state:i,editable:s,highlightEnabled:o}},i=>this._updateInputRepresentation(i),l),n(()=>e.viewModel.chartData,i=>this._profileLines.update(i),l),n(()=>{var i;return(i=e.viewModel.input)==null?void 0:i.geometry},()=>{this._profileLines.remove()},l)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:t,state:e,editable:i,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();e===v.Selected?o.showHighlight(t):e!==v.Created||i?o.remove():o.showReshaping(t)}}export{Qi as ElevationProfileView3D};
