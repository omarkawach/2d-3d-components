import{d7 as R,d8 as A,d9 as b,P as d}from"./index-8ERthB3p.js";import{u as h}from"./Texture-O7Pyotwx.js";import{A as r,F as o,V as E,C as f}from"./enums-DSseSvdG.js";const n=()=>d.getLogger("esri.views.webgl.BufferObject");let T=class a{static createIndex(t,e,s){return new a(t,r.ELEMENT_ARRAY_BUFFER,e,s)}static createVertex(t,e,s){return new a(t,r.ARRAY_BUFFER,e,s)}static createUniform(t,e,s){return new a(t,r.UNIFORM_BUFFER,e,s)}static createPixelPack(t,e=o.STREAM_READ,s){const i=new a(t,r.PIXEL_PACK_BUFFER,e);return s&&i.setSize(s),i}static createPixelUnpack(t,e=o.STREAM_DRAW,s){return new a(t,r.PIXEL_UNPACK_BUFFER,e,s)}static createTransformFeedback(t,e=o.STATIC_DRAW,s){const i=new a(t,r.TRANSFORM_FEEDBACK_BUFFER,e);return i.setSize(s),i}constructor(t,e,s,i){this._context=t,this.bufferType=e,this.usage=s,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(E.BufferObject,this),this._glName=this._context.gl.createBuffer(),h(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===r.ELEMENT_ARRAY_BUFFER?this._indexType===f.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===r.ELEMENT_ARRAY_BUFFER||this.bufferType===r.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(E.BufferObject,this),this._context=null):this._glName&&n().warn("Leaked WebGL buffer object")}setSize(t,e=null){if(t<=0&&n().error("Buffer size needs to be positive!"),this.bufferType===r.ELEMENT_ARRAY_BUFFER&&e!=null)switch(this._indexType=e,e){case f.UNSIGNED_SHORT:t*=2;break;case f.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===r.ELEMENT_ARRAY_BUFFER&&(R(t)&&(e/=2,this._indexType=f.UNSIGNED_SHORT),A(t)&&(e/=4,this._indexType=f.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;e!=null?i.bufferData(this.bufferType,e,this.usage):i.bufferData(this.bufferType,t,this.usage),h(i),this._isVAOAware&&this._context.bindVAO(s)}setSubData(t,e,s,i){if(!t)return;(e<0||e*t.BYTES_PER_ELEMENT>=this.usedMemory)&&n().error("offset is out of range!"),s>=i&&n().error("end must be bigger than start!"),(e+(i-s))*t.BYTES_PER_ELEMENT>this.usedMemory&&n().error("An attempt to write beyond the end of the buffer!");const u=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:_}=this._context;_.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,s,i-s),h(_),this._isVAOAware&&this._context.bindVAO(u)}getSubData(t,e=0,s,i){if(s<0||i<0)return void n().error("Problem getting subdata: offset and length were less than zero!");const u=l(t)?t.BYTES_PER_ELEMENT:1;if(u*((s??0)+(i??0))>t.byteLength)return void n().error("Problem getting subdata: offset and length exceeded destination size!");e+u*(i??0)>this.usedMemory&&n().warn("Potential problem getting subdata: requested data exceeds buffer size!");const _=this._context.gl;this.bufferType===r.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,r.TRANSFORM_FEEDBACK_BUFFER),_.getBufferSubData(r.TRANSFORM_FEEDBACK_BUFFER,e,t,s,i),this._context.unbindBuffer(r.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,r.COPY_READ_BUFFER),_.getBufferSubData(r.COPY_READ_BUFFER,e,t,s,i),this._context.unbindBuffer(r.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,s,i){await this._context.clientWaitAsync(),this.getSubData(t,e,s,i)}};function l(c){return b(c)}export{T as h};
